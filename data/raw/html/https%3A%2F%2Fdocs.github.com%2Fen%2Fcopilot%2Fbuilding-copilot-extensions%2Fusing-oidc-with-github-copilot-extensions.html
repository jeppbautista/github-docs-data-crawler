<html><body><div>
<main><div>
<div><nav><ul>
<li>
<a title="GitHub Copilot" href="/en/copilot">GitHub Copilot</a><span>/</span>
</li>
<li>
<a title="Build Copilot Extensions" href="/en/copilot/building-copilot-extensions">Build Copilot Extensions</a><span>/</span>
</li>
<li><a title="Use OIDC" href="/en/copilot/building-copilot-extensions/using-oidc-with-github-copilot-extensions">Use OIDC</a></li>
</ul></nav></div>
<div>
<div><div><h1>Using OIDC with GitHub Copilot Extensions</h1></div></div>
<div><div><p>Learn how to use OpenID Connect (OIDC) with your Copilot Extension to enhance security.</p></div></div>
<div>
<h2>In this article</h2>
<nav><ul>
<li><a href="#about-openid-connect-oidc-for-copilot-extensions"><div><span>About OpenID Connect (OIDC) for Copilot Extensions</span></div></a></li>
<li><a href="#overview-of-oidc"><div><span>Overview of OIDC</span></div></a></li>
<li><a href="#benefits-of-using-oidc"><div><span>Benefits of using OIDC</span></div></a></li>
<li><a href="#token-exchange-flow"><div><span>Token exchange flow</span></div></a></li>
<li><a href="#understanding-oidc-tokens"><div><span>Understanding OIDC tokens</span></div></a></li>
<li><a href="#setting-up-oidc-for-your-extension"><div><span>Setting up OIDC for your extension</span></div></a></li>
<li><a href="#troubleshooting"><div><span>Troubleshooting</span></div></a></li>
</ul></nav>
</div>
<div><div><div>
<h2><a href="#about-openid-connect-oidc-for-copilot-extensions">About OpenID Connect (OIDC) for Copilot Extensions</a></h2>
<p>OpenID Connect (OIDC) allows Copilot Extensions to exchange short-lived tokens directly from their cloud provider instead of storing long-lived GitHub credentials. This feature enables both Copilot agents and skillsets to more securely authenticate users and access cloud resources.</p>
<h2><a href="#overview-of-oidc">Overview of OIDC</a></h2>
<p>Copilot Extensions often need to access third-party resources or APIs on behalf of users. Traditionally, this required storing GitHub tokens as secrets and making additional API calls to map these tokens to user identities in your system. With OIDC, your extension can request short-lived access tokens directly from your authentication service by exchanging GitHub identity information.</p>
<p>When enabled, GitHub's OIDC provider automatically generates a token containing claims about the user and the request context. Your authentication service can validate these claims and exchange them for an access token scoped specifically for your service.</p>
<p>Using OIDC is especially valuable for Copilot skillsets development because it allows you to leverage your existing API endpoints without maintaining separate GitHub-specific endpoints. Instead of duplicating endpoints to accept GitHub tokens, you can use OIDC to translate GitHub identities into your serviceâ€™s native authentication tokens.</p>
<h2><a href="#benefits-of-using-oidc">Benefits of using OIDC</a></h2>
<p>By implementing OIDC token exchange in your Copilot Extension, you can:</p>
<ul>
<li>Avoid storing long-lived GitHub tokens or maintain a mapping between GitHub and your service's identities.</li>
<li>Use short-lived tokens that automatically expire and can be scoped specifically to your service's needs.</li>
<li>Avoid making additional calls to GitHub's API to validate tokens and fetch user information.</li>
<li>Enable direct integration for Copilot Skills with your existing APIs without maintaining separate endpoints for GitHub.</li>
<li>Reuse existing API endpoints by translating GitHub authentication into your service's native tokens.</li>
</ul>
<h2><a href="#token-exchange-flow">Token exchange flow</a></h2>
<p>The following outlines how the Copilot Extensibility Platform exchanges an OIDC token for an access token to authenticate requests to your extension.</p>
<h3><a href="#initial-request">Initial request</a></h3>
<ol>
<li>The user sends a message to your Copilot Extension.</li>
<li>GitHub generates an OIDC token containing user identity information.</li>
<li>GitHub calls your token exchange endpoint with the OIDC token.</li>
<li>Your service validates the token and returns an access token.</li>
<li>GitHub includes your access token in the request to your extension.</li>
</ol>
<pre><code># HTTP header
<span>Authorization</span><span>: </span>Bearer &lt;your-service-token&gt;
<span>X-GitHub-Token</span><span>: </span>&lt;github-token&gt;
</code></pre>
<h3><a href="#subsequent-requests">Subsequent requests</a></h3>
<ol>
<li>GitHub caches your access token for up to 10 minutes.</li>
<li>The cached token is reused for subsequent requests.</li>
<li>If the token expires or becomes invalid, GitHub requests a new one.</li>
</ol>
<h2><a href="#understanding-oidc-tokens">Understanding OIDC tokens</a></h2>
<p>The OIDC token from GitHub is a JWT containing claims about the user and request context:</p>
<pre><code><span>{</span>
  <span>"jti"</span><span>:</span> <span>"&lt;unique-token-id&gt;"</span><span>,</span>
  <span>"sub"</span><span>:</span> <span>"&lt;github-user-id&gt;"</span><span>,</span>
  <span>"aud"</span><span>:</span> <span>"&lt;your-client-id&gt;"</span><span>,</span>
  <span>"iss"</span><span>:</span> <span>"https://github.com/login/oauth"</span><span>,</span>
  <span>"nbf"</span><span>:</span> <span>1632492967</span><span>,</span>
  <span>"exp"</span><span>:</span> <span>1632493867</span><span>,</span>
  <span>"iat"</span><span>:</span> <span>1632493567</span><span>,</span>
  <span>"act"</span><span>:</span> <span>{</span>
    <span>"sub"</span><span>:</span> <span>"api.copilotchat.com"</span>
  <span>}</span>
<span>}</span>
</code></pre>
<h2><a href="#setting-up-oidc-for-your-extension">Setting up OIDC for your extension</a></h2>
<p>There are three steps to setting up OIDC for your extension.</p>
<ol>
<li>
<a href="#configure-your-token-exchange-endpoint">Configure your token exchange endpoint</a>.</li>
<li>
<a href="#enable-oidc-in-your-copilot-extensions-settings">Enable OIDC in your Copilot extensions settings</a>.</li>
<li>
<a href="#validate-oidc-tokens">Validate OIDC tokens</a>.</li>
</ol>
<h3><a href="#configure-your-token-exchange-endpoint">Configure your token exchange endpoint</a></h3>
<p>Create an endpoint in your service that conforms to the <a href="https://www.rfc-editor.org/rfc/rfc8693.html">RFC 8693 OAuth 2.0 Token Exchange</a>.
This endpoint should:</p>
<ul>
<li>
<p>Accept <code>POST</code> requests with the following form-encoded parameters:</p>
<pre><code>grant_type=urn:ietf:params:oauth:grant-type:token-exchange
&amp;resource=&lt;https://your-service.com/resource&gt;
&amp;subject_token=&lt;github-jwt-token&gt;
&amp;subject_token_type=urn:ietf:params:oauth:token-type:id_token
</code></pre>
</li>
<li>
<p>Return a JSON response with your service's access token:</p>
<pre><code><span>{</span>
  <span>"access_token"</span><span>:</span> &lt;<span>"your-service-token"</span>&gt;<span>,</span>
  <span>"issued_token_type"</span><span>:</span><span>"urn:ietf:params:oauth:token-type:access_token"</span><span>,</span>
  <span>"token_type"</span><span>:</span> <span>"Bearer"</span><span>,</span>
  <span>"expires_in"</span><span>:</span> <span>3600</span>
<span>}</span>
</code></pre>
</li>
<li>
<p>Return an error response when validation fails:</p>
<pre><code><span>{</span>
  <span>"error"</span><span>:</span> <span>"invalid_request"</span>
<span>}</span>
</code></pre>
</li>
</ul>
<h3><a href="#enable-oidc-in-your-copilot-extensions-settings">Enable OIDC in your Copilot Extension's settings</a></h3>
<p>In your Copilot Extension's configuration, enable OIDC:</p>
<ol>
<li>
<p>In the upper-right corner of any page on GitHub, click your profile photo.</p>
</li>
<li>
<p>Navigate to your account settings.</p>
<ul>
<li>For an app owned by a personal account, click <strong>Settings</strong>.</li>
<li>For an app owned by an organization:
<ol>
<li>Click <strong>Your organizations</strong>.</li>
<li>To the right of the organization, click <strong>Settings</strong>.</li>
</ol>
</li>
</ul>
</li>
<li>
<p>In the left sidebar, click </p>
</li>
<li>
<p>In the left sidebar, click <strong>GitHub Apps</strong>.</p>
</li>
<li>
<p>To the right of the GitHub App you want to configure for your Copilot Extension, click <strong>Edit</strong>.</p>
</li>
<li>
<p>In the left sidebar, click <strong>Copilot</strong>.</p>
</li>
<li>
<p>Under <strong>OpenID Connect Token Exchange</strong>, check <strong>Enabled</strong>.</p>
</li>
<li>
<p>In the <strong>Token exchange endpoint</strong> field, input your token exchange URL.</p>
</li>
<li>
<p>In the <strong>Request header key</strong> field, input the header key for your service's token. The default is <code>Authorization</code>.</p>
</li>
<li>
<p>In the <strong>Request header value</strong> field, input the header value format. The default is <code>Bearer ${token}</code>.</p>
</li>
</ol>
<h3><a href="#validate-oidc-tokens">Validate OIDC tokens</a></h3>
<p>Your token exchange endpoint should validate the GitHub OIDC token by following the steps below:</p>
<ol>
<li>Fetch the JSON Web Key Set (JWKS) from <a href="https://github.com/login/oauth/.well-known/openid-configuration">https://github.com/login/oauth/.well-known/openid-configuration</a>.</li>
<li>Verify  the token signature.</li>
<li>Validate required claims.
<ul>
<li>
<code>aud</code>: Audience. Your Copilot Extension's client ID.</li>
<li>
<code>sub</code>: Subject. The GitHub user ID making the request. The response is limited to data that the user has permissions to access. If the user has no permissions <code>400 Bad Request</code> is shown.</li>
<li>
<code>iat</code>: Issued At. The timestamp when the token was issued. It is typically a timestamp in the past but represents the exact moment the token was created.</li>
<li>
<code>nbf</code>: Not Before. The timestamp before which the token is not valid. This should be a timestamp in the past.</li>
<li>
<code>exp</code>: Expiration Time. The timestamp when the token expires. This should be a timestamp in the future.</li>
<li>
<code>act</code>: Actor. The acting entity in delegated access. This should be a constant string.</li>
</ul>
</li>
</ol>
<h2><a href="#troubleshooting">Troubleshooting</a></h2>
<p>The following sections outline common problems and best practices for implementing OIDC for your Copilot Extension.</p>
<h3><a href="#token-validation-errors">Token validation errors</a></h3>
<ul>
<li>Ensure you're using the correct JWKS endpoint.</li>
<li>Verify that all the required claims are present and valid.</li>
<li>Check that timestamps (<code>iat</code>, <code>nbf</code>, and <code>exp</code>) are within valid ranges.</li>
</ul>
<h3><a href="#token-exchange-failures">Token exchange failures</a></h3>
<ul>
<li>Return <code>HTTP 400</code> for invalid tokens.</li>
<li>Return <code>HTTP 403</code> if the user lacks the necessary permissions.</li>
<li>If GitHub receives a 403 response, it will retry the request with a new token.</li>
</ul>
<h3><a href="#performance-issues">Performance issues</a></h3>
<ul>
<li>Implement efficient token validation to minimize latency.</li>
<li>Use appropriate token expiration times (recommended: 10 minutes or less).</li>
<li>Consider caching implications for high-traffic extensions.</li>
</ul>
<h3><a href="#best-practices">Best practices</a></h3>
<ul>
<li>Scope tokens to the minimum required permissions.</li>
<li>Implement proper error handling and logging.</li>
<li>Monitor token exchange patterns for security anomalies.</li>
<li>Keep tokens short-lived to minimize security risks.</li>
<li>Validate all claims before issuing access tokens.</li>
<li>Consider implementing rate limiting on your token exchange endpoint.</li>
<li>Use HTTPS for all token exchange communications.</li>
</ul>
</div></div></div>
</div>
</div></main>
</div></body></html>