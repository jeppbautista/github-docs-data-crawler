<html><body><div>
<main><div>
<div><nav><ul>
<li>
<a title="GitHub Actions" href="/en/actions">GitHub Actions</a><span>/</span>
</li>
<li>
<a title="GitHub-hosted runners" href="/en/actions/using-github-hosted-runners">GitHub-hosted runners</a><span>/</span>
</li>
<li>
<a title="Private networking" href="/en/actions/using-github-hosted-runners/connecting-to-a-private-network">Private networking</a><span>/</span>
</li>
<li><a title="Using WireGuard" href="/en/actions/using-github-hosted-runners/connecting-to-a-private-network/using-wireguard-to-create-a-network-overlay">Using WireGuard</a></li>
</ul></nav></div>
<div>
<div><div><h1>Using WireGuard to create a network overlay</h1></div></div>
<div><div><p>You can create an overlay network between your runner and a service in your private network.</p></div></div>
<div>
<h2>In this article</h2>
<nav><ul>
<li><a href="#using-wireguard-to-create-a-network-overlay"><div><span>Using WireGuard to create a network overlay</span></div></a></li>
<li><a href="#example-configuring-wireguard"><div><span>Example: Configuring WireGuard</span></div></a></li>
</ul></nav>
</div>
<div><div><div>
<h2><a href="#using-wireguard-to-create-a-network-overlay">Using WireGuard to create a network overlay</a></h2>
<p>If you don't want to maintain separate infrastructure for an API Gateway, you can create an overlay network between your runner and a service in your private network, by running WireGuard in both places.</p>
<p>There are various disadvantages to this approach:</p>
<ul>
<li>To reach WireGuard running on your private service, you will need a well-known IP address and port that your workflow can reference: this can either be a public IP address and port, a port mapping on a network gateway, or a service that dynamically updates DNS.</li>
<li>WireGuard doesn't handle NAT traversal out of the box, so you'll need to identify a way to provide this service.</li>
<li>This connection is one-to-one, so if you need high availability or high throughput you'll need to build that on top of WireGuard.</li>
<li>You'll need to generate and securely store keys for both the runner and your private service. WireGuard uses UDP, so your network must support UDP traffic.</li>
</ul>
<p>There are some advantages too, as you can run WireGuard on an existing server so you don't have to maintain separate infrastructure, and it's well supported on GitHub-hosted runners.</p>
<h2><a href="#example-configuring-wireguard">Example: Configuring WireGuard</a></h2>
<p>This example workflow configures WireGuard to connect to a private service.</p>
<p>For this example, the WireGuard instance running in the private network has this configuration:</p>
<ul>
<li>Overlay network IP address of <code>192.168.1.1</code>
</li>
<li>Public IP address and port of <code>1.2.3.4:56789</code>
</li>
<li>Public key <code>examplepubkey1234...</code>
</li>
</ul>
<p>The WireGuard instance in the GitHub Actions runner has this configuration:</p>
<ul>
<li>Overlay network IP address of <code>192.168.1.2</code>
</li>
<li>Private key stores as an GitHub Actions secret under <code>WIREGUARD_PRIVATE_KEY</code>
</li>
</ul>
<pre><code><span>name:</span> <span>WireGuard</span> <span>example</span>

<span>on:</span>
  <span>workflow_dispatch:</span>

<span>jobs:</span>
  <span>wireguard_example:</span>
    <span>runs-on:</span> <span>ubuntu-latest</span>
    <span>steps:</span>
      <span>-</span> <span>run:</span> <span>sudo</span> <span>apt</span> <span>install</span> <span>wireguard</span>

      <span>-</span> <span>run:</span> <span>echo</span> <span>"$<span>{{ secrets.WIREGUARD_PRIVATE_KEY }}</span>"</span> <span>&gt;</span> <span>privatekey</span>

      <span>-</span> <span>run:</span> <span>sudo</span> <span>ip</span> <span>link</span> <span>add</span> <span>dev</span> <span>wg0</span> <span>type</span> <span>wireguard</span>

      <span>-</span> <span>run:</span> <span>sudo</span> <span>ip</span> <span>address</span> <span>add</span> <span>dev</span> <span>wg0</span> <span>192.168</span><span>.1</span><span>.2</span> <span>peer</span> <span>192.168</span><span>.1</span><span>.1</span>

      <span>-</span> <span>run:</span> <span>sudo</span> <span>wg</span> <span>set</span> <span>wg0</span> <span>listen-port</span> <span>48123</span> <span>private-key</span> <span>privatekey</span> <span>peer</span> <span>examplepubkey1234...</span> <span>allowed-ips</span> <span>0.0</span><span>.0</span><span>.0</span><span>/0</span> <span>endpoint</span> <span>1.2</span><span>.3</span><span>.4</span><span>:56789</span>

      <span>-</span> <span>run:</span> <span>sudo</span> <span>ip</span> <span>link</span> <span>set</span> <span>up</span> <span>dev</span> <span>wg0</span>

      <span>-</span> <span>run:</span> <span>curl</span> <span>-vvv</span> <span>http://192.168.1.1</span>
</code></pre>
<p>For more information, see <a href="https://www.wireguard.com/quickstart/">WireGuard's Quick Start</a>, as well as <a href="/en/actions/security-guides/using-secrets-in-github-actions">Using secrets in GitHub Actions</a> for how to securely store keys.</p>
<h3><a href="#using-tailscale-to-create-a-network-overlay">Using Tailscale to create a network overlay</a></h3>
<p>Tailscale is a commercial product built on top of WireGuard. This option is very similar to WireGuard, except Tailscale is more of a complete product experience instead of an open source component.</p>
<p>Its disadvantages are similar to WireGuard: The connection is one-to-one, so you might need to do additional work for high availability or high throughput. You still need to generate and securely store keys. The protocol is still UDP, so your network must support UDP traffic.</p>
<p>However, there are some advantages over WireGuard: NAT traversal is built-in, so you don't need to expose a port to the public internet. It is by far the quickest of these options to get up and running, since Tailscale provides an GitHub Actions workflow with a single step to connect to the overlay network.</p>
<p>For more information, see the <a href="https://github.com/tailscale/github-action">Tailscale GitHub Action</a>, as well as <a href="/en/actions/security-guides/using-secrets-in-github-actions">Using secrets in GitHub Actions</a> for how to securely store keys.</p>
</div></div></div>
</div>
</div></main>
</div></body></html>