<html><body><div>
<main><div>
<div><nav><ul>
<li>
<a title="Secure coding" href="/en/code-security">Secure coding</a><span>/</span>
</li>
<li>
<a title="Secret scanning" href="/en/code-security/secret-scanning">Secret scanning</a><span>/</span>
</li>
<li>
<a title="Work with secret scanning" href="/en/code-security/secret-scanning/working-with-secret-scanning-and-push-protection">Work with secret scanning</a><span>/</span>
</li>
<li><a title="Push protection on the command line" href="/en/code-security/secret-scanning/working-with-secret-scanning-and-push-protection/working-with-push-protection-from-the-command-line">Push protection on the command line</a></li>
</ul></nav></div>
<div>
<div><div><h1>Working with push protection from the command line</h1></div></div>
<div>
<div><p>Learn your options for unblocking your push from the command line to GitHub if secret scanning detects a secret in your changes.</p></div>
<div><div>
<div><h2>Who can use this feature?</h2></div>
<div><div><p>Users with <strong>write</strong> access</p></div></div>
</div></div>
</div>
<div>
<h2>In this article</h2>
<nav><ul>
<li><a href="#about-push-protection-from-the-command-line"><div><span>About push protection from the command line</span></div></a></li>
<li><a href="#resolving-a-blocked-push"><div><span>Resolving a blocked push</span></div></a></li>
<li><a href="#bypassing-push-protection"><div><span>Bypassing push protection</span></div></a></li>
<li><a href="#requesting-bypass-privileges"><div><span>Requesting bypass privileges</span></div></a></li>
<li><a href="#further-reading"><div><span>Further reading</span></div></a></li>
</ul></nav>
</div>
<div><div><div>
<h2><a href="#about-push-protection-from-the-command-line">About push protection from the command line</a></h2>
<p>Push protection prevents you from accidentally committing secrets to a repository by blocking pushes containing supported secrets.</p>
<p>When you attempt to push a supported secret from the command line to a repository secured by push protection, GitHub will block the push.</p>
<p>You should either:</p>
<ul>
<li>
<strong>Remove</strong> the secret from your branch. For more information, see <a href="#resolving-a-blocked-push">Resolving a blocked push</a>.</li>
<li>
<strong>Follow a provided URL</strong> to see what options are available to you to allow the push. For more information, see <a href="#bypassing-push-protection">Bypassing push protection</a> and <a href="#requesting-bypass-privileges">Requesting bypass privileges</a>.</li>
</ul>
<p>Up to five detected secrets will be displayed at a time on the command line. If a particular secret has already been detected in the repository and an alert already exists, GitHub will not block that secret.</p>
<p>If you confirm a secret is real and that you intend to fix it later, you should aim to remediate the secret as soon as possible. For example, you might revoke the secret and remove the secret from the repository's commit history. Real secrets that have been exposed must be revoked to avoid unauthorized access. You might consider first rotating the secret before revoking it. For more information, see <a href="/en/authentication/keeping-your-account-and-data-secure/removing-sensitive-data-from-a-repository">Removing sensitive data from a repository</a>.</p>
<div>
<ul>
<li>If your Git configuration supports pushes to multiple branches, and not only to the current branch, your push may be blocked due to additional and unintended refs being pushed. For more information, see the <a href="https://git-scm.com/docs/git-config#Documentation/git-config.txt-pushdefault"><code>push.default</code> options</a> in the Git documentation.</li>
<li>If secret scanning upon a push times out, GitHub will still scan your commits for secrets after the push.</li>
</ul>
</div>
<h2><a href="#resolving-a-blocked-push">Resolving a blocked push</a></h2>
<p>To resolve a blocked push, you must remove the secret from all of the commits it appears in.</p>
<ul>
<li>If the secret was introduced by your latest commit, see <a href="#removing-a-secret-introduced-by-the-latest-commit-on-your-branch">Removing a secret introduced by the latest commit on your branch</a>.</li>
<li>If the secret appears in earlier commits, see <a href="#removing-a-secret-introduced-by-an-earlier-commit-on-your-branch">Removing a secret introduced by an earlier commit on your branch</a>.</li>
</ul>
<div>
<p> To learn how to resolved a blocked commit in the GitHub UI, see <a href="/en/code-security/secret-scanning/working-with-secret-scanning-and-push-protection/working-with-push-protection-in-the-github-ui#resolving-a-blocked-commit">Working with push protection in the GitHub UI</a>.</p>
</div>
<h3><a href="#removing-a-secret-introduced-by-the-latest-commit-on-your-branch">Removing a secret introduced by the latest commit on your branch</a></h3>
<p>If the blocked secret was introduced by the latest commit on your branch, you can follow the guidance below.</p>
<ol>
<li>Remove the secret from your code.</li>
<li>To commit the changes, run <code>git commit --amend --all</code>. This updates the original commit that introduced the secret instead of creating a new commit.</li>
<li>Push your changes with <code>git push</code>.</li>
</ol>
<h3><a href="#removing-a-secret-introduced-by-an-earlier-commit-on-your-branch">Removing a secret introduced by an earlier commit on your branch</a></h3>
<p>You can also remove the secret if the secret appears in an earlier commit in the Git history. To do so, you will need to identify which commit first introduced the secret and modify the commit history with an interactive rebase.</p>
<ol>
<li>
<p>Examine the error message that displayed when you tried to push your branch, which lists all of the commits that contain the secret.</p>
<pre><code>remote:   —— GitHub Personal Access Token ——————————————————————
remote:    locations:
remote:      - commit: 8728dbe67
remote:        path: README.md:4
remote:      - commit: 03d69e5d3
remote:        path: README.md:4
remote:      - commit: 8053f7b27
remote:        path: README.md:4
</code></pre>
</li>
<li>
<p>Next, run <code>git log</code> to see a full history of all the commits on your branch, along with their corresponding timestamps.</p>
<pre><code>test-repo (test-branch)]$ git log
commit 8053f7b27 (HEAD -&gt; main)
Author: Octocat &lt;1000+octocat@users.noreply.github.com
Date:   Tue Jan 30 13:03:37 2024 +0100

  my fourth commit message

commit 03d69e5d3
Author: Octocat &lt;1000+octocat@users.noreply.github.com&gt;
Date:   Tue Jan 30 13:02:59 2024 +0100

  my third commit message

commit 8728dbe67
Author: Octocat &lt;1000+octocat@users.noreply.github.com
Date:   Tue Jan 30 13:01:36 2024 +0100

  my second commit message

commit 6057cbe51
Author: Octocat &lt;1000+octocat@users.noreply.github.com
Date:   Tue Jan 30 12:58:24 2024 +0100

  my first commit message

</code></pre>
</li>
<li>
<p>Focusing only on the commits that contain the secret, use the output of <code>git log</code> to identify which commit comes <em>earliest</em> in your Git history.</p>
<ul>
<li>In the example, commit <code>8728dbe67</code> was the first commit to contain the secret.</li>
</ul>
</li>
<li>
<p>Start an interactive rebase with <code>git rebase -i &lt;COMMIT-ID&gt;~1</code>.</p>
<ul>
<li>For <code>&lt;COMMIT-ID&gt;</code>, use the commit identified in step 3. For example, <code>git rebase -i 8728dbe67~1</code>.</li>
</ul>
</li>
<li>
<p>In the editor, choose to edit the commit identified in step 3 by changing <code>pick</code> to <code>edit</code> on the first line of the text.</p>
<pre><code>edit 8728dbe67 my second commit message
pick 03d69e5d3 my third commit message
pick 8053f7b27 my fourth commit message
</code></pre>
</li>
<li>
<p>Save and close the editor to start the interactive rebase.</p>
</li>
<li>
<p>Remove the secret from your code.</p>
</li>
<li>
<p>Add your changes to the staging area using <code>git add .</code>.</p>
<div>
<p> The full command is <code>git add .</code>:</p>
<ul>
<li>There is a space between <code>add</code> and <code>.</code>.</li>
<li>The period following the space is part of the command.</li>
</ul>
</div>
</li>
<li>
<p>Commit your changes using <code>git commit --amend</code>.</p>
</li>
<li>
<p>Run <code>git rebase --continue</code> to finish the rebase.</p>
</li>
<li>
<p>Push your changes with <code>git push</code>.</p>
</li>
</ol>
<h2><a href="#bypassing-push-protection">Bypassing push protection</a></h2>
<p>If GitHub blocks a secret that you believe is safe to push, you may be able to bypass the block by specifying a reason for allowing the secret to be pushed.</p>
<p>When you allow a secret to be pushed, an alert is created in the <strong>Security</strong> tab. GitHub closes the alert and doesn't send a notification if you specify that the secret is a false positive or used only in tests. If you specify that the secret is real and that you will fix it later, GitHub keeps the security alert open and sends notifications to the author of the commit, as well as to repository administrators. For more information, see <a href="/en/code-security/secret-scanning/managing-alerts-from-secret-scanning">Managing alerts from secret scanning</a>.</p>
<p>When a contributor bypasses a push protection block for a secret, GitHub also sends an email alert to the organization owners, security managers, and repository administrators who have opted in for email notifications.</p>
<p>If you don't see the option to bypass the block, the repository administrator or organization owner has configured tighter controls around push protection. Instead, you should remove the secret from the commit, or submit a request for "bypass privileges" in order to push the blocked secret. For more information, see <a href="/en/code-security/secret-scanning/working-with-secret-scanning-and-push-protection/working-with-push-protection-from-the-command-line#requesting-bypass-privileges">Requesting bypass privileges</a>.</p>
<ol>
<li>
<p>Visit the URL returned by GitHub when your push was blocked.</p>
</li>
<li>
<p>Choose the option that best describes why you should be able to push the secret.</p>
<ul>
<li>
<p>If the secret is only used in tests and poses no threat, click <strong>It's used in tests</strong>.</p>
</li>
<li>
<p>If the detected string is not a secret, click <strong>It's a false positive</strong>.</p>
</li>
<li>
<p>If the secret is real but you intend to fix it later, click <strong>I'll fix it later</strong>.</p>
</li>
</ul>
<div>
<p>
You are required to specify a reason for bypassing push protection if the repository has secret scanning enabled.</p>
<p>When pushing to a <em>public</em> repository that doesn't have secret scanning enabled, you are still protected from accidentally pushing secrets thanks to <em>push protection for users</em>, which is on by default for your user account.</p>
<p>With push protection for users, GitHub will automatically block pushes to public repositories if these pushes contain supported secrets, but you won't need to specify a reason for allowing the secret, and GitHub won't generate an alert. For more information, see <a href="/en/code-security/secret-scanning/working-with-secret-scanning-and-push-protection/push-protection-for-users">Push protection for users</a>.</p>
</div>
</li>
<li>
<p>Click <strong>Allow me to push this secret</strong>.</p>
</li>
<li>
<p>Reattempt the push on the command line within three hours. If you have not pushed within three hours, you will need to repeat this process.</p>
</li>
</ol>
<h2><a href="#requesting-bypass-privileges">Requesting bypass privileges</a></h2>
<p>If your push has been blocked by push protection and you believe the secret is safe to push, you can request permission to bypass the block. Your request is sent to a designated group of reviewers, who will either approve or deny the request.</p>
<p>Requests expire after 7 days.</p>
<ol>
<li>Visit the URL returned by GitHub when your push was blocked.</li>
<li>Under "Or request bypass privileges", add a comment. For example, you might explain why you believe the secret is safe to push, or provide context about the request to bypass the block.</li>
<li>Click <strong>Submit request</strong>.</li>
<li>Check your email notifications for a response to your request.</li>
</ol>
<p>Once your request has been reviewed, you will receive an email notifying you of the decision.</p>
<p>If your request is approved, you can push the commit (or commits) containing the secret to the repository, as well as any future commits that contain the same secret.</p>
<p>If your request is denied, you will need to remove the secret from all commits containing the secret before pushing again. For information on how to remove a blocked secret, see <a href="#resolving-a-blocked-push">Resolving a blocked push</a>.</p>
<h2><a href="#further-reading">Further reading</a></h2>
<ul>
<li><a href="/en/code-security/secret-scanning/working-with-secret-scanning-and-push-protection/working-with-push-protection-in-the-github-ui">Working with push protection in the GitHub UI</a></li>
<li><a href="/en/code-security/secret-scanning/working-with-secret-scanning-and-push-protection/working-with-push-protection-from-the-rest-api">Working with push protection from the REST API</a></li>
</ul>
</div></div></div>
</div>
</div></main>
</div></body></html>