<html><body><div>
<main><div>
<div><nav><ul>
<li>
<a title="GitHub Actions" href="/en/actions">GitHub Actions</a><span>/</span>
</li>
<li>
<a title="Security" href="/en/actions/security-for-github-actions">Security</a><span>/</span>
</li>
<li>
<a title="Security harden deployments" href="/en/actions/security-for-github-actions/security-hardening-your-deployments">Security harden deployments</a><span>/</span>
</li>
<li><a title="OpenID Connect in Azure" href="/en/actions/security-for-github-actions/security-hardening-your-deployments/configuring-openid-connect-in-azure">OpenID Connect in Azure</a></li>
</ul></nav></div>
<div>
<div><div><h1>Configuring OpenID Connect in Azure</h1></div></div>
<div><div><p>Use OpenID Connect within your workflows to authenticate with Azure.</p></div></div>
<div>
<h2>In this article</h2>
<nav><ul>
<li><a href="#overview"><div><span>Overview</span></div></a></li>
<li><a href="#prerequisites"><div><span>Prerequisites</span></div></a></li>
<li><a href="#adding-the-federated-credentials-to-azure"><div><span>Adding the federated credentials to Azure</span></div></a></li>
<li><a href="#updating-your-github-actions-workflow"><div><span>Updating your GitHub Actions workflow</span></div></a></li>
<li><a href="#further-reading"><div><span>Further reading</span></div></a></li>
</ul></nav>
</div>
<div><div><div>
<h2><a href="#overview">Overview</a></h2>
<p>OpenID Connect (OIDC) allows your GitHub Actions workflows to access resources in Azure, without needing to store the Azure credentials as long-lived GitHub secrets.</p>
<p>This guide gives an overview of how to configure Azure to trust GitHub's OIDC as a federated identity, and includes a workflow example for the <a href="https://github.com/Azure/login"><code>azure/login</code></a> action that uses tokens to authenticate to Azure and access resources.</p>
<h2><a href="#prerequisites">Prerequisites</a></h2>
<ul>
<li>
<p>To learn the basic concepts of how GitHub uses OpenID Connect (OIDC), and its architecture and benefits, see <a href="/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect">About security hardening with OpenID Connect</a>.</p>
</li>
<li>
<p>Before proceeding, you must plan your security strategy to ensure that access tokens are only allocated in a predictable way. To control how your cloud provider issues access tokens, you <strong>must</strong> define at least one condition, so that untrusted repositories canâ€™t request access tokens for your cloud resources. For more information, see <a href="/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect#configuring-the-oidc-trust-with-the-cloud">About security hardening with OpenID Connect</a>.</p>
</li>
</ul>
<h2><a href="#adding-the-federated-credentials-to-azure">Adding the federated credentials to Azure</a></h2>
<p>GitHub's OIDC provider works with Azure's workload identity federation. For an overview, see Microsoft's documentation at <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/workload-identity-federation">Workload identity federation</a>.</p>
<p>To configure the OIDC identity provider in Azure, you will need to perform the following configuration. For instructions on making these changes, refer to <a href="https://docs.microsoft.com/en-us/azure/developer/github/connect-from-azure">the Azure documentation</a>.</p>
<p>In the following procedure, you will create an application for Microsoft Entra ID (previously known as Azure AD).</p>
<ol>
<li>Create an Entra ID application and a service principal.</li>
<li>Add federated credentials for the Entra ID application.</li>
<li>Create GitHub secrets for storing Azure configuration.</li>
</ol>
<p>Additional guidance for configuring the identity provider:</p>
<ul>
<li>For security hardening, make sure you've reviewed <a href="/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect#configuring-the-oidc-trust-with-the-cloud">About security hardening with OpenID Connect</a>. For an example, see <a href="/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect#configuring-the-subject-in-your-cloud-provider">About security hardening with OpenID Connect</a>.</li>
<li>For the <code>audience</code> setting, <code>api://AzureADTokenExchange</code> is the recommended value, but you can also specify other values here.</li>
</ul>
<h2><a href="#updating-your-github-actions-workflow">Updating your GitHub Actions workflow</a></h2>
<p>To update your workflows for OIDC, you will need to make two changes to your YAML:</p>
<ol>
<li>Add permissions settings for the token.</li>
<li>Use the <a href="https://github.com/Azure/login"><code>azure/login</code></a> action to exchange the OIDC token (JWT) for a cloud access token.</li>
</ol>
<div>
<p>
When environments are used in workflows or in OIDC policies, we recommend adding protection rules to the environment for additional security. For example, you can configure deployment rules on an environment to restrict which branches and tags can deploy to the environment or access environment secrets. For more information, see <a href="/en/actions/deployment/targeting-different-environments/managing-environments-for-deployment#deployment-protection-rules">Managing environments for deployment</a>.</p>
</div>
<h3><a href="#adding-permissions-settings">Adding permissions settings</a></h3>
<p>The job or workflow run requires a <code>permissions</code> setting with <a href="/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github_token"><code>id-token: write</code></a> to allow GitHub's OIDC provider to create a JSON Web Token for every run. You won't be able to request the OIDC JWT ID token if the <code>permissions</code> for <code>id-token</code> is not set to <code>write</code>, however this value doesn't imply granting write access to any resources, only being able to fetch and set the OIDC token for an action or step to enable authenticating with a short-lived access token. Any actual trust setting is defined using OIDC claims, for more information see <a href="/en/actions/security-for-github-actions/security-hardening-your-deployments/about-security-hardening-with-openid-connect#configuring-the-oidc-trust-with-the-cloud">About security hardening with OpenID Connect</a>.</p>
<p>The <code>id-token: write</code> setting allows the JWT to be requested from GitHub's OIDC provider using one of these approaches:</p>
<ul>
<li>Using environment variables on the runner (<code>ACTIONS_ID_TOKEN_REQUEST_URL</code> and <code>ACTIONS_ID_TOKEN_REQUEST_TOKEN</code>).</li>
<li>Using <code>getIDToken()</code> from the Actions toolkit.</li>
</ul>
<p>If you need to fetch an OIDC token for a workflow, then the permission can be set at the workflow level. For example:</p>
<div>
<header><span>YAML</span><pre>permissions:
  id-token: write # This is required for requesting the JWT
  contents: read  # This is required for actions/checkout
</pre></header><pre><code><span>permissions:</span>
  <span>id-token:</span> <span>write</span> <span># This is required for requesting the JWT</span>
  <span>contents:</span> <span>read</span>  <span># This is required for actions/checkout</span>
</code></pre>
</div>
<p>If you only need to fetch an OIDC token for a single job, then this permission can be set within that job. For example:</p>
<div>
<header><span>YAML</span><pre>permissions:
  id-token: write # This is required for requesting the JWT
</pre></header><pre><code><span>permissions:</span>
  <span>id-token:</span> <span>write</span> <span># This is required for requesting the JWT</span>
</code></pre>
</div>
<p>You may need to specify additional permissions here, depending on your workflow's requirements.</p>
<p>For reusable workflows that are owned by the same user, organization, or enterprise as the caller workflow, the OIDC token generated in the reusable workflow can be accessed from the caller's context.
For reusable workflows outside your enterprise or organization, the <code>permissions</code> setting for <code>id-token</code> should be explicitly set to <code>write</code> at the caller workflow level or in the specific job that calls the reusable workflow.
This ensures that the OIDC token generated in the reusable workflow is only allowed to be consumed in the caller workflows when intended.</p>
<p>For more information, see <a href="/en/actions/using-workflows/reusing-workflows">Reusing workflows</a>.</p>
<h3><a href="#requesting-the-access-token">Requesting the access token</a></h3>
<p>The <a href="https://github.com/Azure/login"><code>azure/login</code></a> action receives a JWT from the GitHub OIDC provider, and then requests an access token from Azure. For more information, see the <a href="https://github.com/Azure/login"><code>azure/login</code></a> documentation.</p>
<p>The following example exchanges an OIDC ID token with Azure to receive an access token, which can then be used to access cloud resources.</p>
<div>
<header><span>YAML</span><pre>name: Run Azure Login with OIDC
on: [push]

permissions:
  id-token: write
  contents: read
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: 'Az CLI login'
        uses: azure/login@a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0
        with:
          client-id: ${{ secrets.AZURE_CLIENT_ID }}
          tenant-id: ${{ secrets.AZURE_TENANT_ID }}
          subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}

      - name: 'Run az commands'
        run: |
          az account show
          az group list
</pre></header><pre><code><span>name:</span> <span>Run</span> <span>Azure</span> <span>Login</span> <span>with</span> <span>OIDC</span>
<span>on:</span> [<span>push</span>]

<span>permissions:</span>
  <span>id-token:</span> <span>write</span>
  <span>contents:</span> <span>read</span>
<span>jobs:</span>
  <span>build-and-deploy:</span>
    <span>runs-on:</span> <span>ubuntu-latest</span>
    <span>steps:</span>
      <span>-</span> <span>name:</span> <span>'Az CLI login'</span>
        <span>uses:</span> <span>azure/login@a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0</span>
        <span>with:</span>
          <span>client-id:</span> <span>${{</span> <span>secrets.AZURE_CLIENT_ID</span> <span>}}</span>
          <span>tenant-id:</span> <span>${{</span> <span>secrets.AZURE_TENANT_ID</span> <span>}}</span>
          <span>subscription-id:</span> <span>${{</span> <span>secrets.AZURE_SUBSCRIPTION_ID</span> <span>}}</span>

      <span>-</span> <span>name:</span> <span>'Run az commands'</span>
        <span>run:</span> <span>|
          az account show
          az group list
</span></code></pre>
</div>
<h2><a href="#further-reading">Further reading</a></h2>
<ul>
<li><a href="/en/actions/deployment/security-hardening-your-deployments/using-openid-connect-with-reusable-workflows">Using OpenID Connect with reusable workflows</a></li>
<li><a href="/en/actions/hosting-your-own-runners/managing-self-hosted-runners/communicating-with-self-hosted-runners">Communicating with self-hosted runners</a></li>
</ul>
</div></div></div>
</div>
</div></main>
</div></body></html>