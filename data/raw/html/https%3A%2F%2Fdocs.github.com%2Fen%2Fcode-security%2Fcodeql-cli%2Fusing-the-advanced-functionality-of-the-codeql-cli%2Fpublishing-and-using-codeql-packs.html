<html><body><div>
<main><div>
<div><nav><ul>
<li>
<a title="Secure coding" href="/en/code-security">Secure coding</a><span>/</span>
</li>
<li>
<a title="CodeQL CLI" href="/en/code-security/codeql-cli">CodeQL CLI</a><span>/</span>
</li>
<li>
<a title="Advanced functionality" href="/en/code-security/codeql-cli/using-the-advanced-functionality-of-the-codeql-cli">Advanced functionality</a><span>/</span>
</li>
<li><a title="Publishing and using CodeQL packs" href="/en/code-security/codeql-cli/using-the-advanced-functionality-of-the-codeql-cli/publishing-and-using-codeql-packs">Publishing and using CodeQL packs</a></li>
</ul></nav></div>
<div>
<div><div><h1>Publishing and using CodeQL packs</h1></div></div>
<div>
<div><p>You can publish your own CodeQL packs and use packs published by other people.</p></div>
<div><div>
<div><h2>Who can use this feature?</h2></div>
<div><div>
<p>CodeQL is available for the following repository types:</p>
<ul>
<li>Public repositories on GitHub.com, see <a href="https://github.com/github/codeql-cli-binaries/blob/main/LICENSE.md">GitHub CodeQL Terms and Conditions</a>
</li>
<li>Organization-owned repositories on GitHub Team with <a href="/en/get-started/learning-about-github/about-github-advanced-security">GitHub Code Security</a> enabled</li>
</ul>
</div></div>
</div></div>
</div>
<div>
<h2>In this article</h2>
<nav><ul>
<li><a href="#authenticating-to-github-container-registries"><div><span>Authenticating to GitHub Container registries</span></div></a></li>
<li><a href="#configuring-the-qlpackyml-file-before-publishing"><div><span>Configuring the qlpack.yml file before publishing</span></div></a></li>
<li><a href="#running-codeql-pack-publish"><div><span>Running codeql pack publish</span></div></a></li>
<li><a href="#running-codeql-pack-download-scopepack"><div><span>Running codeql pack download &lt;scope&gt;/&lt;pack&gt;</span></div></a></li>
<li><a href="#using-a-codeql-pack-to-analyze-a-codeql-database"><div><span>Using a CodeQL pack to analyze a CodeQL database</span></div></a></li>
<li><a href="#about-codeql-pack-compatibility"><div><span>About CodeQL pack compatibility</span></div></a></li>
<li><a href="#about-qlpackyml-files"><div><span>About qlpack.yml files</span></div></a></li>
<li><a href="#about-codeql-packlockyml-files"><div><span>About codeql-pack.lock.yml files</span></div></a></li>
<li><a href="#examples-of-custom-codeql-packs"><div><span>Examples of custom CodeQL packs</span></div></a></li>
<li><a href="#examples-of-codeql-packs-in-the-codeql-repository"><div><span>Examples of CodeQL packs in the CodeQL repository</span></div></a></li>
</ul></nav>
</div>
<div><div><div>
<h2><a href="#authenticating-to-github-container-registries">Authenticating to GitHub Container registries</a></h2>
<p>You can publish packs and download private packs by authenticating to the appropriate GitHub Container registry.</p>
<p>You can authenticate to the Container registry in two ways:</p>
<ol>
<li>Pass the <code>--github-auth-stdin</code> option to the CodeQL CLI, then supply a GitHub Apps token or personal access token via standard input.</li>
<li>Set the <code>GITHUB_TOKEN</code> environment variable to a GitHub Apps token or personal access token.</li>
</ol>
<h2><a href="#configuring-the-qlpackyml-file-before-publishing">Configuring the <code>qlpack.yml</code> file before publishing</a></h2>
<p>You can check and modify the configuration details of your CodeQL pack prior to publishing. Open the <code>qlpack.yml</code> file in your preferred text editor.</p>
<pre><code><span>library:</span> <span># set to true if the pack is a library. Set to false or omit for a query pack</span>
<span>name:</span> <span>&lt;scope&gt;/&lt;pack&gt;</span>
<span>version:</span> <span>&lt;x.x.x&gt;</span>
<span>description:</span> <span>&lt;Description</span> <span>to</span> <span>publish</span> <span>with</span> <span>the</span> <span>package&gt;</span>
<span>defaultSuite:</span> <span># optional, one or more queries in the pack to run by default</span>
    <span>-</span> <span>query:</span> <span>&lt;relative-path&gt;/query-file&gt;.ql</span>
<span>defaultSuiteFile:</span> <span>default-queries.qls</span> <span># optional, a pointer to a query-suite in this pack</span>
<span>license:</span> <span># optional, the license under which the pack is published</span>
<span>dependencies:</span> <span># map from CodeQL pack name to version range</span>
</code></pre>
<ul>
<li>
<p><code>name:</code> must follow the <code>&lt;scope&gt;/&lt;pack&gt;</code> format, where <code>&lt;scope&gt;</code> is the GitHub organization that you will publish to and <code>&lt;pack&gt;</code> is the name for the pack.</p>
</li>
<li>
<p>A maximum of one of <code>defaultSuite</code> or <code>defaultSuiteFile</code> is allowed. These are two different ways to define a default query suite to be run, the first by specifying queries directly in the qlpack.yml file and the second by specifying a query suite in the pack.</p>
</li>
</ul>
<h2><a href="#running-codeql-pack-publish">Running <code>codeql pack publish</code></a></h2>
<p>When you are ready to publish a pack to the GitHub Container registry, you can run the following command in the root of the pack directory:</p>
<pre><code>codeql pack publish
</code></pre>
<p>The published package will be displayed in the packages section of GitHub organization specified by the scope in the <code>qlpack.yml</code> file.</p>
<div>
<p>
If you're publishing model packs to the GitHub Container registry in order to extend coverage to all repositories in an organization as part of a default setup configuration, then you need to ensure that repositories running code scanning can access those model packs. For more information, see <a href="/en/code-security/code-scanning/managing-your-code-scanning-configuration/editing-your-configuration-of-default-setup">Editing your configuration of default setup</a> and <a href="/en/packages/learn-github-packages/configuring-a-packages-access-control-and-visibility">Configuring a package's access control and visibility</a>.</p>
</div>
<h2><a href="#running-codeql-pack-download-scopepack">Running <code>codeql pack download &lt;scope&gt;/&lt;pack&gt;</code></a></h2>
<p>To run a pack that someone else has created, you must first download it by running the following command:</p>
<pre><code>codeql pack download &lt;scope&gt;/&lt;pack&gt;@x.x.x
</code></pre>
<ul>
<li>
<code>&lt;scope&gt;</code>: the name of the GitHub organization that you will download from.</li>
<li>
<code>&lt;pack&gt;</code>: the name for the pack that you want to download.</li>
<li>
<code>@x.x.x</code>: an optional version number. If omitted, the latest version will be downloaded.</li>
</ul>
<p>This command accepts arguments for multiple packs.</p>
<p>If you write scripts that specify a particular version number of a
query pack to download, keep in mind that when you update your version of
CodeQL to a newer one, you may
also need to switch to a newer version of the query pack. Newer
versions of CodeQL <em>may</em> provide
degraded performance when used with query packs that have been pinned
to a very old version. For more information, see <a href="#about-codeql-pack-compatibility">About CodeQL
pack compatibility</a>.</p>
<h2><a href="#using-a-codeql-pack-to-analyze-a-codeql-database">Using a CodeQL pack to analyze a CodeQL database</a></h2>
<p>To analyze a CodeQL database with a CodeQL pack, run the following command:</p>
<pre><code>codeql database analyze &lt;database&gt; &lt;scope&gt;/&lt;pack&gt;@x.x.x:&lt;path&gt;
</code></pre>
<ul>
<li>
<code>&lt;database&gt;</code>: the CodeQL database to be analyzed.</li>
<li>
<code>&lt;scope&gt;</code>: the name of the GitHub organization that the pack is published to.</li>
<li>
<code>&lt;pack&gt;</code>: the name for the pack that you are using.</li>
<li>
<code>@x.x.x</code>: an optional version number. If omitted, the latest version will be used.</li>
<li>
<code>:&lt;path&gt;</code>: an optional path to a query, directory, or query suite. If omitted, the pack’s default query suite will be used.</li>
</ul>
<p>The <code>analyze</code> command will run the default suite of any specified CodeQL packs. You can specify multiple CodeQL packs to be used for analyzing a CodeQL database. For example:</p>
<pre><code>codeql &lt;database&gt; analyze &lt;scope&gt;/&lt;pack&gt; &lt;scope&gt;/&lt;other-pack&gt;
</code></pre>
<div>
<p>
The <code>codeql pack download</code> command stores the pack it downloads in an internal location that is not intended for local modification. Unexpected (and hard to troubleshoot) behavior may result if the pack is modified after downloading. For more information about customizing packs, see <a href="/en/code-security/codeql-cli/using-the-advanced-functionality-of-the-codeql-cli/creating-and-working-with-codeql-packs">Creating and working with CodeQL packs</a>.</p>
</div>
<h2><a href="#about-codeql-pack-compatibility">About CodeQL pack compatibility</a></h2>
<p>When a query pack is published, it includes pre-compiled representations of all the queries in it. These pre-compiled queries are generally much faster to execute than it is to compile the QL source from scratch during the analysis. However, the pre-compiled queries also depend on certain internals of the QL evaluator, so if the version of CodeQL that performs the analysis is too different from the version that ran <code>codeql pack publish</code>, it may be necessary to compile the queries from source instead during analysis. The recompilation happens automatically and will not affect the <em>results</em> of the analysis, but it can make the
analysis significantly slower.</p>
<p>It can generally be assumed that if a pack is published with one release of CodeQL, the precompiled queries in it can be used directly by <em>later</em> releases of CodeQL, as long as there is no more than 6 months between the release dates. We will make reasonable efforts to keep new releases compatible for longer than that, but make no promises.</p>
<p>It can also be assumed that a pack published by the <em>latest</em> public release of CodeQL will be useable by the version of CodeQL that is used by code scanning and GitHub Actions, even though that is often a slightly older release.</p>
<p>As a user of a published query pack, you can check that the CodeQL makes use of the precompiled queries in it by inspecting the terminal output from an analysis runs that uses the query pack. If it contains lines looking like the following, then the precompiled queries were used successfully:</p>
<pre><code>[42/108] Loaded /long/path/to/query/Filename.qlx.
</code></pre>
<p>However, if they instead look like the following, then usage of the precompiled queries failed:</p>
<pre><code>Compiling query plan for /long/path/to/query/Filename.ql.
[42/108 comp 25s] Compiled /long/path/to/query/Filename.ql.
</code></pre>
<p>The results of the analysis will still be good in this case, but to get optimal performance you may need to upgrade to a newer version of the CodeQL CLI and/or of the query pack.</p>
<p>If you publish query packs on the Container registry on GitHub.com for others to use, we recommend that you use a recent release of CodeQL to run <code>codeql pack publish</code>, and that you publish a fresh version of your pack with an updated CodeQL version before the version you used turns 6 months old. That way you can ensure that users of your pack who keep <em>their</em> CodeQL up to date will benefit from the pre-compiled queries in your pack.</p>
<p>If you publish query packs with the intention of using them on a GitHub Enterprise Server installation that uses its bundled CodeQL binaries, use the same CodeQL version to run <code>codeql pack publish</code>. Newer versions might produce pre-compiled queries that the one in GitHub Enterprise Server may not recognize. Your GitHub Enterprise Server administrator may choose to upgrade to a newer version of CodeQL periodically. If so, follow their lead.</p>
<h2><a href="#about-qlpackyml-files">About <code>qlpack.yml</code> files</a></h2>
<p>When executing query-related commands, CodeQL first looks in siblings of the installation directory (and their subdirectories) for <code>qlpack.yml</code> files.
Then it checks the package cache for CodeQL packs which have been downloaded. This means that when you are developing queries locally, the local packages
in the installation directory override packages of the same name in the package cache, so that you can test your local changes.</p>
<p>The metadata in each <code>qlpack.yml</code> file tells CodeQL how to compile any queries in the pack, what libraries the pack depends on, and where to
find query suite definitions.</p>
<p>The contents of the CodeQL pack (queries or libraries used in CodeQL analysis) is included in the same directory as <code>qlpack.yml</code>, or its subdirectories.</p>
<p>The directory containing the <code>qlpack.yml</code> file serves as the root directory for the content of the CodeQL pack. That is, for all <code>.ql</code> and <code>.qll</code> files in the pack, CodeQL will resolve all import statements relative to the directory containing the <code>qlpack.yml</code> file at the pack’s root.</p>
<h3><a href="#qlpackyml-properties"><code>qlpack.yml</code> properties</a></h3>
<p>The following properties are supported in <code>qlpack.yml</code> files.</p>
<h4><a href="#name"><code>name</code></a></h4>
<ul>
<li>
<p>Required by all packs.</p>
</li>
<li>
<p>Defines the scope of the pack, where the CodeQL pack is published, and the name of the pack defined using alphanumeric characters and hyphens. It must be unique as CodeQL cannot differentiate between CodeQL packs with identical names. Use the pack name to specify queries to run using <code>database analyze</code> and to define dependencies between CodeQL packs (see examples below). For example:</p>
<pre><code><span>name:</span> <span>octo-org/security-queries</span>
</code></pre>
</li>
</ul>
<h4><a href="#version"><code>version</code></a></h4>
<ul>
<li>
<p>Required by all packs that are published.</p>
</li>
<li>
<p>Defines a semantic version for this CodeQL pack that must adhere to the <a href="https://semver.org/spec/v2.0.0.html">SemVer v2.0.0 specification</a>. For example:</p>
<pre><code><span>version:</span> <span>0.0</span><span>.0</span>
</code></pre>
</li>
</ul>
<h4><a href="#dataextensions"><code>dataExtensions</code></a></h4>
<ul>
<li>Required by model packs.</li>
<li>Takes a list of glob patterns that specify where data extension files are located relative to the root of the query pack or library pack.</li>
</ul>
<h4><a href="#dependencies"><code>dependencies</code></a></h4>
<ul>
<li>
<p>Required by query and library packs that define CodeQL package dependencies on other packs. Model packs cannot define any dependencies and use <code>extensionTargets</code> instead.</p>
</li>
<li>
<p>Defines a map from pack references to the semantic version range that is compatible with this pack. Supported for CodeQL CLI versions v2.6.0 and later. For example:</p>
<pre><code><span>dependencies:</span>
  <span>codeql/cpp-all:</span> <span>^0.0.2</span>
</code></pre>
<p>If you are unsure or it does not matter which version should be used, then you can use <code>"*"</code>, which indicates that any version of this dependency is compatible with this pack. In practice, this will usually resolve to the highest published version of the dependency.</p>
<p>There is a special version placeholder, <code>${workspace}</code>, which indicates that this CodeQL pack depends on whatever version of the dependency is in the same workspace. For more information, see <a href="/en/code-security/codeql-cli/using-the-advanced-functionality-of-the-codeql-cli/about-codeql-workspaces#using-workspace-as-a-version-range-in-qlpackyml-files">About CodeQL workspaces</a>.</p>
</li>
</ul>
<h4><a href="#defaultsuitefile"><code>defaultSuiteFile</code></a></h4>
<ul>
<li>
<p>Required by packs that export a set of default queries to run.</p>
</li>
<li>
<p>Defines the path to a query suite file relative to the package root, containing all of the queries that are run by default when this pack is passed to the <code>codeql database analyze</code> command. Supported from CLI version v2.6.0 and onwards. Only one of <code>defaultSuiteFile</code> or <code>defaultSuite</code> can be defined. For example:</p>
<pre><code><span>defaultSuiteFile:</span> <span>cpp-code-scanning.qls</span>
</code></pre>
</li>
</ul>
<h4><a href="#defaultsuite"><code>defaultSuite</code></a></h4>
<ul>
<li>
<p>Required by packs that export a set of default queries to run.</p>
</li>
<li>
<p>Defines an inlined query suite containing all of the queries that are run by default when this pack is passed to the <code>codeql database analyze</code> command. Supported from CLI version v2.6.0 and onwards. Only one of <code>defaultSuiteFile</code> or <code>defaultSuite</code> can be defined. For example:</p>
<pre><code><span>defaultSuite:</span>
  <span>queries:</span> <span>.</span>
  <span>exclude:</span>
    <span>precision:</span> <span>medium</span>
</code></pre>
</li>
</ul>
<h4><a href="#extensiontargets"><code>extensionTargets</code></a></h4>
<ul>
<li>Required by model packs.</li>
<li>Declares which query packs the extensions in the model pack apply to. The extension pack will inject its data extensions into each pack that is named in the <code>extensionTargets</code> dictionary, if the pack falls within the specified version range and it is used in the evaluation.</li>
</ul>
<h4><a href="#groups"><code>groups</code></a></h4>
<ul>
<li>
<p>Optional.</p>
</li>
<li>
<p>Defines logical groupings of packs in a CodeQL workspace. Using groups is a way to apply pack operations to subsets of packs in a workspace. For example, the following pack is defined to be a part of the <code>java</code> and the <code>experimental</code> groups:</p>
<pre><code><span>groups:</span>
  <span>-</span> <span>java</span>
  <span>-</span> <span>experimental</span>
</code></pre>
<p>Running <code>codeql pack publish --groups java,-experimental</code> will publish all of the packs in the <code>java</code> group, <em>except</em> the <code>experimental</code> packs. You can run the <code>codeql pack ls --groups [-]&lt;group&gt;[,[-]&lt;group&gt;...]</code> command to list the packs in a workspace that match the specified set of groups.</p>
<p>A CodeQL pack in the given workspace is included in the list if:</p>
<ul>
<li>It is in at least one of the groups listed without a minus sign (this condition is automatically satisfied if there are no groups listed without a minus sign), and</li>
<li>It is not in any group listed with a minus sign.</li>
</ul>
</li>
</ul>
<h4><a href="#library"><code>library</code></a></h4>
<ul>
<li>
<p>Required by library packs.</p>
</li>
<li>
<p>Defines a boolean value that indicates whether or not this pack is a library pack. Library packs do not contain queries and are not compiled. Query packs can ignore this field or explicitly set it to <code>false</code>. For example:</p>
<pre><code><span>library:</span> <span>true</span>
</code></pre>
</li>
</ul>
<h4><a href="#suites"><code>suites</code></a></h4>
<ul>
<li>Optional for packs that define query suites. This allows users to run query suites stored in the specified directory by specifying the pack name, without providing the full path.</li>
<li>Currently supported only for the standard query packs included in CodeQL CLI bundle.</li>
<li>This option is not supported for CodeQL packs downloaded from the GitHub container registry.</li>
</ul>
<h4><a href="#tests"><code>tests</code></a></h4>
<ul>
<li>
<p>Optional for packs containing CodeQL tests. Ignored for packs without tests.</p>
</li>
<li>
<p>Defines the path to a directory within the pack that contains tests, defined relative to the pack directory. Use <code>.</code> to specify the whole pack. Any queries in this directory are run as tests when <code>test run</code> is run with the <code>--strict-test-discovery</code> option. These queries are ignored by query suite definitions that use <code>queries</code> or <code>qlpack</code> instructions to ask for all queries in a particular pack. If this property is missing, then <code>.</code> is assumed. For example:</p>
<pre><code><span>tests:</span> <span>.</span>
</code></pre>
</li>
</ul>
<h4><a href="#extractor"><code>extractor</code></a></h4>
<ul>
<li>
<p>Required by all packs containing CodeQL tests.</p>
</li>
<li>
<p>Defines the CodeQL language extractor to use when running the CodeQL tests in the pack. For more information about testing queries, see <a href="/en/code-security/codeql-cli/using-the-advanced-functionality-of-the-codeql-cli/testing-custom-queries">Testing custom queries</a>. For example:</p>
<pre><code><span>extractor:</span> <span>javascript-typescript</span>
</code></pre>
</li>
</ul>
<h4><a href="#authors"><code>authors</code></a></h4>
<ul>
<li>
<p>Optional.</p>
</li>
<li>
<p>Defines metadata that will be displayed on the packaging search page in the packages section of the account that the CodeQL pack is published to. For example:</p>
<pre><code><span>authors:</span> <span>author1@github.com,author2@github.com</span>
</code></pre>
</li>
</ul>
<h4><a href="#license"><code>license</code></a></h4>
<ul>
<li>
<p>Optional.</p>
</li>
<li>
<p>Defines metadata that will be displayed on the packaging search page in the packages section of the account that the CodeQL pack is published to. For a list of allowed licenses, see <a href="https://spdx.org/licenses/">SPDX License List</a> in the SPDX Specification. For example:</p>
<pre><code><span>license:</span> <span>MIT</span>
</code></pre>
</li>
</ul>
<h4><a href="#description"><code>description</code></a></h4>
<ul>
<li>
<p>Optional.</p>
</li>
<li>
<p>Defines metadata that will be displayed on the packaging search page in the packages section of the account that the CodeQL pack is published to. For example:</p>
<pre><code><span>description:</span> <span>Human-readable</span> <span>description</span> <span>of</span> <span>the</span> <span>contents</span> <span>of</span> <span>the</span> <span>CodeQL</span> <span>pack.</span>
</code></pre>
</li>
</ul>
<h4><a href="#librarypathdependencies"><code>libraryPathDependencies</code></a></h4>
<ul>
<li>
<p>Optional, deprecated. Use the <code>dependencies</code> property instead.</p>
</li>
<li>
<p>Previously used to define the names of any CodeQL packs that this CodeQL pack depends on, as an array. This gives the pack access to any libraries, database schema, and query suites defined in the dependency. For example:</p>
<pre><code><span>libraryPathDependencies:</span> <span>codeql/javascript-all</span>
</code></pre>
</li>
</ul>
<h4><a href="#dbscheme"><code>dbscheme</code></a></h4>
<ul>
<li>
<p>Required by core language packs only.</p>
</li>
<li>
<p>Defines the path to the <a href="https://codeql.github.com/docs/codeql-overview/codeql-glossary/#codeql-database-schema">database schema</a> for all libraries and queries written for this CodeQL language (see example below). For example:</p>
<pre><code><span>dbscheme:</span> <span>semmlecode.python.dbscheme</span>
</code></pre>
</li>
</ul>
<h4><a href="#upgrades"><code>upgrades</code></a></h4>
<ul>
<li>
<p>Required by core language packs only.</p>
</li>
<li>
<p>Defines the path to a directory within the pack that contains database upgrade scripts, defined relative to the pack directory. Database upgrades are used internally to ensure that a database created with a different version of the CodeQL CLI is compatible with the current version of the CLI. For example:</p>
<pre><code><span>upgrades:</span> <span>.</span>
</code></pre>
</li>
</ul>
<h4><a href="#warnonimplicitthis"><code>warnOnImplicitThis</code></a></h4>
<ul>
<li>
<p>Optional. Defaults to <code>false</code> if the <code>warnOnImplicitThis</code> property is not defined.</p>
</li>
<li>
<p>Defines a boolean that specifies whether or not the compiler should emit warnings about member predicate calls with implicit <code>this</code> call receivers, that is, without an explicit receiver. Available since CodeQL CLI v2.13.2. For example:</p>
<pre><code><span>warnOnImplicitThis:</span> <span>true</span>
</code></pre>
</li>
</ul>
<h2><a href="#about-codeql-packlockyml-files">About <code>codeql-pack.lock.yml</code> files</a></h2>
<p><code>codeql-pack.lock.yml</code> files store the versions of the resolved transitive dependencies of a CodeQL pack. This file is created by the <code>codeql pack install</code> command if it does not already exist and should be added to your version control system. The <code>dependencies</code> section of the <code>qlpack.yml</code> file contains version ranges that are compatible with the pack. The <code>codeql-pack.lock.yml</code> file locks the versions to precise dependencies. This ensures that running <code>codeql pack install</code> on this the pack will always retrieve the same versions of dependencies even if newer compatible versions exist.</p>
<p>For example, if a <code>qlpack.yml</code> file contains the following dependencies:</p>
<pre><code><span>dependencies:</span>
  <span>codeql/cpp-all:</span> <span>^0.1.2</span>
  <span>my-user/my-lib:</span> <span>^0.2.3</span>
  <span>other-dependency/from-source:</span> <span>"*"</span>
</code></pre>
<p>The <code>codeql-pack.lock.yml</code> file will contain something like the following:</p>
<pre><code><span>dependencies:</span>
  <span>codeql/cpp-all:</span>
    <span>version:</span> <span>0.1</span><span>.4</span>
  <span>my-user/my-lib:</span>
    <span>version:</span> <span>0.2</span><span>.4</span>
  <span>my-user/transitive-dependency:</span>
    <span>version:</span> <span>1.2</span><span>.4</span>
</code></pre>
<p>The <code>codeql/cpp-all</code> dependency is locked to version 0.1.4. The <code>my-user/my-lib</code> dependency is locked to version 0.2.4. The <code>my-user/transitive-dependency</code>, which is a transitive dependency and is not specified in the <code>qlpack.yml</code> file, is locked to version 1.2.4. The <code>other-dependency/from-source</code> is absent from the lock file since it is resolved from source. This dependency must be available in the same CodeQL workspace as the pack. For more information about CodeQL workspaces and resolving dependencies from source, see <a href="/en/code-security/codeql-cli/using-the-advanced-functionality-of-the-codeql-cli/about-codeql-workspaces">About CodeQL workspaces</a>.</p>
<p>In most cases, the <code>codeql-pack.lock.yml</code> file is only relevant for query packs since library packs are non-executable and usually do not need their transitive dependencies to be fixed. The exception to this is for library packs that contain tests. In this case, the <code>codeql-pack.lock.yml</code> file is used to ensure that the tests are always run with the same versions of dependencies to avoid spurious failures when there are mismatched dependencies.</p>
<h2><a href="#examples-of-custom-codeql-packs">Examples of custom CodeQL packs</a></h2>
<p>When you write custom queries or tests, you should save them in custom CodeQL packs. For simplicity, try to organize each pack logically. For more information, see <a href="/en/code-security/codeql-cli/using-the-advanced-functionality-of-the-codeql-cli/creating-and-working-with-codeql-packs#codeql-pack-structure">Creating and working with CodeQL packs</a>. Save files for queries and tests in separate packs and, where possible, organize custom packs into specific folders for each target language. This is particularly useful if you intend to publish your CodeQL packs so they can be shared with others or used in code scanning. For more information, see <a href="/en/code-security/code-scanning/introduction-to-code-scanning/about-code-scanning-with-codeql">About code scanning with CodeQL</a>.</p>
<h3><a href="#codeql-packs-for-custom-libraries">CodeQL packs for custom libraries</a></h3>
<p>A custom CodeQL pack containing custom C++ libraries, with no queries or tests, may have a <code>qlpack.yml</code> file containing:</p>
<pre><code><span>name:</span> <span>my-github-user/my-custom-libraries</span>
<span>version:</span> <span>1.2</span><span>.3</span>
<span>library:</span> <span>true</span>
<span>dependencies:</span>
  <span>codeql/cpp-all:</span> <span>^0.1.2</span>
</code></pre>
<p>where <code>codeql/cpp-all</code> is the name of the CodeQL pack for C/C++ analysis included in the CodeQL repository. The version range <code>^0.1.2</code> indicates that this pack is compatible with all versions of <code>codeql/cpp-all</code> that are greater than or equal to <code>0.1.2</code> and less than <code>0.2.0</code>. Any CodeQL library file (a file with a <code>.qll</code> extension) defined in this pack will be available to queries defined in any query pack that includes this pack in its dependencies block.</p>
<p>The <code>library</code> property indicates that this pack is a library pack and does not contain any queries.</p>
<h3><a href="#codeql-packs-for-custom-queries">CodeQL packs for custom queries</a></h3>
<p>A custom CodeQL pack containing custom C++ queries and libraries may have a <code>qlpack.yml</code> file containing:</p>
<pre><code><span>name:</span> <span>my-github-user/my-custom-queries</span>
<span>version:</span> <span>1.2</span><span>.3</span>
<span>dependencies:</span>
  <span>codeql/cpp-all:</span> <span>^0.1.2</span>
  <span>my-github-user/my-custom-libraries:</span> <span>^1.2.3</span>
</code></pre>
<p>where <code>codeql/cpp-all</code> is the name of the CodeQL pack for C/C++ analysis included in the CodeQL repository. The version range <code>^0.1.2</code> indicates that this pack is compatible with all versions of <code>codeql/cpp-all</code> that are greater than or equal to <code>0.1.2</code> and less than <code>0.2.0</code>. <code>my-github-user/my-custom-libraries</code> is the name of a CodeQL pack containing custom CodeQL libraries for C++. Any CodeQL library file (a file with a <code>.qll</code> extension) defined in this pack will be available to queries in the <code>my-github-user/my-custom-queries</code> pack.</p>
<h3><a href="#codeql-packs-for-custom-tests">CodeQL packs for custom tests</a></h3>
<p>For custom CodeQL packs containing test files, you also need to include an
<code>extractor</code> property so that the <code>test run</code> command knows how to create test
databases. You may also wish to specify the <code>tests</code> property.</p>
<p>The following <code>qlpack.yml</code> file states that <code>my-github-user/my-query-tests</code> depends on <code>my-github-user/my-custom-queries</code> at a version greater than or equal to 1.2.3 and less than 2.0.0. It also declares that the CLI should use the Java <code>extractor</code> when creating test databases. The <code>tests: .</code> line declares that all <code>.ql</code> files in the pack should be run as tests when <code>codeql test run</code> is run with the <code>--strict-test-discovery</code> option. Typically, test packs do not contain a <code>version</code> property. This prevents you from accidentally publishing them.</p>
<pre><code><span>name:</span> <span>my-github-user/my-query-tests</span>
<span>dependencies:</span>
  <span>my-github-user/my-custom-queries:</span> <span>^1.2.3</span>
<span>extractor:</span> <span>java-kotlin</span>
<span>tests:</span> <span>.</span>
</code></pre>
<p>For more information about running tests, see <a href="/en/code-security/codeql-cli/using-the-advanced-functionality-of-the-codeql-cli/testing-custom-queries">Testing custom queries</a>.</p>
<h2><a href="#examples-of-codeql-packs-in-the-codeql-repository">Examples of CodeQL packs in the CodeQL repository</a></h2>
<p>Each of the languages in the CodeQL repository has four main CodeQL packs:</p>
<ul>
<li>
<p>Core library pack for the language, with the database schema
used by the language, and CodeQL libraries, and queries at <code>&lt;language&gt;/ql/lib</code></p>
</li>
<li>
<p>Core query pack for the language that includes the default queries for the language, along
with their query suites at <code>&lt;language&gt;/ql/src</code></p>
</li>
<li>
<p>Tests for the core language libraries and queries at <code>&lt;language&gt;/ql/test</code></p>
</li>
<li>
<p>Example queries for the language at <code>&lt;language&gt;/ql/examples</code></p>
</li>
</ul>
<h3><a href="#core-library-pack">Core library pack</a></h3>
<p>Here is an example <code>qlpack.yml</code> file for the <a href="https://github.com/github/codeql/blob/main/cpp/ql/lib/qlpack.yml">C/C++ analysis libraries</a>
core language pack:</p>
<pre><code><span>name:</span> <span>codeql/cpp-all</span>
<span>version:</span> <span>x.y.z-dev</span>
<span>dbscheme:</span> <span>semmlecode.cpp.dbscheme</span>
<span>library:</span> <span>true</span>
<span>upgrades:</span> <span>upgrades</span>
</code></pre>
<p>Some extra notes on the following properties:</p>
<ul>
<li>
<p><code>library</code>: Indicates that this is a library pack with no executable queries. It is only meant to be used as a dependency for other packs.</p>
</li>
<li>
<p><code>dbscheme</code> and <code>upgrades</code>: These properties are internal to the CodeQL CLI and should only be defined in the core CodeQL query pack for a language.</p>
</li>
</ul>
<h3><a href="#core-query-pack">Core query pack</a></h3>
<p>Here is an example <code>qlpack.yml</code> file for <a href="https://github.com/github/codeql/blob/main/cpp/ql/src/qlpack.yml">C/C++ analysis queries</a>
core query pack:</p>
<pre><code><span>name:</span> <span>codeql/cpp-queries</span>
<span>version:</span> <span>x.y.z-dev</span>
<span>dependencies:</span>
    <span>codeql/cpp-all:</span> <span>"*"</span>
    <span>codeql/suite-helpers:</span> <span>"*"</span>
<span>suites:</span> <span>codeql-suites</span>
<span>defaultSuiteFile:</span> <span>codeql-suites/cpp-code-scanning.qls</span>
</code></pre>
<p>Some extra notes on the following properties:</p>
<ul>
<li>
<p><code>dependencies</code>: This query pack depends on <code>codeql/cpp-all</code> and <code>codeql/suite-helpers</code>. Since these dependencies are resolved from source, it does not matter what version of the CodeQL pack they are compatible with. For more information about resolving dependencies from source, see <a href="/en/code-security/codeql-cli/using-the-advanced-functionality-of-the-codeql-cli/about-codeql-workspaces#source-dependencies">Source Dependencies</a>.</p>
</li>
<li>
<p><code>suites</code>: Indicates the directory containing "well-known" query suites.</p>
</li>
<li>
<p><code>defaultSuiteFile</code>: The name of the default query suite file that is used when no query suite is specified.</p>
</li>
</ul>
<h3><a href="#tests-for-the-core-codeql-pack">Tests for the core CodeQL pack</a></h3>
<p>Here is an example <code>qlpack.yml</code> file for <a href="https://github.com/github/codeql/blob/main/cpp/ql/src/qlpack.yml">C/C++ analysis tests</a>
core test pack:</p>
<pre><code><span>name:</span> <span>codeql/cpp-tests</span>
<span>dependencies:</span>
  <span>codeql/cpp-all:</span> <span>"*"</span>
  <span>codeql/cpp-queries:</span> <span>"*"</span>
<span>extractor:</span> <span>cpp</span>
<span>tests:</span> <span>.</span>
</code></pre>
<p>Some extra notes on the following properties:</p>
<ul>
<li>
<p><code>dependencies</code>: This pack depends on the core CodeQL query and library packs for C++.</p>
</li>
<li>
<p><code>extractor</code>: This specifies that all the tests will use the same C++ extractor to create the database for the tests.</p>
</li>
<li>
<p><code>tests</code>: This specifies the location of the tests. In this case, the tests are in the root folder (and all sub-folders) of the pack.</p>
</li>
<li>
<p><code>version</code>: There is no <code>version</code> property for the tests pack. This prevents test packs from accidentally being published.</p>
</li>
</ul>
</div></div></div>
</div>
</div></main>
</div></body></html>