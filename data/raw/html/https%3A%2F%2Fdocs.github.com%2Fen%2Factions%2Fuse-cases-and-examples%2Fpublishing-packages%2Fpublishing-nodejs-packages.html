<html><body><div>
<main><div>
<div><nav><ul>
<li>
<a title="GitHub Actions" href="/en/actions">GitHub Actions</a><span>/</span>
</li>
<li>
<a title="Use cases and examples" href="/en/actions/use-cases-and-examples">Use cases and examples</a><span>/</span>
</li>
<li>
<a title="Publish packages" href="/en/actions/use-cases-and-examples/publishing-packages">Publish packages</a><span>/</span>
</li>
<li><a title="Publish Node.js packages" href="/en/actions/use-cases-and-examples/publishing-packages/publishing-nodejs-packages">Publish Node.js packages</a></li>
</ul></nav></div>
<div>
<div><div><h1>Publishing Node.js packages</h1></div></div>
<div><div><p>You can publish Node.js packages to a registry as part of your continuous integration (CI) workflow.</p></div></div>
<div>
<h2>In this article</h2>
<nav><ul>
<li><a href="#introduction"><div><span>Introduction</span></div></a></li>
<li><a href="#prerequisites"><div><span>Prerequisites</span></div></a></li>
<li><a href="#about-package-configuration"><div><span>About package configuration</span></div></a></li>
<li><a href="#publishing-packages-to-the-npm-registry"><div><span>Publishing packages to the npm registry</span></div></a></li>
<li><a href="#publishing-packages-to-github-packages"><div><span>Publishing packages to GitHub Packages</span></div></a></li>
<li><a href="#publishing-packages-using-yarn"><div><span>Publishing packages using Yarn</span></div></a></li>
</ul></nav>
</div>
<div><div><div>
<h2><a href="#introduction">Introduction</a></h2>
<p>This guide shows you how to create a workflow that publishes Node.js packages to the GitHub Packages and npm registries after continuous integration (CI) tests pass.</p>
<h2><a href="#prerequisites">Prerequisites</a></h2>
<p>We recommend that you have a basic understanding of workflow configuration options and how to create a workflow file. For more information, see <a href="/en/actions/learn-github-actions">Writing workflows</a>.</p>
<p>For more information about creating a CI workflow for your Node.js project, see <a href="/en/actions/automating-builds-and-tests/building-and-testing-nodejs">Building and testing Node.js</a>.</p>
<p>You may also find it helpful to have a basic understanding of the following:</p>
<ul>
<li><a href="/en/packages/working-with-a-github-packages-registry/working-with-the-npm-registry">Working with the npm registry</a></li>
<li><a href="/en/actions/learn-github-actions/variables">Store information in variables</a></li>
<li><a href="/en/actions/security-guides/using-secrets-in-github-actions">Using secrets in GitHub Actions</a></li>
<li><a href="/en/actions/security-guides/automatic-token-authentication">Automatic token authentication</a></li>
</ul>
<h2><a href="#about-package-configuration">About package configuration</a></h2>
<p>The <code>name</code> and <code>version</code> fields in the <code>package.json</code> file create a unique identifier that registries use to link your package to a registry. You can add a summary for the package listing page by including a <code>description</code> field in the <code>package.json</code> file. For more information, see <a href="https://docs.npmjs.com/creating-a-package-json-file">Creating a package.json file</a> and <a href="https://docs.npmjs.com/creating-node-js-modules">Creating Node.js modules</a> in the npm documentation.</p>
<p>When a local <code>.npmrc</code> file exists and has a <code>registry</code> value specified, the <code>npm publish</code> command uses the registry configured in the <code>.npmrc</code> file. You can use the <code>setup-node</code> action to create a local <code>.npmrc</code> file on the runner that configures the default registry and scope. The <code>setup-node</code> action also accepts an authentication token as input, used to access private registries or publish node packages. For more information, see <a href="https://github.com/actions/setup-node/"><code>setup-node</code></a>.</p>
<p>You can specify the Node.js version installed on the runner using the <code>setup-node</code> action.</p>
<p>If you add steps in your workflow to configure the <code>publishConfig</code> fields in your <code>package.json</code> file, you don't need to specify the registry-url using the <code>setup-node</code> action, but you will be limited to publishing the package to one registry. For more information, see <a href="https://docs.npmjs.com/cli/v9/configuring-npm/package-json#publishconfig">publishConfig</a> in the npm documentation.</p>
<h2><a href="#publishing-packages-to-the-npm-registry">Publishing packages to the npm registry</a></h2>
<p>You can trigger a workflow to publish your package every time you publish a new release. The process in the following example is executed when the release event of type <code>published</code> is triggered. If the CI tests pass, the process uploads the package to the npm registry. For more information, see <a href="/en/repositories/releasing-projects-on-github/managing-releases-in-a-repository#creating-a-release">Managing releases in a repository</a>.</p>
<p>To perform authenticated operations against the npm registry in your workflow, you'll need to store your npm authentication token as a secret. For example, create a repository secret called <code>NPM_TOKEN</code>. For more information, see <a href="/en/actions/security-guides/using-secrets-in-github-actions">Using secrets in GitHub Actions</a>.</p>
<p>By default, npm uses the <code>name</code> field of the <code>package.json</code> file to determine the name of your published package. When publishing to a global namespace, you only need to include the package name. For example, you would publish a package named <code>my-package</code> to <code>https://www.npmjs.com/package/my-package</code>.</p>
<p>If you're publishing a package that includes a scope prefix, include the scope in the name of your <code>package.json</code> file. For example, if your npm scope prefix is "octocat" and the package name is "hello-world", the <code>name</code> in your <code>package.json</code> file should be <code>@octocat/hello-world</code>. If your npm package uses a scope prefix and the package is public, you need to use the option <code>npm publish --access public</code>. This is an option that npm requires to prevent someone from publishing a private package unintentionally.</p>
<p>If you would like to publish your package with provenance, include the <code>--provenance</code> flag with your <code>npm publish</code> command. This allows you to publicly and verifiably establish where and how your package was built, which increases supply chain security for people who consume your package. For more information, see <a href="https://docs.npmjs.com/generating-provenance-statements">Generating provenance statements</a> in the npm documentation.</p>
<p>This example stores the <code>NPM_TOKEN</code> secret in the <code>NODE_AUTH_TOKEN</code> environment variable. When the <code>setup-node</code> action creates an <code>.npmrc</code> file, it references the token from the <code>NODE_AUTH_TOKEN</code> environment variable.</p>
<div>
<header><span>YAML</span><pre>name: Publish Package to npmjs
on:
  release:
    types: [published]
jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      id-token: write
    steps:
      - uses: actions/checkout@v4
      # Setup .npmrc file to publish to npm
      - uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          registry-url: 'https://registry.npmjs.org'
      - run: npm ci
      - run: npm publish --provenance --access public
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
</pre></header><pre><code><span>name:</span> <span>Publish</span> <span>Package</span> <span>to</span> <span>npmjs</span>
<span>on:</span>
  <span>release:</span>
    <span>types:</span> [<span>published</span>]
<span>jobs:</span>
  <span>build:</span>
    <span>runs-on:</span> <span>ubuntu-latest</span>
    <span>permissions:</span>
      <span>contents:</span> <span>read</span>
      <span>id-token:</span> <span>write</span>
    <span>steps:</span>
      <span>-</span> <span>uses:</span> <span>actions/checkout@v4</span>
      <span># Setup .npmrc file to publish to npm</span>
      <span>-</span> <span>uses:</span> <span>actions/setup-node@v4</span>
        <span>with:</span>
          <span>node-version:</span> <span>'20.x'</span>
          <span>registry-url:</span> <span>'https://registry.npmjs.org'</span>
      <span>-</span> <span>run:</span> <span>npm</span> <span>ci</span>
      <span>-</span> <span>run:</span> <span>npm</span> <span>publish</span> <span>--provenance</span> <span>--access</span> <span>public</span>
        <span>env:</span>
          <span>NODE_AUTH_TOKEN:</span> <span>${{</span> <span>secrets.NPM_TOKEN</span> <span>}}</span>
</code></pre>
</div>
<p>In the example above, the <code>setup-node</code> action creates an <code>.npmrc</code> file on the runner with the following contents:</p>
<pre><code>//registry.npmjs.org/:_authToken=${NODE_AUTH_TOKEN}
registry=https://registry.npmjs.org/
always-auth=true
</code></pre>
<p>Please note that you need to set the <code>registry-url</code> to <code>https://registry.npmjs.org/</code> in <code>setup-node</code> to properly configure your credentials.</p>
<h2><a href="#publishing-packages-to-github-packages">Publishing packages to GitHub Packages</a></h2>
<p>You can trigger a workflow to publish your package every time you publish a new release. The process in the following example is executed when the release event of type <code>published</code> is triggered. If the CI tests pass, the process uploads the package to GitHub Packages. For more information, see <a href="/en/repositories/releasing-projects-on-github/managing-releases-in-a-repository#creating-a-release">Managing releases in a repository</a>.</p>
<h3><a href="#configuring-the-destination-repository">Configuring the destination repository</a></h3>
<p>Linking your package to GitHub Packages using the <code>repository</code> key is optional. If you choose not to provide the <code>repository</code> key in your <code>package.json</code> file, then your package will not be linked to a repository when it is published, but you can choose to connect the package to a repository later.</p>
<p>If you do provide the <code>repository</code> key in your <code>package.json</code> file, then the repository in that key is used as the destination npm registry for GitHub Packages. For example, publishing the below <code>package.json</code> results in a package named <code>my-package</code> published to the <code>octocat/my-other-repo</code> GitHub repository.</p>
<pre><code><span>{</span>
  <span>"name"</span><span>:</span> <span>"@octocat/my-package"</span><span>,</span>
  <span>"repository"</span><span>:</span> <span>{</span>
    <span>"type"</span><span>:</span> <span>"git"</span><span>,</span>
    <span>"url"</span><span>:</span> <span>"https://github.com/octocat/my-other-repo.git"</span>
  <span>}</span><span>,</span>
</code></pre>
<h3><a href="#authenticating-to-the-destination-repository">Authenticating to the destination repository</a></h3>
<p>To perform authenticated operations against the GitHub Packages registry in your workflow, you can use the <code>GITHUB_TOKEN</code>. The <code>GITHUB_TOKEN</code> secret is set to an access token for the repository each time a job in a workflow begins. You should set the permissions for this access token in the workflow file to grant read access for the <code>contents</code> permission and write access for the <code>packages</code> permission. For more information, see <a href="/en/actions/security-guides/automatic-token-authentication">Automatic token authentication</a>.</p>
<p>If you want to publish your package to a different repository, you must use a personal access token (classic) that has permission to write to packages in the destination repository. For more information, see <a href="/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token">Managing your personal access tokens</a> and <a href="/en/actions/security-guides/using-secrets-in-github-actions">Using secrets in GitHub Actions</a>.</p>
<h3><a href="#example-workflow">Example workflow</a></h3>
<p>This example stores the <code>GITHUB_TOKEN</code> secret in the <code>NODE_AUTH_TOKEN</code> environment variable. When the <code>setup-node</code> action creates an <code>.npmrc</code> file, it references the token from the <code>NODE_AUTH_TOKEN</code> environment variable.</p>
<div>
<header><span>YAML</span><pre>name: Publish package to GitHub Packages
on:
  release:
    types: [published]
jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    steps:
      - uses: actions/checkout@v4
      # Setup .npmrc file to publish to GitHub Packages
      - uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          registry-url: 'https://npm.pkg.github.com'
          # Defaults to the user or organization that owns the workflow file
          scope: '@octocat'
      - run: npm ci
      - run: npm publish
        env:
          NODE_AUTH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
</pre></header><pre><code><span>name:</span> <span>Publish</span> <span>package</span> <span>to</span> <span>GitHub</span> <span>Packages</span>
<span>on:</span>
  <span>release:</span>
    <span>types:</span> [<span>published</span>]
<span>jobs:</span>
  <span>build:</span>
    <span>runs-on:</span> <span>ubuntu-latest</span>
    <span>permissions:</span>
      <span>contents:</span> <span>read</span>
      <span>packages:</span> <span>write</span>
    <span>steps:</span>
      <span>-</span> <span>uses:</span> <span>actions/checkout@v4</span>
      <span># Setup .npmrc file to publish to GitHub Packages</span>
      <span>-</span> <span>uses:</span> <span>actions/setup-node@v4</span>
        <span>with:</span>
          <span>node-version:</span> <span>'20.x'</span>
          <span>registry-url:</span> <span>'https://npm.pkg.github.com'</span>
          <span># Defaults to the user or organization that owns the workflow file</span>
          <span>scope:</span> <span>'@octocat'</span>
      <span>-</span> <span>run:</span> <span>npm</span> <span>ci</span>
      <span>-</span> <span>run:</span> <span>npm</span> <span>publish</span>
        <span>env:</span>
          <span>NODE_AUTH_TOKEN:</span> <span>${{</span> <span>secrets.GITHUB_TOKEN</span> <span>}}</span>
</code></pre>
</div>
<p>The <code>setup-node</code> action creates an <code>.npmrc</code> file on the runner. When you use the <code>scope</code> input to the <code>setup-node</code> action, the <code>.npmrc</code> file includes the scope prefix. By default, the <code>setup-node</code> action sets the scope in the <code>.npmrc</code> file to the account that contains that workflow file.</p>
<pre><code>//npm.pkg.github.com/:_authToken=${NODE_AUTH_TOKEN}
@octocat:registry=https://npm.pkg.github.com
always-auth=true
</code></pre>
<h2><a href="#publishing-packages-using-yarn">Publishing packages using Yarn</a></h2>
<p>If you use the Yarn package manager, you can install and publish packages using Yarn.</p>
<div>
<header><span>YAML</span><pre>name: Publish Package to npmjs
on:
  release:
    types: [published]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      # Setup .npmrc file to publish to npm
      - uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          registry-url: 'https://registry.npmjs.org'
          # Defaults to the user or organization that owns the workflow file
          scope: '@octocat'
      - run: yarn
      - run: yarn npm publish // for Yarn version 1, use `yarn publish` instead
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
</pre></header><pre><code><span>name:</span> <span>Publish</span> <span>Package</span> <span>to</span> <span>npmjs</span>
<span>on:</span>
  <span>release:</span>
    <span>types:</span> [<span>published</span>]
<span>jobs:</span>
  <span>build:</span>
    <span>runs-on:</span> <span>ubuntu-latest</span>
    <span>steps:</span>
      <span>-</span> <span>uses:</span> <span>actions/checkout@v4</span>
      <span># Setup .npmrc file to publish to npm</span>
      <span>-</span> <span>uses:</span> <span>actions/setup-node@v4</span>
        <span>with:</span>
          <span>node-version:</span> <span>'20.x'</span>
          <span>registry-url:</span> <span>'https://registry.npmjs.org'</span>
          <span># Defaults to the user or organization that owns the workflow file</span>
          <span>scope:</span> <span>'@octocat'</span>
      <span>-</span> <span>run:</span> <span>yarn</span>
      <span>-</span> <span>run:</span> <span>yarn</span> <span>npm</span> <span>publish</span> <span>//</span> <span>for</span> <span>Yarn</span> <span>version</span> <span>1</span><span>,</span> <span>use</span> <span>`yarn</span> <span>publish`</span> <span>instead</span>
        <span>env:</span>
          <span>NODE_AUTH_TOKEN:</span> <span>${{</span> <span>secrets.NPM_TOKEN</span> <span>}}</span>
</code></pre>
</div>
<p>To authenticate with the registry during publishing, ensure your authentication token is also defined in your <code>yarnrc.yml</code> file. For more information, see the <a href="https://yarnpkg.com/configuration/yarnrc#npmAuthToken">Settings</a> article in the Yarn documentation.</p>
</div></div></div>
</div>
</div></main>
</div></body></html>