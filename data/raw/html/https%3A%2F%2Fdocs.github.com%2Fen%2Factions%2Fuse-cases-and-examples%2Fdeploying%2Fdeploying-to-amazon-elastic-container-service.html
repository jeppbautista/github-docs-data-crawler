<html><body><div>
<main><div>
<div><nav><ul>
<li>
<a title="GitHub Actions" href="/en/actions">GitHub Actions</a><span>/</span>
</li>
<li>
<a title="Use cases and examples" href="/en/actions/use-cases-and-examples">Use cases and examples</a><span>/</span>
</li>
<li>
<a title="Deployment" href="/en/actions/use-cases-and-examples/deploying">Deployment</a><span>/</span>
</li>
<li><a title="Deploy to Amazon ECS" href="/en/actions/use-cases-and-examples/deploying/deploying-to-amazon-elastic-container-service">Deploy to Amazon ECS</a></li>
</ul></nav></div>
<div>
<div><div><h1>Deploying to Amazon Elastic Container Service</h1></div></div>
<div><div><p>You can deploy to Amazon Elastic Container Service (ECS) as part of your continuous deployment (CD) workflows.</p></div></div>
<div>
<h2>In this article</h2>
<nav><ul>
<li><a href="#introduction"><div><span>Introduction</span></div></a></li>
<li><a href="#prerequisites"><div><span>Prerequisites</span></div></a></li>
<li><a href="#creating-the-workflow"><div><span>Creating the workflow</span></div></a></li>
<li><a href="#additional-resources"><div><span>Additional resources</span></div></a></li>
</ul></nav>
</div>
<div><div><div>
<h2><a href="#introduction">Introduction</a></h2>
<p>This guide explains how to use GitHub Actions to build a containerized application, push it to <a href="https://aws.amazon.com/ecr/">Amazon Elastic Container Registry (ECR)</a>, and deploy it to <a href="https://aws.amazon.com/ecs/">Amazon Elastic Container Service (ECS)</a> when there is a push to the <code>main</code> branch.</p>
<p>On every new push to <code>main</code> in your GitHub repository, the GitHub Actions workflow builds and pushes a new container image to Amazon ECR, and then deploys a new task definition to Amazon ECS.</p>
<div>
<p>
If your GitHub Actions workflows need to access resources from a cloud provider that supports OpenID Connect (OIDC), you can configure your workflows to authenticate directly to the cloud provider. This will let you stop storing these credentials as long-lived secrets and provide other security benefits. For more information, see <a href="/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect">About security hardening with OpenID Connect</a>. and <a href="/en/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-amazon-web-services">Configuring OpenID Connect in Amazon Web Services</a>.</p>
</div>
<h2><a href="#prerequisites">Prerequisites</a></h2>
<p>Before creating your GitHub Actions workflow, you will first need to complete the following setup steps for Amazon ECR and ECS:</p>
<ol>
<li>
<p>Create an Amazon ECR repository to store your images.</p>
<p>For example, using <a href="https://aws.amazon.com/cli/">the AWS CLI</a>:</p>
<div>
<header><span>Bash</span><pre>aws ecr create-repository \
    --repository-name MY_ECR_REPOSITORY \
    --region MY_AWS_REGION

</pre></header><pre><code>aws ecr create-repository \
    --repository-name MY_ECR_REPOSITORY \
    --region MY_AWS_REGION

</code></pre>
</div>
<p>Ensure that you use the same Amazon ECR repository name (represented here by <code>MY_ECR_REPOSITORY</code>) for the <code>ECR_REPOSITORY</code> variable in the workflow below.</p>
<p>Ensure that you use the same AWS region value for the <code>AWS_REGION</code> (represented here by <code>MY_AWS_REGION</code>) variable in the workflow below.</p>
</li>
<li>
<p>Create an Amazon ECS task definition, cluster, and service.</p>
<p>For details, follow the <a href="https://us-east-2.console.aws.amazon.com/ecs/home?region=us-east-2#/firstRun">Getting started wizard on the Amazon ECS console</a>, or the <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/getting-started-fargate.html">Getting started guide</a> in the Amazon ECS documentation.</p>
<p>Ensure that you note the names you set for the Amazon ECS service and cluster, and use them for the <code>ECS_SERVICE</code> and <code>ECS_CLUSTER</code> variables in the workflow below.</p>
</li>
<li>
<p>Store your Amazon ECS task definition as a JSON file in your GitHub repository.</p>
<p>The format of the file should be the same as the output generated by:</p>
<div>
<header><span>Bash</span><pre>aws ecs register-task-definition --generate-cli-skeleton

</pre></header><pre><code>
aws ecs register-task-definition --generate-cli-skeleton

</code></pre>
</div>
<p>Ensure that you set the <code>ECS_TASK_DEFINITION</code> variable in the workflow below as the path to the JSON file.</p>
<p>Ensure that you set the <code>CONTAINER_NAME</code> variable in the workflow below as the container name in the <code>containerDefinitions</code> section of the task definition.</p>
</li>
<li>
<p>Create GitHub Actions secrets named <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code> to store the values for your Amazon IAM access key.</p>
<p>For more information on creating secrets for GitHub Actions, see <a href="/en/actions/security-guides/using-secrets-in-github-actions#creating-secrets-for-a-repository">Using secrets in GitHub Actions</a>.</p>
<p>See the documentation for each action used below for the recommended IAM policies for the IAM user, and methods for handling the access key credentials.</p>
</li>
<li>
<p>Optionally, configure a deployment environment. Environments are used to describe a general deployment target like <code>production</code>, <code>staging</code>, or <code>development</code>. When a GitHub Actions workflow deploys to an environment, the environment is displayed on the main page of the repository. You can use environments to require approval for a job to proceed, restrict which branches can trigger a workflow, gate deployments with custom deployment protection rules, or limit access to secrets. For more information about creating environments, see <a href="/en/actions/deployment/targeting-different-environments/managing-environments-for-deployment">Managing environments for deployment</a>.</p>
</li>
</ol>
<h2><a href="#creating-the-workflow">Creating the workflow</a></h2>
<p>Once you've completed the prerequisites, you can proceed with creating the workflow.</p>
<p>The following example workflow demonstrates how to build a container image and push it to Amazon ECR. It then updates the task definition with the new image ID, and deploys the task definition to Amazon ECS.</p>
<p>Ensure that you provide your own values for all the variables in the <code>env</code> key of the workflow.</p>
<p>If you configured a deployment environment, change the value of <code>environment</code> to be the name of your environment. If you did not configure an environment or if your workflow is in a private repository and you do not use GitHub Enterprise Cloud, delete the <code>environment</code> key.</p>
<div>
<header><span>YAML</span><pre># This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

# GitHub recommends pinning actions to a commit SHA.
# To get a newer version, you will need to update the SHA.
# You can also reference a tag or branch, but the action may change without warning.

name: Deploy to Amazon ECS

on:
  push:
    branches:
      - main

env:
  AWS_REGION: MY_AWS_REGION                   # set this to your preferred AWS region, e.g. us-west-1
  ECR_REPOSITORY: MY_ECR_REPOSITORY           # set this to your Amazon ECR repository name
  ECS_SERVICE: MY_ECS_SERVICE                 # set this to your Amazon ECS service name
  ECS_CLUSTER: MY_ECS_CLUSTER                 # set this to your Amazon ECS cluster name
  ECS_TASK_DEFINITION: MY_ECS_TASK_DEFINITION # set this to the path to your Amazon ECS task definition
                                               # file, e.g. .aws/task-definition.json
  CONTAINER_NAME: MY_CONTAINER_NAME           # set this to the name of the container in the
                                               # containerDefinitions section of your task definition

jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest
    environment: production

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@0e613a0980cbf65ed5b322eb7a1e075d28913a83
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ${{ env.AWS_REGION }}

      - name: Login to Amazon ECR
        id: login-ecr
        uses: aws-actions/amazon-ecr-login@62f4f872db3836360b72999f4b87f1ff13310f3a

      - name: Build, tag, and push image to Amazon ECR
        id: build-image
        env:
          ECR_REGISTRY: ${{ steps.login-ecr.outputs.registry }}
          IMAGE_TAG: ${{ github.sha }}
        run: |
          # Build a docker container and
          # push it to ECR so that it can
          # be deployed to ECS.
          docker build -t $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG .
          docker push $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG
          echo "image=$ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG" &gt;&gt; $GITHUB_OUTPUT

      - name: Fill in the new image ID in the Amazon ECS task definition
        id: task-def
        uses: aws-actions/amazon-ecs-render-task-definition@c804dfbdd57f713b6c079302a4c01db7017a36fc
        with:
          task-definition: ${{ env.ECS_TASK_DEFINITION }}
          container-name: ${{ env.CONTAINER_NAME }}
          image: ${{ steps.build-image.outputs.image }}

      - name: Deploy Amazon ECS task definition
        uses: aws-actions/amazon-ecs-deploy-task-definition@df9643053eda01f169e64a0e60233aacca83799a
        with:
          task-definition: ${{ steps.task-def.outputs.task-definition }}
          service: ${{ env.ECS_SERVICE }}
          cluster: ${{ env.ECS_CLUSTER }}
          wait-for-service-stability: true
</pre></header><pre><code><span># This workflow uses actions that are not certified by GitHub.</span>
<span># They are provided by a third-party and are governed by</span>
<span># separate terms of service, privacy policy, and support</span>
<span># documentation.</span>

<span># GitHub recommends pinning actions to a commit SHA.</span>
<span># To get a newer version, you will need to update the SHA.</span>
<span># You can also reference a tag or branch, but the action may change without warning.</span>

<span>name:</span> <span>Deploy</span> <span>to</span> <span>Amazon</span> <span>ECS</span>

<span>on:</span>
  <span>push:</span>
    <span>branches:</span>
      <span>-</span> <span>main</span>

<span>env:</span>
  <span>AWS_REGION:</span> <span>MY_AWS_REGION</span>                   <span># set this to your preferred AWS region, e.g. us-west-1</span>
  <span>ECR_REPOSITORY:</span> <span>MY_ECR_REPOSITORY</span>           <span># set this to your Amazon ECR repository name</span>
  <span>ECS_SERVICE:</span> <span>MY_ECS_SERVICE</span>                 <span># set this to your Amazon ECS service name</span>
  <span>ECS_CLUSTER:</span> <span>MY_ECS_CLUSTER</span>                 <span># set this to your Amazon ECS cluster name</span>
  <span>ECS_TASK_DEFINITION:</span> <span>MY_ECS_TASK_DEFINITION</span> <span># set this to the path to your Amazon ECS task definition</span>
                                               <span># file, e.g. .aws/task-definition.json</span>
  <span>CONTAINER_NAME:</span> <span>MY_CONTAINER_NAME</span>           <span># set this to the name of the container in the</span>
                                               <span># containerDefinitions section of your task definition</span>

<span>jobs:</span>
  <span>deploy:</span>
    <span>name:</span> <span>Deploy</span>
    <span>runs-on:</span> <span>ubuntu-latest</span>
    <span>environment:</span> <span>production</span>

    <span>steps:</span>
      <span>-</span> <span>name:</span> <span>Checkout</span>
        <span>uses:</span> <span>actions/checkout@v4</span>

      <span>-</span> <span>name:</span> <span>Configure</span> <span>AWS</span> <span>credentials</span>
        <span>uses:</span> <span>aws-actions/configure-aws-credentials@0e613a0980cbf65ed5b322eb7a1e075d28913a83</span>
        <span>with:</span>
          <span>aws-access-key-id:</span> <span>${{</span> <span>secrets.AWS_ACCESS_KEY_ID</span> <span>}}</span>
          <span>aws-secret-access-key:</span> <span>${{</span> <span>secrets.AWS_SECRET_ACCESS_KEY</span> <span>}}</span>
          <span>aws-region:</span> <span>${{</span> <span>env.AWS_REGION</span> <span>}}</span>

      <span>-</span> <span>name:</span> <span>Login</span> <span>to</span> <span>Amazon</span> <span>ECR</span>
        <span>id:</span> <span>login-ecr</span>
        <span>uses:</span> <span>aws-actions/amazon-ecr-login@62f4f872db3836360b72999f4b87f1ff13310f3a</span>

      <span>-</span> <span>name:</span> <span>Build,</span> <span>tag,</span> <span>and</span> <span>push</span> <span>image</span> <span>to</span> <span>Amazon</span> <span>ECR</span>
        <span>id:</span> <span>build-image</span>
        <span>env:</span>
          <span>ECR_REGISTRY:</span> <span>${{</span> <span>steps.login-ecr.outputs.registry</span> <span>}}</span>
          <span>IMAGE_TAG:</span> <span>${{</span> <span>github.sha</span> <span>}}</span>
        <span>run:</span> <span>|
          # Build a docker container and
          # push it to ECR so that it can
          # be deployed to ECS.
          docker build -t $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG .
          docker push $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG
          echo "image=$ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG" &gt;&gt; $GITHUB_OUTPUT
</span>
      <span>-</span> <span>name:</span> <span>Fill</span> <span>in</span> <span>the</span> <span>new</span> <span>image</span> <span>ID</span> <span>in</span> <span>the</span> <span>Amazon</span> <span>ECS</span> <span>task</span> <span>definition</span>
        <span>id:</span> <span>task-def</span>
        <span>uses:</span> <span>aws-actions/amazon-ecs-render-task-definition@c804dfbdd57f713b6c079302a4c01db7017a36fc</span>
        <span>with:</span>
          <span>task-definition:</span> <span>${{</span> <span>env.ECS_TASK_DEFINITION</span> <span>}}</span>
          <span>container-name:</span> <span>${{</span> <span>env.CONTAINER_NAME</span> <span>}}</span>
          <span>image:</span> <span>${{</span> <span>steps.build-image.outputs.image</span> <span>}}</span>

      <span>-</span> <span>name:</span> <span>Deploy</span> <span>Amazon</span> <span>ECS</span> <span>task</span> <span>definition</span>
        <span>uses:</span> <span>aws-actions/amazon-ecs-deploy-task-definition@df9643053eda01f169e64a0e60233aacca83799a</span>
        <span>with:</span>
          <span>task-definition:</span> <span>${{</span> <span>steps.task-def.outputs.task-definition</span> <span>}}</span>
          <span>service:</span> <span>${{</span> <span>env.ECS_SERVICE</span> <span>}}</span>
          <span>cluster:</span> <span>${{</span> <span>env.ECS_CLUSTER</span> <span>}}</span>
          <span>wait-for-service-stability:</span> <span>true</span>
</code></pre>
</div>
<h2><a href="#additional-resources">Additional resources</a></h2>
<p>For the original workflow template, see <a href="https://github.com/actions/starter-workflows/blob/main/deployments/aws.yml"><code>aws.yml</code></a> in the GitHub Actions <code>starter-workflows</code> repository.</p>
<p>For more information on the services used in these examples, see the following documentation:</p>
<ul>
<li>
<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html">Security best practices in IAM</a> in the Amazon AWS documentation.</li>
<li>Official AWS <a href="https://github.com/aws-actions/configure-aws-credentials">Configure AWS Credentials</a> action.</li>
<li>Official AWS <a href="https://github.com/aws-actions/amazon-ecr-login">Amazon ECR "Login"</a> action.</li>
<li>Official AWS <a href="https://github.com/aws-actions/amazon-ecs-render-task-definition">Amazon ECS "Render Task Definition"</a> action.</li>
<li>Official AWS <a href="https://github.com/aws-actions/amazon-ecs-deploy-task-definition">Amazon ECS "Deploy Task Definition"</a> action.</li>
</ul>
</div></div></div>
</div>
</div></main>
</div></body></html>