<html><body><div>
<main><div>
<div><nav><ul>
<li>
<a title="Secure coding" href="/en/code-security">Secure coding</a><span>/</span>
</li>
<li>
<a title="CodeQL CLI" href="/en/code-security/codeql-cli">CodeQL CLI</a><span>/</span>
</li>
<li>
<a title="Advanced functionality" href="/en/code-security/codeql-cli/using-the-advanced-functionality-of-the-codeql-cli">Advanced functionality</a><span>/</span>
</li>
<li><a title="Creating CodeQL query suites" href="/en/code-security/codeql-cli/using-the-advanced-functionality-of-the-codeql-cli/creating-codeql-query-suites">Creating CodeQL query suites</a></li>
</ul></nav></div>
<div>
<div><div><h1>Creating CodeQL query suites</h1></div></div>
<div>
<div><p>You can create query suites for queries you frequently use in your CodeQL analyses.</p></div>
<div><div>
<div><h2>Who can use this feature?</h2></div>
<div><div>
<p>CodeQL is available for the following repository types:</p>
<ul>
<li>Public repositories on GitHub.com, see <a href="https://github.com/github/codeql-cli-binaries/blob/main/LICENSE.md">GitHub CodeQL Terms and Conditions</a>
</li>
<li>Organization-owned repositories on GitHub Team with <a href="/en/get-started/learning-about-github/about-github-advanced-security">GitHub Code Security</a> enabled</li>
</ul>
</div></div>
</div></div>
</div>
<div>
<h2>In this article</h2>
<nav><ul>
<li><a href="#about-creating-codeql-query-suites"><div><span>About creating CodeQL query suites</span></div></a></li>
<li><a href="#locating-queries-to-add-to-a-query-suite"><div><span>Locating queries to add to a query suite</span></div></a></li>
<li><a href="#filtering-the-queries-in-a-query-suite"><div><span>Filtering the queries in a query suite</span></div></a></li>
<li><a href="#reusing-existing-query-suite-definitions"><div><span>Reusing existing query suite definitions</span></div></a></li>
<li><a href="#naming-a-query-suite"><div><span>Naming a query suite</span></div></a></li>
<li><a href="#saving-a-query-suite"><div><span>Saving a query suite</span></div></a></li>
<li><a href="#using-query-suites-with-codeql"><div><span>Using query suites with CodeQL</span></div></a></li>
<li><a href="#further-reading"><div><span>Further reading</span></div></a></li>
</ul></nav>
</div>
<div><div><div>
<h2><a href="#about-creating-codeql-query-suites">About creating CodeQL query suites</a></h2>
<p>CodeQL query suites provide a way of selecting queries, based on their
filename, location on disk or in a CodeQL pack, or metadata properties.
Create query suites for the queries that you want to frequently use in
your CodeQL analyses.</p>
<p>Query suites allow you to pass multiple queries to CodeQL without having to specify the path to each query file individually. Query suite definitions are stored in YAML files with the extension <code>.qls</code>. A suite definition is a sequence of instructions, where each instruction is a YAML
mapping with (usually) a single key. The instructions are executed in the order
they appear in the query suite definition. After all the instructions in the
suite definition have been executed, the result is a set of selected queries.</p>
<div>
<p>
Any custom queries that you want to add to a query suite must be in a <a href="/en/code-security/codeql-cli/getting-started-with-the-codeql-cli/customizing-analysis-with-codeql-packs">CodeQL pack</a> and contain the correct query metadata. For more information, see <a href="/en/code-security/codeql-cli/using-the-advanced-functionality-of-the-codeql-cli/using-custom-queries-with-the-codeql-cli">Using custom queries with the CodeQL CLI</a>.</p>
</div>
<h2><a href="#locating-queries-to-add-to-a-query-suite">Locating queries to add to a query suite</a></h2>
<p>When creating a query suite, you first need to specify the locations of the
queries that you want to select. You can define the location of one or more
queries using:</p>
<ul>
<li>
<p>A <code>query</code> instruction: Tells CodeQL to look for one or more specified <code>.ql</code>
files:</p>
<pre><code><span>-</span> <span>query:</span> <span>&lt;path-to-query&gt;</span>
</code></pre>
<p>The argument must be one or more file paths, relative to the CodeQL pack containing
the suite definition.</p>
</li>
<li>
<p>A <code>queries</code> instruction: Tells CodeQL to recursively scan a directory
for <code>.ql</code> files:</p>
<pre><code><span>-</span> <span>queries:</span> <span>&lt;path-to-subdirectory&gt;</span>
</code></pre>
<p>The path of the directory must be relative to the root of the CodeQL pack that
contains the suite definition file. To find the queries relative to a
different CodeQL pack, add a <code>from</code> field:</p>
<pre><code><span>-</span> <span>queries:</span> <span>&lt;path-to-subdirectory&gt;</span>
  <span>from:</span> <span>&lt;ql-pack-name&gt;</span>
  <span>version:</span> <span>^x.y.z</span>
</code></pre>
<p>The <code>version</code> field is optional and specifies a range of compatible versions of this CodeQL pack.
If you don’t specify a version, then the most recent version of the pack is used.</p>
</li>
<li>
<p>A <code>qlpack</code> instruction: Tells CodeQL to resolve queries in the default suite of the
named CodeQL pack:</p>
<pre><code><span>-</span> <span>qlpack:</span> <span>&lt;qlpack-name&gt;</span>
  <span>version:</span> <span>^x.y.z</span>
</code></pre>
<p>The default suite of a query pack includes a recommended set of queries
inside of that query pack. Not all query packs have a default suite. If the given query pack does not define a default suite, the qlpack instruction will resolve to all of the queries within the pack.</p>
<p>The <code>version</code> field is optional and specifies a range of compatible versions of this CodeQL pack.
If you don’t specify a version, then the most recent version of the pack is used.</p>
</li>
</ul>
<div>
<p>
When pathnames appear in query suite definitions, they must always be given with a forward slash, <code>/</code>, as a directory separator. This ensures that query suite definitions work on all operating systems.</p>
</div>
<p>You must add at least one <code>query</code>, <code>queries</code>, or <code>qlpack</code> instruction to
your suite definition, otherwise no queries will be selected. If the suite
contains no further instructions, all the queries found from the list of files,
in the given directory, or in the named CodeQL pack are selected. If there are further
filtering instructions, only queries that match the constraints imposed by those
instructions will be selected.</p>
<h2><a href="#filtering-the-queries-in-a-query-suite">Filtering the queries in a query suite</a></h2>
<p>After you have defined the initial set of queries to add to your suite by
specifying <code>query</code>, <code>queries</code>, or <code>qlpack</code> instructions, you can add
<code>include</code> and <code>exclude</code> instructions. These instructions define selection
criteria based on specific properties:</p>
<ul>
<li>When you execute an <code>include</code> instruction on a set of queries, any
queries that match your conditions are retained in the selection, and queries
that don’t match are removed.</li>
<li>When you execute an <code>exclude</code> instructions on a set of queries,
any queries that match your conditions are removed from the selection, and queries
that don’t match are retained.</li>
</ul>
<p>The order of your filter instructions is important. The first filter instruction
that appears after the locating instructions determines whether the queries are
included or excluded by default. If the first filter is an <code>include</code>, the
initially located queries will only be part of the suite if they match an
explicit <code>include</code> filter. If the first filter is an <code>exclude</code>, the initially
located queries are part of the suite unless they are explicitly excluded.</p>
<p>Subsequent instructions are executed in order and the instructions that appear
later in the file take precedence over the earlier instructions. So, <code>include</code>
instructions can be overridden by a later <code>exclude</code> instructions that match
the same query. Similarly, <code>exclude</code>s can be overridden by a later
<code>include</code>.</p>
<p>For both instructions, the argument is a constraint block—that is, a YAML map
representing the constraints. Each constraint is a map entry, where the key is
typically a query metadata property. The value can be:</p>
<ul>
<li>A single string.</li>
<li>A <code>/</code>-enclosed <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/regex/Pattern.html">regular expression</a>.</li>
<li>A list containing strings, regular expressions, or both.</li>
</ul>
<p>To match a constraint, a metadata value must match one of the strings or
regular expressions. When there is more than one metadata key, each key must be matched.
The standard metadata keys available to match on are: <code>description</code>, <code>id</code>, <code>kind</code>,
<code>name</code>, <code>tags</code>, <code>precision</code>, and <code>problem.severity</code>.
For more information about query metadata properties, see
<a href="https://codeql.github.com/docs/writing-codeql-queries/metadata-for-codeql-queries/#metadata-for-codeql-queries">Metadata for CodeQL queries</a>.</p>
<p>In addition to metadata tags, the keys in the constraint block can also be:</p>
<ul>
<li>
<code>query filename</code>: Matches on the last path component of the query file name.</li>
<li>
<code>query path</code>: Matches on the path to the query file relative to its
enclosing CodeQL pack.</li>
<li>
<code>tags contain</code>: One of the given match strings must match
one of the space-separated components of the value of the <code>@tags</code> metadata property.</li>
<li>
<code>tags contain all</code>: Each of the given match strings must match one of the
components of the <code>@tags</code> metadata property.</li>
</ul>
<h3><a href="#examples-of-filtering-which-queries-are-run">Examples of filtering which queries are run</a></h3>
<p>A common use case is to create a query suite that runs all queries in a CodeQL pack,
except for a few specific queries that the user does not want to run. In general, we
recommend filtering on the query <code>id</code>, which is a unique and stable identifier for
each query. The following three query suite definitions are semantically identical and
filter by the query <code>id</code>:</p>
<p>This filter matches all the queries in the default suite of <code>codeql/cpp-queries</code>, except for the two queries with the excluded identifiers:</p>
<pre><code><span>-</span> <span>qlpack:</span> <span>codeql/cpp-queries</span>
<span>-</span> <span>exclude:</span>
    <span>id:</span>
      <span>-</span> <span>cpp/cleartext-transmission</span>
      <span>-</span> <span>cpp/cleartext-storage-file</span>
</code></pre>
<p>In this example, a separate <code>exclude</code> instruction is used for each query:</p>
<pre><code><span>-</span> <span>qlpack:</span> <span>codeql/cpp-queries</span>
<span>-</span> <span>exclude:</span>
    <span>id:</span> <span>cpp/cleartext-transmission</span>
<span>-</span> <span>exclude:</span>
    <span>id:</span> <span>cpp/cleartext-storage-file</span>
</code></pre>
<p>In this example, a regular expression excludes the same two queries. It would also exclude any future queries added to the suite with identifiers that begin: <code>cpp/cleartext-</code>:</p>
<pre><code><span>-</span> <span>qlpack:</span> <span>codeql/cpp-queries</span>
<span>-</span> <span>exclude:</span>
    <span>id:</span>
      <span>-</span> <span>/^cpp\/cleartext-.*/</span>
</code></pre>
<p>To define a suite that selects all queries in the default suite of the
<code>codeql/cpp-queries</code> CodeQL pack, and then refines them to only include
security queries, use:</p>
<pre><code><span>-</span> <span>qlpack:</span> <span>codeql/cpp-queries</span>
<span>-</span> <span>include:</span>
    <span>tags contain:</span> <span>security</span>
</code></pre>
<p>To define a suite that selects all queries with <code>@kind problem</code>
and <code>@precision high</code> from the <code>my-custom-queries</code> directory, use:</p>
<pre><code><span>-</span> <span>queries:</span> <span>my-custom-queries</span>
<span>-</span> <span>include:</span>
    <span>kind:</span> <span>problem</span>
    <span>precision:</span> <span>very-high</span>
</code></pre>
<p>Note that the following query suite definition behaves differently from the definition above. This definition selects queries that are <code>@kind problem</code> <em>or</em>
are <code>@precision very-high</code>:</p>
<pre><code><span>-</span> <span>queries:</span> <span>my-custom-queries</span>
<span>-</span> <span>include:</span>
    <span>kind:</span> <span>problem</span>
<span>-</span> <span>include:</span>
    <span>precision:</span> <span>very-high</span>
</code></pre>
<p>To create a suite that selects all queries with <code>@kind problem</code> from the
<code>my-custom-queries</code> directory except those with <code>@problem.severity recommendation</code>, use:</p>
<pre><code><span>-</span> <span>queries:</span> <span>my-custom-queries</span>
<span>-</span> <span>include:</span>
    <span>kind:</span> <span>problem</span>
<span>-</span> <span>exclude:</span>
    <span>problem.severity:</span> <span>recommendation</span>
</code></pre>
<p>To create a suite that selects all queries with <code>@tag security</code> and
<code>@precision high</code> or <code>very-high</code> from the <code>codeql/cpp-queries</code> CodeQL pack,
use:</p>
<pre><code><span>-</span> <span>queries:</span> <span>.</span>
  <span>from:</span> <span>codeql/cpp-queries</span>
<span>-</span> <span>include:</span>
    <span>tags contain:</span> <span>security</span>
    <span>precision:</span>
    <span>-</span> <span>high</span>
    <span>-</span> <span>very-high</span>
</code></pre>
<div>
<p>
You can use the <code>codeql resolve queries /path/to/suite.qls</code> command to see which queries are selected by a query suite definition. For more information, see <a href="/en/code-security/codeql-cli/codeql-cli-manual/resolve-queries">resolve queries</a>.</p>
</div>
<h2><a href="#reusing-existing-query-suite-definitions">Reusing existing query suite definitions</a></h2>
<p>Existing query suite definitions can be reused by specifying:</p>
<ul>
<li>
<p>An <code>import</code> instruction: Adds the queries selected by a
previously defined <code>.qls</code> file to the current suite:</p>
<pre><code><span>-</span> <span>import:</span> <span>&lt;path-to-query-suite&gt;</span>
</code></pre>
<p>The path to the imported suite must be relative to the CodeQL pack containing the
current suite definition. If the imported query suite is in a different QL
pack you can use:</p>
<pre><code><span>-</span> <span>import:</span> <span>&lt;path-to-query-suite&gt;</span>
  <span>from:</span> <span>&lt;ql-pack&gt;</span>
  <span>version:</span> <span>^x.y.z</span>
</code></pre>
<p>The <code>version</code> field is optional and specifies a range of compatible versions of this CodeQL pack.
If you don’t specify a version, then the most recent version of the pack is used.</p>
<p>Queries added using an <code>import</code> instruction can be filtered using subsequent
<code>exclude</code> instructions.</p>
</li>
<li>
<p>An <code>apply</code> instruction: Adds all of the instructions from a
previously defined <code>.qls</code> file to the current suite. The instructions in the
applied <code>.qls</code> file are executed as if they appear in place of <code>apply</code>.
Any <code>include</code> and <code>exclude</code> instructions from the applied suite also act on
queries added by any earlier instructions:</p>
<pre><code><span>-</span> <span>apply:</span> <span>&lt;path-to-query-suite&gt;</span>
</code></pre>
<p>The <code>apply</code> instruction can also be used to apply a set of reusable
conditions, saved in a <code>.yml</code> file, to multiple query definitions. For more
information, see the <a href="#reusability-examples">examples</a> below.</p>
</li>
</ul>
<h3><a href="#reusability-examples">Reusability Examples</a></h3>
<p>To use the same conditions in multiple query suite definitions, create a
separate <code>.yml</code> file containing your instructions. For example, save the
following in a file called <code>reusable-instructions.yml</code>:</p>
<pre><code><span>-</span> <span>include:</span>
    <span>kind:</span>
    <span>-</span> <span>problem</span>
    <span>-</span> <span>path-problem</span>
    <span>tags contain:</span> <span>security</span>
    <span>precision:</span>
    <span>-</span> <span>high</span>
    <span>-</span> <span>very-high</span>
</code></pre>
<p>Add <code>reusable-instructions.yml</code> to the same CodeQL pack as your current query
suite. Then, in one or more query suites, use the <code>apply</code> instruction to apply
the reusable instructions to the current suite. For example:</p>
<pre><code><span>-</span> <span>queries:</span> <span>queries/cpp/custom</span>
<span>-</span> <span>apply:</span> <span>reusable-instructions.yml</span>
</code></pre>
<p>This will filter the queries in <code>queries/cpp/custom</code> to only include those that match the reusable conditions.</p>
<p>You can also create a suite definition using <code>reusable-instructions.yml</code> on
queries in a different CodeQL pack. If the <code>.qls</code> file is in the same CodeQL pack as
the queries, you can add a <code>from</code> field immediately after the <code>apply</code>
instruction:</p>
<pre><code><span># load queries from the default suite of my-org/my-other-custom-queries</span>
<span>-</span> <span>qlpack:</span> <span>my-org/my-other-custom-queries</span>

<span># apply the reusable instructions from the my-org/my-custom-instructions CodeQL pack</span>
<span>-</span> <span>apply:</span> <span>reusable-instructions.yml</span>
  <span>from:</span> <span>my-org/my-custom-instructions</span>
  <span>version:</span> <span>^1.2.3</span> <span># optional</span>
</code></pre>
<p>A common use case for an <code>import</code> instruction is to apply a further filter to queries from another
query suite. For example, this suite will further filter the <code>cpp-security-and-quality</code> suite
and exclude <code>low</code> and <code>medium</code> precision queries:</p>
<pre><code><span>-</span> <span>import:</span> <span>codeql-suites/cpp-security-and-quality.qls</span>
  <span>from:</span> <span>codeql/cpp-queries</span>
<span>-</span> <span>exclude:</span>
    <span>precision:</span>
      <span>-</span> <span>low</span>
      <span>-</span> <span>medium</span>
</code></pre>
<p>If you want to <code>include</code> queries imported from another suite, the syntax is a little different:</p>
<pre><code><span>-</span> <span>import:</span> <span>codeql-suites/cpp-security-and-quality.qls</span>
  <span>from:</span> <span>codeql/cpp-queries</span>
<span>-</span> <span>exclude:</span> {}
<span>-</span> <span>include:</span>
    <span>precision:</span>
      <span>-</span> <span>very-high</span>
      <span>-</span> <span>high</span>
</code></pre>
<p>Notice the empty <code>exclude</code> instruction. This is required to ensure that the subsequent <code>include</code>
instruction is able to filter queries from the imported suite.</p>
<h2><a href="#naming-a-query-suite">Naming a query suite</a></h2>
<p>You can provide a name for your query suite by specifying a <code>description</code>
instruction:</p>
<pre><code><span>-</span> <span>description:</span> <span>&lt;name-of-query-suite&gt;</span>
</code></pre>
<h2><a href="#saving-a-query-suite">Saving a query suite</a></h2>
<p>Save your query suite in a file with a <code>.qls</code> extension and add it to a CodeQL
pack. For more information, see <a href="/en/code-security/codeql-cli/getting-started-with-the-codeql-cli/customizing-analysis-with-codeql-packs#custom-codeql-packs">Customizing analysis with CodeQL packs</a>.</p>
<h2><a href="#using-query-suites-with-codeql">Using query suites with CodeQL</a></h2>
<p>You can specify query suites on the command line for any command that accepts
<code>.qls</code> files. For example, you can compile the queries selected by a suite
definition using <code>query compile</code>, or use the queries in an analysis using
<code>database analyze</code>. For more information about analyzing CodeQL databases, see
<a href="/en/code-security/codeql-cli/getting-started-with-the-codeql-cli/analyzing-your-code-with-codeql-queries">Analyzing your code with CodeQL queries</a>.</p>
<h2><a href="#further-reading">Further reading</a></h2>
<ul>
<li><a href="https://codeql.github.com/docs/writing-codeql-queries/codeql-queries/#codeql-queries">CodeQL queries</a></li>
</ul>
</div></div></div>
</div>
</div></main>
</div></body></html>