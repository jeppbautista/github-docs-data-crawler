<html><body><div>
<main><div>
<div><nav><ul>
<li>
<a title="GitHub Copilot" href="/en/copilot">GitHub Copilot</a><span>/</span>
</li>
<li>
<a title="Copilot Chat Cookbook" href="/en/copilot/copilot-chat-cookbook">Copilot Chat Cookbook</a><span>/</span>
</li>
<li>
<a title="Testing code" href="/en/copilot/copilot-chat-cookbook/testing-code">Testing code</a><span>/</span>
</li>
<li><a title="Create mock objects" href="/en/copilot/copilot-chat-cookbook/testing-code/create-mock-objects-to-abstract-layers">Create mock objects</a></li>
</ul></nav></div>
<div>
<div><div><h1>Create mock objects to abstract layers</h1></div></div>
<div><div><p>Copilot Chat can help with creating mock objects that you can use for unit tests.</p></div></div>
<div>
<h2>In this article</h2>
<nav><ul>
<li><a href="#example-scenario"><div><span>Example scenario</span></div></a></li>
<li><a href="#example-prompt"><div><span>Example prompt</span></div></a></li>
<li><a href="#example-response"><div><span>Example response</span></div></a></li>
<li><a href="#further-reading"><div><span>Further reading</span></div></a></li>
</ul></nav>
</div>
<div><div><div>
<p>When creating unit tests, it's important to ensure they're isolated and not depending on external services. One way to achieve this is to create mock objects that abstract layers of your application. Copilot Chat can help you generate the code you need to create these mock objects.</p>
<h2><a href="#example-scenario">Example scenario</a></h2>
<p>Imagine a website built with TypeScript which displays a list of runners. You have a service which fetches the runners from a database, and the server-side code which uses this service. You want to test the server-side code, but you don't want to make a call to the database. You can ask Copilot Chat to generate a mock object for the service.</p>
<pre><code><span>// SvelteKit example at +page.server.ts</span>
<span>import</span> service <span>from</span> <span>'./service'</span>;

<span>export</span> <span>async</span> <span>function</span> <span>load</span>(<span>{ params }</span>) {
  <span>const</span> runner = <span>await</span> service.<span>getRunner</span>(params.<span>id</span>);

  <span>return</span> {
    runner
  };
}
</code></pre>
<h2><a href="#example-prompt">Example prompt</a></h2>
<p>This example assumes you are using <a href="https://vitest.dev/">vitest</a> for your tests, but will work with other test runners.</p>
<p><code>/tests Create a unit test to ensure the service is called correctly. Mock the service object.</code></p>
<p>If you have an existing test you wish Copilot to use as a model, you can use <code>#file: path/to/test-file.js</code> to provide the path to the file, and include this information in the prompt.</p>
<h2><a href="#example-response">Example response</a></h2>
<div>
<p> The following response is an example. Copilot Chat responses are non-deterministic, so you may get a different response from the one shown here.</p>
</div>
<p>Copilot provides the plan it will implement and the code text which includes the mocks.</p>
<pre><code><span>import</span> { describe, it, expect, vi, beforeEach } <span>from</span> <span>'vitest'</span>;
<span>import</span> { load } <span>from</span> <span>'./+page.server.ts'</span>;

<span>// Mock the entire service module</span>
vi.<span>mock</span>(<span>'./service'</span>, <span>() =&gt;</span> ({
  <span>default</span>: {
    <span>getRunner</span>: vi.<span>fn</span>()
  }
}));

<span>// Import the mocked service</span>
<span>import</span> service <span>from</span> <span>'./service'</span>;

<span>describe</span>(<span>'load function'</span>, <span>() =&gt;</span> {
  <span>const</span> mockRunner = {
    <span>id</span>: <span>'123'</span>,
    <span>name</span>: <span>'Test Runner'</span>,
    <span>status</span>: <span>'active'</span>
  };

  <span>beforeEach</span>(<span>() =&gt;</span> {
    <span>// Reset mock before each test</span>
    vi.<span>resetAllMocks</span>();

    <span>// Setup default mock implementation</span>
    (service.<span>getRunner</span> <span>as</span> <span>any</span>).<span>mockResolvedValue</span>(mockRunner);
  });

  <span>it</span>(<span>'should fetch runner with correct id'</span>, <span>async</span> () =&gt; {
    <span>const</span> params = { <span>id</span>: <span>'123'</span> };
    <span>const</span> result = <span>await</span> <span>load</span>({ params });

    <span>expect</span>(service.<span>getRunner</span>).<span>toHaveBeenCalledWith</span>(<span>'123'</span>);
    <span>expect</span>(service.<span>getRunner</span>).<span>toHaveBeenCalledTimes</span>(<span>1</span>);
    <span>expect</span>(result).<span>toEqual</span>({ <span>runner</span>: mockRunner });
  });
});
</code></pre>
<h2><a href="#further-reading">Further reading</a></h2>
<ul>
<li><a href="/en/copilot/using-github-copilot/prompt-engineering-for-github-copilot">Prompt engineering for Copilot Chat</a></li>
<li><a href="/en/copilot/using-github-copilot/best-practices-for-using-github-copilot">Best practices for using GitHub Copilot</a></li>
</ul>
</div></div></div>
</div>
</div></main>
</div></body></html>