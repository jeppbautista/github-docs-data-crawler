<html><body><div>
<main><div>
<div><nav><ul>
<li>
<a title="GitHub Copilot" href="/en/copilot">GitHub Copilot</a><span>/</span>
</li>
<li>
<a title="Copilot Chat Cookbook" href="/en/copilot/copilot-chat-cookbook">Copilot Chat Cookbook</a><span>/</span>
</li>
<li>
<a title="Refactoring code" href="/en/copilot/copilot-chat-cookbook/refactoring-code">Refactoring code</a><span>/</span>
</li>
<li><a title="Cross-cutting concerns" href="/en/copilot/copilot-chat-cookbook/refactoring-code/handling-cross-cutting-concerns">Cross-cutting concerns</a></li>
</ul></nav></div>
<div>
<div><div><h1>Handling cross-cutting concerns</h1></div></div>
<div><div><p>Copilot Chat can help you avoid code that relates to a concern other than the core concern of the method or function in which the code is located.</p></div></div>
<div>
<h2>In this article</h2>
<nav><ul>
<li><a href="#example-scenario"><div><span>Example scenario</span></div></a></li>
<li><a href="#example-prompt"><div><span>Example prompt</span></div></a></li>
<li><a href="#example-response"><div><span>Example response</span></div></a></li>
<li><a href="#further-reading"><div><span>Further reading</span></div></a></li>
</ul></nav>
</div>
<div><div><div>
<p>Cross-cutting concerns are aspects of a program that affect multiple parts of the system, such as logging, security, data validation, and error handling. They can become scattered throughout a codebase, leading to code duplication and maintenance challenges.</p>
<p>Copilot Chat can help refactor cross-cutting concerns by suggesting the implementation of Aspect-Oriented Programming (AOP) practices or using decorators and middleware patterns to centralize these concerns in a modular, maintainable way.</p>
<h2><a href="#example-scenario">Example scenario</a></h2>
<p>Imagine you have a Python project that contains multiple service files in which logging occurs. The information that gets logged is defined within each of the individual service files. If the application is modified or extended in future, this design could lead to inconsistency in the content and style of log entries. You can consolidate and centralize the logging behavior to avoid this being distributed across your project.</p>
<p>Here are three files from our example project: the entry point file (<code>main.py</code>), the log message configuration file (<code>logging_config.py</code>), and one of the service files (<code>order_service.py</code>). The example service file shows how log information is defined alongside the business logic for a particular part of the application.</p>
<h3><a href="#mainpy">main.py</a></h3>
<pre><code><span>import</span> logging
<span>from</span> logging_config <span>import</span> setup_logging
<span>from</span> payment_service <span>import</span> PaymentService
<span>from</span> order_service <span>import</span> OrderService
<span>from</span> shipping_service <span>import</span> ShippingService
<span>from</span> inventory_service <span>import</span> InventoryService
<span>from</span> notification_service <span>import</span> NotificationService

<span>def</span> <span>main</span>():
    setup_logging()
    payment_service = PaymentService()
    order_service = OrderService()
    shipping_service = ShippingService()
    inventory_service = InventoryService()
    notification_service = NotificationService()

    <span># Example usage</span>
    payment_service.process_payment({<span>"amount"</span>: <span>100</span>, <span>"currency"</span>: <span>"USD"</span>})
    order_service.place_order({<span>"item"</span>: <span>"Book"</span>, <span>"quantity"</span>: <span>1</span>})
    shipping_service.ship_order({<span>"item"</span>: <span>"Book"</span>, <span>"quantity"</span>: <span>1</span>})
    inventory_service.update_inventory(<span>"Book"</span>, -<span>1</span>)
    notification_service.send_notification(<span>"Order has been placed and shipped."</span>)

<span>if</span> __name__ == <span>"__main__"</span>:
    main()
</code></pre>
<h3><a href="#logging_configpy">logging_config.py</a></h3>
<pre><code><span>import</span> logging

<span>def</span> <span>setup_logging</span>():
    logging.basicConfig(level=logging.INFO,
                  <span>format</span>=<span>'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)
</code></pre>
<h3><a href="#order_servicepy">order_service.py</a></h3>
<pre><code><span>import</span> logging

<span>class</span> <span>OrderService</span>:
    <span>def</span> <span>__init__</span>(<span>self</span>):
        self.logger = logging.getLogger(__name__)

    <span>def</span> <span>place_order</span>(<span>self, order</span>):
        self.logger.info(<span>"Entering place_order method."</span>)
        <span>try</span>:
            <span># In here would be the business logic for placing an order</span>
            <span># ...</span>
            self.logger.info(<span>"Order placed successfully."</span>)
        <span>except</span> Exception <span>as</span> e:
            self.logger.error(<span>f"Error in place_order method: <span>{e}</span>"</span>)
            <span>raise</span>
        <span>finally</span>:
            self.logger.info(<span>"Exiting place_order method."</span>)
</code></pre>
<h2><a href="#example-prompt">Example prompt</a></h2>
<p>Open the project workspace in VS Code or Visual Studio and enter the following prompt in the Copilot Chat view.</p>
<p><code>@workspace Refactor this project by using AOP to avoid logging that has cross-cutting concerns</code></p>
<div>
<p>
The <code>@workspace</code> chat participant in VS Code and Visual Studio provides Copilot with context about all of the code in your workspace. You can use <code>@workspace</code> when you want Copilot to consider the structure of your project and how different parts of your code interact. If you're using a JetBrains IDE, use <code>@project</code> rather than <code>@workspace</code>.</p>
</div>
<h2><a href="#example-response">Example response</a></h2>
<p>Copilot responds as follows.</p>
<div>
<p> The following response is an example. Copilot Chat responses are non-deterministic, so you may get a different response from the one shown here.</p>
</div>
<blockquote>
<p>To refactor this project using Aspect-Oriented Programming (AOP) to handle logging as a cross-cutting concern, you can use a library like <code>aspectlib</code>. Here is how you can do it:</p>
<ol>
<li>
<p>Install <code>aspectlib</code>:</p>
<p><code>pip install aspectlib</code></p>
</li>
<li>
<p>Create an aspect for logging in a new file called <code>logging_aspect.py</code>:</p>
<pre><code><span>import</span> aspectlib
<span>import</span> logging

<span>@aspectlib.Aspect(<span>bind=<span>True</span></span>)</span>
<span>def</span> <span>log_method_call</span>(<span>cutpoint, *args, **kwargs</span>):
    logger = logging.getLogger()
    method_name = cutpoint.__name__
    logger.info(<span>f"Entering method: <span>{method_name}</span>"</span>)
    <span>try</span>:
        result = <span>yield</span> aspectlib.Proceed
        logger.info(<span>f"Method <span>{method_name}</span> executed successfully."</span>)
        <span>return</span> result
    <span>except</span> Exception <span>as</span> e:
        logger.error(<span>f"Error in method <span>{method_name}</span>: <span>{e}</span>"</span>)
        <span>raise</span>
    <span>finally</span>:
        logger.info(<span>f"Exiting method: <span>{method_name}</span>"</span>)
</code></pre>
</li>
<li>
<p>Apply the aspect to the service methods in <code>main.py</code>:</p>
<pre><code><span>import</span> logging
<span>from</span> logging_config <span>import</span> setup_logging
<span>from</span> payment_service <span>import</span> PaymentService
<span>from</span> order_service <span>import</span> OrderService
<span>from</span> shipping_service <span>import</span> ShippingService
<span>from</span> inventory_service <span>import</span> InventoryService
<span>from</span> notification_service <span>import</span> NotificationService
<span>from</span> logging_aspect <span>import</span> log_method_call
<span>import</span> aspectlib

<span>def</span> <span>main</span>():
    setup_logging()

    <span># Apply logging aspect to service methods</span>
    aspectlib.weave(PaymentService.process_payment, log_method_call)
    aspectlib.weave(OrderService.place_order, log_method_call)
    aspectlib.weave(ShippingService.ship_order, log_method_call)
    aspectlib.weave(InventoryService.update_inventory, log_method_call)
    aspectlib.weave(NotificationService.send_notification, log_method_call)

    payment_service = PaymentService()
    order_service = OrderService()
    shipping_service = ShippingService()
    inventory_service = InventoryService()
    notification_service = NotificationService()

    <span># Example usage</span>
    payment_service.process_payment({<span>"amount"</span>: <span>100</span>, <span>"currency"</span>: <span>"USD"</span>})
    order_service.place_order({<span>"item"</span>: <span>"Book"</span>, <span>"quantity"</span>: <span>1</span>})
    shipping_service.ship_order({<span>"item"</span>: <span>"Book"</span>, <span>"quantity"</span>: <span>1</span>})
    inventory_service.update_inventory(<span>"Book"</span>, -<span>1</span>)
    notification_service.send_notification(<span>"Order has been placed and shipped."</span>)

<span>if</span> __name__ == <span>"__main__"</span>:
    main()
</code></pre>
</li>
</ol>
</blockquote>
<p>Copilot then tells you to remove the logging code from all of the service classes, and gives you the code for the revised files. For example, this is the revised version of <code>order_service.py</code>:</p>
<pre><code><span>class</span> <span>OrderService</span>:
    <span>def</span> <span>place_order</span>(<span>self, order</span>):
        <span># In here would be the business logic for placing an order</span>
        <span># ...</span>
        <span>pass</span>
</code></pre>
<p>In the refactored version of the project, the same logging operations are performed, but the logging code is centralized in a single file.</p>
<h2><a href="#further-reading">Further reading</a></h2>
<ul>
<li><a href="/en/copilot/using-github-copilot/prompt-engineering-for-github-copilot">Prompt engineering for Copilot Chat</a></li>
<li><a href="/en/copilot/using-github-copilot/best-practices-for-using-github-copilot">Best practices for using GitHub Copilot</a></li>
</ul>
</div></div></div>
</div>
</div></main>
</div></body></html>