<html><body><div>
<main><div>
<div><nav><ul>
<li>
<a title="GitHub Copilot" href="/en/copilot">GitHub Copilot</a><span>/</span>
</li>
<li>
<a title="Build Copilot Extensions" href="/en/copilot/building-copilot-extensions">Build Copilot Extensions</a><span>/</span>
</li>
<li>
<a title="Build a Copilot agent" href="/en/copilot/building-copilot-extensions/building-a-copilot-agent-for-your-copilot-extension">Build a Copilot agent</a><span>/</span>
</li>
<li><a title="Communicate with Copilot platform" href="/en/copilot/building-copilot-extensions/building-a-copilot-agent-for-your-copilot-extension/configuring-your-copilot-agent-to-communicate-with-the-copilot-platform">Communicate with Copilot platform</a></li>
</ul></nav></div>
<div>
<div><div><h1>Configuring your Copilot agent to communicate with the Copilot platform</h1></div></div>
<div><div><p>Learn how to interact with the Copilot platform by sending and receiving server-sent events with your Copilot agent.</p></div></div>
<div>
<h2>In this article</h2>
<nav><ul>
<li><a href="#sending-server-sent-events"><div><span>Sending server-sent events</span></div></a></li>
<li><a href="#receiving-server-sent-events"><div><span>Receiving server-sent events</span></div></a></li>
<li><a href="#next-steps"><div><span>Next steps</span></div></a></li>
</ul></nav>
</div>
<div><div><div>
<p>Copilot agents communicate with the Copilot platform in the form of server-sent events (SSEs). Rather than waiting for the Copilot platform to request an update from your agent, or vice versa, you can use SSEs to send and receive updates to and from the platform in real time.</p>
<p>To learn more about SSEs, see <a href="https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events">Server-sent events</a> in the mdn documentation.</p>
<h2><a href="#sending-server-sent-events">Sending server-sent events</a></h2>
<p>Your agent should only send one SSE for each interaction with the Copilot platform. There are four predefined SSEs your agent can send:</p>
<ul>
<li><a href="#copilot_confirmation"><code>copilot_confirmation</code></a></li>
<li><a href="#copilot_errors"><code>copilot_errors</code></a></li>
<li><a href="#copilot_references"><code>copilot_references</code></a></li>
<li><a href="#default-sse">Default SSE</a></li>
</ul>
<h3><a href="#copilot_confirmation"><code>copilot_confirmation</code></a></h3>
<p>The <code>copilot_confirmation</code> SSE sends the user a prompt to confirm an action. This SSE is sent through an event type and data field. See the following code for an example of a <code>copilot_confirmation</code> SSE:</p>
<div>
<div><header><span>TypeScript</span><div>
<button>Beside</button><button>Inline</button>
</div>
<pre>//
event: copilot_confirmation
data: {
    // Currently, `action` is the only supported value for `type` in `copilot_confirmation`.
    "type": "action",
    // Title of the confirmation dialog shown to the user.
    "title": "Turn off feature flag",
    // Confirmation message shown to the user.
    "message": "Are you sure you wish to turn off the `copilot` feature flag?",
    // Optional field for the agent to include any data needed to uniquely identify this confirmation and take action once the decision is received from the client.
    "confirmation": {
        "id": "id-123",
        "other": "identifier-as-needed",
    }
}
</pre></header></div>
<div>
<div><div><pre><code><span>event</span>: copilot_confirmation
<span>data</span>: {</code></pre></div></div>
<div>
<div><pre><code>    <span>"type"</span>: <span>"action"</span>,</code></pre></div>
<div><p>Currently, <code>action</code> is the only supported value for <code>type</code> in <code>copilot_confirmation</code>.</p></div>
</div>
<div>
<div><pre><code>    <span>"title"</span>: <span>"Turn off feature flag"</span>,</code></pre></div>
<div><p>Title of the confirmation dialog shown to the user.</p></div>
</div>
<div>
<div><pre><code>    <span>"message"</span>: <span>"Are you sure you wish to turn off the `copilot` feature flag?"</span>,</code></pre></div>
<div><p>Confirmation message shown to the user.</p></div>
</div>
<div>
<div><pre><code>    <span>"confirmation"</span>: {
        <span>"id"</span>: <span>"id-123"</span>,
        <span>"other"</span>: <span>"identifier-as-needed"</span>,
    }
}</code></pre></div>
<div><p>Optional field for the agent to include any data needed to uniquely identify this confirmation and take action once the decision is received from the client.</p></div>
</div>
</div>
<div><pre><code><span>//</span>
<span>event</span>: copilot_confirmation
<span>data</span>: {
    <span>// Currently, `action` is the only supported value for `type` in `copilot_confirmation`.</span>
    <span>"type"</span>: <span>"action"</span>,
    <span>// Title of the confirmation dialog shown to the user.</span>
    <span>"title"</span>: <span>"Turn off feature flag"</span>,
    <span>// Confirmation message shown to the user.</span>
    <span>"message"</span>: <span>"Are you sure you wish to turn off the `copilot` feature flag?"</span>,
    <span>// Optional field for the agent to include any data needed to uniquely identify this confirmation and take action once the decision is received from the client.</span>
    <span>"confirmation"</span>: {
        <span>"id"</span>: <span>"id-123"</span>,
        <span>"other"</span>: <span>"identifier-as-needed"</span>,
    }
}
</code></pre></div>
</div>
<p>After the user accepts or dismisses the confirmation, the agent receives a message similar to the following example:</p>
<div>
<div><header><span>TypeScript</span><div>
<button>Beside</button><button>Inline</button>
</div>
<pre>//
{
    "copilot_confirmations": [
        {
            // A string containing the state of the confirmation. This value is either `accepted` or `dismissed`.
            "state": "accepted",
            // An array of strings containing data identifying the relevant action.
            "confirmation": {
                "id": "id-123",
                "other": "identifier-as-needed",
            }
        }
    ]
}
</pre></header></div>
<div>
<div><div><pre><code>{
    <span>"copilot_confirmations"</span>: [
        {</code></pre></div></div>
<div>
<div><pre><code>            <span>"state"</span>: <span>"accepted"</span>,</code></pre></div>
<div><p>A string containing the state of the confirmation. This value is either <code>accepted</code> or <code>dismissed</code>.</p></div>
</div>
<div>
<div><pre><code>            <span>"confirmation"</span>: {
                <span>"id"</span>: <span>"id-123"</span>,
                <span>"other"</span>: <span>"identifier-as-needed"</span>,
            }
        }
    ]
}</code></pre></div>
<div><p>An array of strings containing data identifying the relevant action.</p></div>
</div>
</div>
<div><pre><code><span>//</span>
{
    <span>"copilot_confirmations"</span>: [
        {
            <span>// A string containing the state of the confirmation. This value is either `accepted` or `dismissed`.</span>
            <span>"state"</span>: <span>"accepted"</span>,
            <span>// An array of strings containing data identifying the relevant action.</span>
            <span>"confirmation"</span>: {
                <span>"id"</span>: <span>"id-123"</span>,
                <span>"other"</span>: <span>"identifier-as-needed"</span>,
            }
        }
    ]
}
</code></pre></div>
</div>
<p>Based on the values in this message, the agent can then complete or cancel the appropriate action.</p>
<h3><a href="#copilot_errors"><code>copilot_errors</code></a></h3>
<p>The <code>copilot_errors</code> SSE sends the Copilot platform a list of encountered errors. This SSE is sent through an event type and data field. See the following code for an example of a <code>copilot_errors</code> SSE:</p>
<div>
<div><header><span>TypeScript</span><div>
<button>Beside</button><button>Inline</button>
</div>
<pre>//
event: copilot_errors
data: [{
    // A string that specifies the error's type. `type` can have a value of `reference`, `function` or `agent`.
    "type": "function",
    // A string controlled by the agent describing the nature of an error.
    "code": "recentchanges",
    // A string that specifies the error message shown to the user.
    "message": "The repository does not exist",
    // A string that serves as a unique identifier to link the error with other resources such as references or function calls.
    "identifier": "github/hello-world"
}]
</pre></header></div>
<div>
<div><div><pre><code><span>event</span>: copilot_errors
<span>data</span>: [{</code></pre></div></div>
<div>
<div><pre><code>    <span>"type"</span>: <span>"function"</span>,</code></pre></div>
<div><p>A string that specifies the error's type. <code>type</code> can have a value of <code>reference</code>, <code>function</code> or <code>agent</code>.</p></div>
</div>
<div>
<div><pre><code>    <span>"code"</span>: <span>"recentchanges"</span>,</code></pre></div>
<div><p>A string controlled by the agent describing the nature of an error.</p></div>
</div>
<div>
<div><pre><code>    <span>"message"</span>: <span>"The repository does not exist"</span>,</code></pre></div>
<div><p>A string that specifies the error message shown to the user.</p></div>
</div>
<div>
<div><pre><code>    <span>"identifier"</span>: <span>"github/hello-world"</span>
}]</code></pre></div>
<div><p>A string that serves as a unique identifier to link the error with other resources such as references or function calls.</p></div>
</div>
</div>
<div><pre><code><span>//</span>
<span>event</span>: copilot_errors
<span>data</span>: [{
    <span>// A string that specifies the error's type. `type` can have a value of `reference`, `function` or `agent`.</span>
    <span>"type"</span>: <span>"function"</span>,
    <span>// A string controlled by the agent describing the nature of an error.</span>
    <span>"code"</span>: <span>"recentchanges"</span>,
    <span>// A string that specifies the error message shown to the user.</span>
    <span>"message"</span>: <span>"The repository does not exist"</span>,
    <span>// A string that serves as a unique identifier to link the error with other resources such as references or function calls.</span>
    <span>"identifier"</span>: <span>"github/hello-world"</span>
}]
</code></pre></div>
</div>
<h3><a href="#copilot_references"><code>copilot_references</code></a></h3>
<div>
<p> Rendering references is currently unsupported for Copilot Chat in GitHub Mobile. Extensions that depend on reference memory to generate responses will still work, but the references will not be displayed to the user.</p>
</div>
<p>The <code>copilot_references</code> SSE sends the user a list of references used to generate a response. This SSE is sent through an event type and data field. See the following code for an example of a <code>copilot_references</code> SSE:</p>
<div>
<div><header><span>TypeScript</span><div>
<button>Beside</button><button>Inline</button>
</div>
<pre>//
event: copilot_references
data: [{
    // A string that specifies the type of the reference.
    "type": "blackbeard.story",
    // A string that specifies the ID of the reference.
    "id": "snippet",
    // An optional field where the agent can include any data needed to uniquely identify this reference.
    "data": {
        "file": "story.go",
        "start": "0",
        "end": "13",
        "content": "func main()...writeStory()..."
    },
    // An optional boolean that indicates if the reference was passed implicitly or explicitly.
    "is_implicit": false,
    // An optional field for the agent to include any metadata to display in the user's environment. If any of the below required fields are missing, then the reference will not be rendered in the UI.
    "metadata": {
        "display_name": "Lines 1-13 from story.go",
        "display_icon": "icon",
        "display_url": "http://blackbeard.com/story/1",

    }
}]
</pre></header></div>
<div>
<div><div><pre><code><span>event</span>: copilot_references
<span>data</span>: [{</code></pre></div></div>
<div>
<div><pre><code>    <span>"type"</span>: <span>"blackbeard.story"</span>,</code></pre></div>
<div><p>A string that specifies the type of the reference.</p></div>
</div>
<div>
<div><pre><code>    <span>"id"</span>: <span>"snippet"</span>,</code></pre></div>
<div><p>A string that specifies the ID of the reference.</p></div>
</div>
<div>
<div><pre><code>    <span>"data"</span>: {
        <span>"file"</span>: <span>"story.go"</span>,
        <span>"start"</span>: <span>"0"</span>,
        <span>"end"</span>: <span>"13"</span>,
        <span>"content"</span>: <span>"func main()...writeStory()..."</span>
    },</code></pre></div>
<div><p>An optional field where the agent can include any data needed to uniquely identify this reference.</p></div>
</div>
<div>
<div><pre><code>    <span>"is_implicit"</span>: <span>false</span>,</code></pre></div>
<div><p>An optional boolean that indicates if the reference was passed implicitly or explicitly.</p></div>
</div>
<div>
<div><pre><code>    <span>"metadata"</span>: {
        <span>"display_name"</span>: <span>"Lines 1-13 from story.go"</span>,
        <span>"display_icon"</span>: <span>"icon"</span>,
        <span>"display_url"</span>: <span>"http://blackbeard.com/story/1"</span>,
    }
}]</code></pre></div>
<div><p>An optional field for the agent to include any metadata to display in the user's environment. If any of the below required fields are missing, then the reference will not be rendered in the UI.</p></div>
</div>
</div>
<div><pre><code><span>//</span>
<span>event</span>: copilot_references
<span>data</span>: [{
    <span>// A string that specifies the type of the reference.</span>
    <span>"type"</span>: <span>"blackbeard.story"</span>,
    <span>// A string that specifies the ID of the reference.</span>
    <span>"id"</span>: <span>"snippet"</span>,
    <span>// An optional field where the agent can include any data needed to uniquely identify this reference.</span>
    <span>"data"</span>: {
        <span>"file"</span>: <span>"story.go"</span>,
        <span>"start"</span>: <span>"0"</span>,
        <span>"end"</span>: <span>"13"</span>,
        <span>"content"</span>: <span>"func main()...writeStory()..."</span>
    },
    <span>// An optional boolean that indicates if the reference was passed implicitly or explicitly.</span>
    <span>"is_implicit"</span>: <span>false</span>,
    <span>// An optional field for the agent to include any metadata to display in the user's environment. If any of the below required fields are missing, then the reference will not be rendered in the UI.</span>
    <span>"metadata"</span>: {
        <span>"display_name"</span>: <span>"Lines 1-13 from story.go"</span>,
        <span>"display_icon"</span>: <span>"icon"</span>,
        <span>"display_url"</span>: <span>"http://blackbeard.com/story/1"</span>,

    }
}]
</code></pre></div>
</div>
<h3><a href="#default-sse">Default SSE</a></h3>
<p>The default SSE sends the user a general chat message. This SSE is unnamed and sent solely through a data field. See the following code for an example of a default SSE:</p>
<pre><code>data: {"id":"chatcmpl-123","object":"chat.completion.chunk","created":1694268190,"model":"gpt-3.5-turbo-0125", "system_fingerprint": "fp_44709d6fcb", "choices":[{"index":0,"delta":{"role":"assistant","content":""},"logprobs":null,"finish_reason":null}]}
</code></pre>
<h2><a href="#receiving-server-sent-events">Receiving server-sent events</a></h2>
<p>Just as your agent sends SSEs to the Copilot platform, it also receives the <code>resp_message</code> SSE from the platform. This SSE contains a list of messages from the user, as well as optional data related to each of the SSE events the agent can send. See the following code sample for an example curl request to your agent containing a message:</p>
<pre><code>curl --request POST \
    --url <span>$AGENT_URL</span> \
    --header <span>'Accept: application/json'</span> \
    --header <span>'Content-Type: application/json'</span> \
    --header <span>"X-GitHub-Token: <span>$RUNTIME_GENERATED_TOKEN</span>"</span> \
    --data <span>'{
        "messages": [
            {
                "role": "user",
                "content": "What is a closure in javascript?",
                "copilot_references": []
            }
        ]
    }'</span>
</code></pre>
<h2><a href="#next-steps">Next steps</a></h2>
<p>Now that you understand how your Copilot agent communicates with the Copilot platform, you can learn how to integrate your agent with the GitHub API. See <a href="/en/copilot/building-copilot-extensions/building-a-copilot-agent-for-your-copilot-extension/configuring-your-copilot-agent-to-communicate-with-github">Configuring your Copilot agent to communicate with GitHub</a>.</p>
</div></div></div>
</div>
</div></main>
</div></body></html>