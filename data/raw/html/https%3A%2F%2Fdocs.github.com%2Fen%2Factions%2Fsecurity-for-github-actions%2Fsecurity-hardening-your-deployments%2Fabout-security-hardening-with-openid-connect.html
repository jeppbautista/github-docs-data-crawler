<html><body><div>
<main><div>
<div><nav><ul>
<li>
<a title="GitHub Actions" href="/en/actions">GitHub Actions</a><span>/</span>
</li>
<li>
<a title="Security" href="/en/actions/security-for-github-actions">Security</a><span>/</span>
</li>
<li>
<a title="Security harden deployments" href="/en/actions/security-for-github-actions/security-hardening-your-deployments">Security harden deployments</a><span>/</span>
</li>
<li><a title="Security hardening with OpenID Connect" href="/en/actions/security-for-github-actions/security-hardening-your-deployments/about-security-hardening-with-openid-connect">Security hardening with OpenID Connect</a></li>
</ul></nav></div>
<div>
<div><div><h1>About security hardening with OpenID Connect</h1></div></div>
<div><div><p>OpenID Connect allows your workflows to exchange short-lived tokens directly from your cloud provider.</p></div></div>
<div>
<h2>In this article</h2>
<nav><ul>
<li><a href="#overview-of-openid-connect"><div><span>Overview of OpenID Connect</span></div></a></li>
<li><a href="#configuring-the-oidc-trust-with-the-cloud"><div><span>Configuring the OIDC trust with the cloud</span></div></a></li>
<li><a href="#updating-your-actions-for-oidc"><div><span>Updating your actions for OIDC</span></div></a></li>
<li><a href="#customizing-the-token-claims"><div><span>Customizing the token claims</span></div></a></li>
<li><a href="#updating-your-workflows-for-oidc"><div><span>Updating your workflows for OIDC</span></div></a></li>
<li><a href="#enabling-openid-connect-for-python-package-publishing"><div><span>Enabling OpenID Connect for Python package publishing</span></div></a></li>
<li><a href="#enabling-openid-connect-for-your-cloud-provider"><div><span>Enabling OpenID Connect for your cloud provider</span></div></a></li>
<li><a href="#debugging-your-oidc-claims"><div><span>Debugging your OIDC claims</span></div></a></li>
</ul></nav>
</div>
<div><div><div>
<h2><a href="#overview-of-openid-connect">Overview of OpenID Connect</a></h2>
<p>GitHub Actions workflows are often designed to access a cloud provider (such as AWS, Azure, GCP, or HashiCorp Vault) in order to deploy software or use the cloud's services. Before the workflow can access these resources, it will supply credentials, such as a password or token, to the cloud provider. These credentials are usually stored as a secret in GitHub, and the workflow presents this secret to the cloud provider every time it runs.</p>
<p>However, using hardcoded secrets requires you to create credentials in the cloud provider and then duplicate them in GitHub as a secret.</p>
<p>With OpenID Connect (OIDC), you can take a different approach by configuring your workflow to request a short-lived access token directly from the cloud provider. Your cloud provider also needs to support OIDC on their end, and you must configure a trust relationship that controls which workflows are able to request the access tokens. Providers that currently support OIDC include Amazon Web Services, Azure, Google Cloud Platform, and HashiCorp Vault, among others.</p>
<h3><a href="#benefits-of-using-oidc">Benefits of using OIDC</a></h3>
<p>By updating your workflows to use OIDC tokens, you can adopt the following good security practices:</p>
<ul>
<li>
<strong>No cloud secrets:</strong> You won't need to duplicate your cloud credentials as long-lived GitHub secrets. Instead, you can configure the OIDC trust on your cloud provider, and then update your workflows to request a short-lived access token from the cloud provider through OIDC.</li>
<li>
<strong>Authentication and authorization management:</strong> You have more granular control over how workflows can use credentials, using your cloud provider's authentication (authN) and authorization (authZ) tools to control access to cloud resources.</li>
<li>
<strong>Rotating credentials:</strong> With OIDC, your cloud provider issues a short-lived access token that is only valid for a single job, and then automatically expires.</li>
</ul>
<h3><a href="#getting-started-with-oidc">Getting started with OIDC</a></h3>
<p>The following diagram gives an overview of how GitHub's OIDC provider integrates with your workflows and cloud provider:</p>
<p><picture><source><img src="/assets/cb-63262/images/help/actions/oidc-architecture.png" alt="Diagram of how a cloud provider integrates with GitHub Actions through access tokens and JSON web token cloud role IDs." width="702" height="238"></source></picture></p>
<ol>
<li>In your cloud provider, create an OIDC trust between your cloud role and your GitHub workflow(s) that need access to the cloud.</li>
<li>Every time your job runs, GitHub's OIDC Provider auto-generates an OIDC token. This token contains multiple claims to establish a security-hardened and verifiable identity about the specific workflow that is trying to authenticate.</li>
<li>You could include a step or action in your job to request this token from GitHub's OIDC provider, and present it to the cloud provider.</li>
<li>Once the cloud provider successfully validates the claims presented in the token, it then provides a short-lived cloud access token that is available only for the duration of the job.</li>
</ol>
<h2><a href="#configuring-the-oidc-trust-with-the-cloud">Configuring the OIDC trust with the cloud</a></h2>
<p>When you configure your cloud to trust GitHub's OIDC provider, you <strong>must</strong> add conditions that filter incoming requests, so that untrusted repositories or workflows canâ€™t request access tokens for your cloud resources:</p>
<ul>
<li>Before granting an access token, your cloud provider checks that the <a href="https://openid.net/specs/openid-connect-core-1_0.html#StandardClaims"><code>subject</code></a> and other claims used to set conditions in its trust settings match those in the request's JSON Web Token (JWT). As a result, you must take care to correctly define the <em>subject</em> and other conditions in your cloud provider.</li>
<li>The OIDC trust configuration steps and the syntax to set conditions for cloud roles (using <em>Subject</em> and other claims) will vary depending on which cloud provider you're using. For some examples, see <a href="#example-subject-claims">Example subject claims</a>.</li>
</ul>
<h3><a href="#understanding-the-oidc-token">Understanding the OIDC token</a></h3>
<p>Each job requests an OIDC token from GitHub's OIDC provider, which responds with an automatically generated JSON web token (JWT) that is unique for each workflow job where it is generated. When the job runs, the OIDC token is presented to the cloud provider. To validate the token, the cloud provider checks if the OIDC token's subject and other claims are a match for the conditions that were preconfigured on the cloud role's OIDC trust definition.</p>
<p>The following example OIDC token uses a subject (<code>sub</code>) that references a job environment named <code>prod</code> in the <code>octo-org/octo-repo</code> repository.</p>
<pre><code>{
  <span>"typ":</span> <span>"JWT"</span>,
  <span>"alg":</span> <span>"RS256"</span>,
  <span>"x5t":</span> <span>"example-thumbprint"</span>,
  <span>"kid":</span> <span>"example-key-id"</span>
}
{
  <span>"jti":</span> <span>"example-id"</span>,
  <span>"sub":</span> <span>"repo:octo-org/octo-repo:environment:prod"</span>,
  <span>"environment":</span> <span>"prod"</span>,
  <span>"aud":</span> <span>"https://github.com/octo-org"</span>,
  <span>"ref":</span> <span>"refs/heads/main"</span>,
  <span>"sha":</span> <span>"example-sha"</span>,
  <span>"repository":</span> <span>"octo-org/octo-repo"</span>,
  <span>"repository_owner":</span> <span>"octo-org"</span>,
  <span>"actor_id":</span> <span>"12"</span>,
  <span>"repository_visibility":</span> <span>"private"</span>,
  <span>"repository_id":</span> <span>"74"</span>,
  <span>"repository_owner_id":</span> <span>"65"</span>,
  <span>"run_id":</span> <span>"example-run-id"</span>,
  <span>"run_number":</span> <span>"10"</span>,
  <span>"run_attempt":</span> <span>"2"</span>,
  <span>"runner_environment":</span> <span>"github-hosted"</span>,
  <span>"actor":</span> <span>"octocat"</span>,
  <span>"workflow":</span> <span>"example-workflow"</span>,
  <span>"head_ref":</span> <span>""</span>,
  <span>"base_ref":</span> <span>""</span>,
  <span>"event_name":</span> <span>"workflow_dispatch"</span>,
  <span>"ref_type":</span> <span>"branch"</span>,
  <span>"job_workflow_ref":</span> <span>"octo-org/octo-automation/.github/workflows/oidc.yml@refs/heads/main"</span>,
  <span>"iss":</span> <span>"https://token.actions.githubusercontent.com"</span>,
  <span>"nbf":</span> <span>1632492967</span>,
  <span>"exp":</span> <span>1632493867</span>,
  <span>"iat":</span> <span>1632493567</span>
}
</code></pre>
<p>To see all the claims supported by GitHub's OIDC provider, review the <code>claims_supported</code> entries at
<a href="https://token.actions.githubusercontent.com/.well-known/openid-configuration">https://token.actions.githubusercontent.com/.well-known/openid-configuration</a>.</p>
<p>The token includes the standard audience, issuer, and subject claims.</p>

























<table>
<thead><tr>
<th>Claim</th>
<th>Claim type</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td><code>aud</code></td>
<td>Audience</td>
<td>By default, this is the URL of the repository owner, such as the organization that owns the repository. You can set a custom audience with a toolkit command: <a href="https://www.npmjs.com/package/@actions/core/v/1.6.0"><code>core.get<wbr>IDToken(audience)</wbr></code></a>
</td>
</tr>
<tr>
<td><code>iss</code></td>
<td>Issuer</td>
<td>The issuer of the OIDC token: <code>https:/<wbr>/<wbr>token.actions.githubusercontent.com</wbr></wbr></code>
</td>
</tr>
<tr>
<td><code>sub</code></td>
<td>Subject</td>
<td>Defines the subject claim that is to be validated by the cloud provider. This setting is essential for making sure that access tokens are only allocated in a predictable way.</td>
</tr>
</tbody>
</table>
<p>The OIDC token also includes additional standard JOSE header parameters and claims.</p>

























<table>
<thead><tr>
<th>Header Parameter</th>
<th>Parameter type</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td><code>alg</code></td>
<td>Algorithm</td>
<td>The algorithm used by the OIDC provider.</td>
</tr>
<tr>
<td><code>kid</code></td>
<td>Key identifier</td>
<td>Unique key for the OIDC token.</td>
</tr>
<tr>
<td><code>typ</code></td>
<td>Type</td>
<td>Describes the type of token. This is a JSON Web Token (JWT).</td>
</tr>
</tbody>
</table>






























<table>
<thead><tr>
<th>Claim</th>
<th>Claim type</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td><code>exp</code></td>
<td>Expires at</td>
<td>Identifies the expiry time of the JWT.</td>
</tr>
<tr>
<td><code>iat</code></td>
<td>Issued at</td>
<td>The time when the JWT was issued.</td>
</tr>
<tr>
<td><code>jti</code></td>
<td>JWT token identifier</td>
<td>Unique identifier for the OIDC token.</td>
</tr>
<tr>
<td><code>nbf</code></td>
<td>Not before</td>
<td>JWT is not valid for use before this time.</td>
</tr>
</tbody>
</table>
<p>The token also includes custom claims provided by GitHub.</p>









































































































<table>
<thead><tr>
<th>Claim</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td><code>actor</code></td>
<td>The personal account that initiated the workflow run.</td>
</tr>
<tr>
<td><code>actor_id</code></td>
<td>The ID of personal account that initiated the workflow run.</td>
</tr>
<tr>
<td><code>base_ref</code></td>
<td>The target branch of the pull request in a workflow run.</td>
</tr>
<tr>
<td><code>environment</code></td>
<td>The name of the environment used by the job. If the <code>environment</code> claim is included (also via <code>include_claim_<wbr>keys</wbr></code>), an environment is required and must be provided.</td>
</tr>
<tr>
<td><code>event_name</code></td>
<td>The name of the event that triggered the workflow run.</td>
</tr>
<tr>
<td><code>head_ref</code></td>
<td>The source branch of the pull request in a workflow run.</td>
</tr>
<tr>
<td><code>job_workflow_ref</code></td>
<td>For jobs using a reusable workflow, the ref path to the reusable workflow. For more information, see <a href="/en/actions/deployment/security-hardening-your-deployments/using-openid-connect-with-reusable-workflows">Using OpenID Connect with reusable workflows</a>.</td>
</tr>
<tr>
<td><code>job_workflow_sha</code></td>
<td>For jobs using a reusable workflow, the commit SHA for the reusable workflow file.</td>
</tr>
<tr>
<td><code>ref</code></td>
<td>
<em>(Reference)</em> The git ref that triggered the workflow run.</td>
</tr>
<tr>
<td><code>ref_type</code></td>
<td>The type of <code>ref</code>, for example: "branch".</td>
</tr>
<tr>
<td><code>repository_visibility</code></td>
<td>The visibility of the repository where the workflow is running. Accepts the following values: <code>internal</code>, <code>private</code>, or <code>public</code>.</td>
</tr>
<tr>
<td><code>repository</code></td>
<td>The repository from where the workflow is running.</td>
</tr>
<tr>
<td><code>repository_id</code></td>
<td>The ID of the repository from where the workflow is running.</td>
</tr>
<tr>
<td><code>repository_owner</code></td>
<td>The name of the organization in which the <code>repository</code> is stored.</td>
</tr>
<tr>
<td><code>repository_owner_<wbr>id</wbr></code></td>
<td>The ID of the organization in which the <code>repository</code> is stored.</td>
</tr>
<tr>
<td><code>run_id</code></td>
<td>The ID of the workflow run that triggered the workflow.</td>
</tr>
<tr>
<td><code>run_number</code></td>
<td>The number of times this workflow has been run.</td>
</tr>
<tr>
<td><code>run_attempt</code></td>
<td>The number of times this workflow run has been retried.</td>
</tr>
<tr>
<td><code>runner_environment</code></td>
<td>The type of runner used by the job. Accepts the following values: <code>github-hosted</code> or <code>self-hosted</code>.</td>
</tr>
<tr>
<td><code>workflow</code></td>
<td>The name of the workflow.</td>
</tr>
<tr>
<td><code>workflow_ref</code></td>
<td>The ref path to the workflow. For example, <code>octocat/<wbr>hello-world/<wbr>.github/<wbr>workflows/<wbr>my-workflow.yml@refs/<wbr>heads/<wbr>my_branch</wbr></wbr></wbr></wbr></wbr></wbr></code>.</td>
</tr>
<tr>
<td><code>workflow_sha</code></td>
<td>The commit SHA for the workflow file.</td>
</tr>
</tbody>
</table>
<h3><a href="#defining-trust-conditions-on-cloud-roles-using-oidc-claims">Defining trust conditions on cloud roles using OIDC claims</a></h3>
<p>With OIDC, a GitHub Actions workflow requires a token in order to access resources in your cloud provider. The workflow requests an access token from your cloud provider, which checks the details presented by the JWT. If the trust configuration in the JWT is a match, your cloud provider responds by issuing a temporary token to the workflow, which can then be used to access resources in your cloud provider. You can configure your cloud provider to only respond to requests that originate from a specific organization's repository. You can also specify additional conditions, described below.</p>
<p>Audience and Subject claims are typically used in combination while setting conditions on the cloud role/resources to scope its access to the GitHub workflows.</p>
<ul>
<li>
<strong>Audience:</strong> By default, this value uses the URL of the organization or repository owner. This can be used to set a condition that only the workflows in the specific organization can access the cloud role.</li>
<li>
<strong>Subject:</strong> By default, has a predefined format and is a concatenation of some of the key metadata about the workflow, such as the GitHub organization, repository, branch, or associated <a href="/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idenvironment"><code>job</code></a> environment. See <a href="#example-subject-claims">Example subject claims</a> to see how the subject claim is assembled from concatenated metadata.</li>
</ul>
<p>If you need more granular trust conditions, you can customize the subject (<code>sub</code>) claim that's included with the JWT. For more information, see <a href="#customizing-the-token-claims">Customizing the token claims</a>.</p>
<p>There are also many additional claims supported in the OIDC token that can be used for setting these conditions. In addition, your cloud provider could allow you to assign a role to the access tokens, letting you specify even more granular permissions.</p>
<div>
<p>
To control how your cloud provider issues access tokens, you <strong>must</strong> define at least one condition, so that untrusted repositories canâ€™t request access tokens for your cloud resources.</p>
</div>
<h3><a href="#example-subject-claims">Example subject claims</a></h3>
<p>The following examples demonstrate how to use "Subject" as a condition, and explain how the "Subject" is assembled from concatenated metadata. The <a href="https://openid.net/specs/openid-connect-core-1_0.html#StandardClaims">subject</a> uses information from the <a href="/en/actions/learn-github-actions/contexts#job-context"><code>job</code> context</a>, and instructs your cloud provider that access token requests may only be granted for requests from workflows running in specific branches, environments. The following sections describe some common subjects you can use.</p>
<h4><a href="#filtering-for-a-specific-environment">Filtering for a specific environment</a></h4>
<p>The subject claim includes the environment name when the job references an environment.</p>
<p>You can configure a subject that filters for a specific <a href="/en/actions/deployment/targeting-different-environments/managing-environments-for-deployment">environment</a> name. In this example, the workflow run must have originated from a job that has an environment named <code>Production</code>, in a repository named <code>octo-repo</code> that is owned by the <code>octo-org</code> organization:</p>
<ul>
<li>Syntax: <code>repo:ORG-NAME/REPO-NAME:environment:ENVIRONMENT-NAME</code>
</li>
<li>Example: <code>repo:octo-org/octo-repo:environment:Production</code>
</li>
</ul>
<h4><a href="#filtering-for-pull_request-events">Filtering for <code>pull_request</code> events</a></h4>
<p>The subject claim includes the <code>pull_request</code> string when the workflow is triggered by a pull request event, but only if the job doesn't reference an environment.</p>
<p>You can configure a subject that filters for the <a href="/en/actions/using-workflows/events-that-trigger-workflows#pull_request"><code>pull_request</code></a> event. In this example, the workflow run must have been triggered by a <code>pull_request</code> event in a repository named <code>octo-repo</code> that is owned by the <code>octo-org</code> organization:</p>
<ul>
<li>Syntax: <code>repo:ORG-NAME/REPO-NAME:pull_request</code>
</li>
<li>Example: <code>repo:octo-org/octo-repo:pull_request</code>
</li>
</ul>
<h4><a href="#filtering-for-a-specific-branch">Filtering for a specific branch</a></h4>
<p>The subject claim includes the branch name of the workflow, but only if the job doesn't reference an environment, and if the workflow is not triggered by a pull request event.</p>
<p>You can configure a subject that filters for a specific branch name. In this example, the workflow run must have originated from a branch named <code>demo-branch</code>, in a repository named <code>octo-repo</code> that is owned by the <code>octo-org</code> organization:</p>
<ul>
<li>Syntax:  <code>repo:ORG-NAME/REPO-NAME:ref:refs/heads/BRANCH-NAME</code>
</li>
<li>Example: <code>repo:octo-org/octo-repo:ref:refs/heads/demo-branch</code>
</li>
</ul>
<h4><a href="#filtering-for-a-specific-tag">Filtering for a specific tag</a></h4>
<p>The subject claim includes the tag name of the workflow, but only if the job doesn't reference an environment, and if the workflow is not triggered by a pull request event.</p>
<p>You can create a subject that filters for specific tag. In this example, the workflow run must have originated with a tag named <code>demo-tag</code>, in a repository named <code>octo-repo</code> that is owned by the <code>octo-org</code> organization:</p>
<ul>
<li>Syntax: <code>repo:ORG-NAME/REPO-NAME:ref:refs/tags/TAG-NAME</code>
</li>
<li>Example: <code>repo:octo-org/octo-repo:ref:refs/tags/demo-tag</code>
</li>
</ul>
<h3><a href="#configuring-the-subject-in-your-cloud-provider">Configuring the subject in your cloud provider</a></h3>
<p>To configure the subject in your cloud provider's trust relationship, you must add the subject string to its trust configuration. The following examples demonstrate how various cloud providers can accept the same <code>repo:octo-org/octo-repo:ref:refs/heads/demo-branch</code> subject in different ways:</p>

























<table>
<thead><tr>
<th>Cloud provider</th>
<th>Example</th>
</tr></thead>
<tbody>
<tr>
<td>Amazon Web Services</td>
<td><code>"token.actions.githubusercontent.com:sub": "repo:octo-org/octo-repo:ref:refs/heads/demo-branch"</code></td>
</tr>
<tr>
<td>Azure</td>
<td><code>repo:octo-org/<wbr>octo-repo:ref:refs/<wbr>heads/<wbr>demo-branch</wbr></wbr></wbr></code></td>
</tr>
<tr>
<td>Google Cloud Platform</td>
<td><code>(assertion.sub=='repo:octo-org/octo-repo:ref:refs/heads/demo-branch')</code></td>
</tr>
<tr>
<td>HashiCorp Vault</td>
<td><code>bound_subject="repo:octo-org/octo-repo:ref:refs/heads/demo-branch"</code></td>
</tr>
</tbody>
</table>
<p>For more information, see the guides listed in <a href="#enabling-openid-connect-for-your-cloud-provider">Enabling OpenID Connect for your cloud provider</a>.</p>
<h2><a href="#updating-your-actions-for-oidc">Updating your actions for OIDC</a></h2>
<p>To update your custom actions to authenticate using OIDC, you can use <code>getIDToken()</code> from the Actions toolkit to request a JWT from GitHub's OIDC provider. For more information, see "OIDC Token" in the <a href="https://www.npmjs.com/package/@actions/core/v/1.6.0">npm package documentation</a>.</p>
<p>You could also use a <code>curl</code> command to request the JWT, using the following environment variables.</p>

















<table>
<thead><tr>
<th>Variable</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td><code>ACTIONS_ID_TOKEN_<wbr>REQUEST_URL</wbr></code></td>
<td>The URL for GitHub's OIDC provider.</td>
</tr>
<tr>
<td><code>ACTIONS_ID_TOKEN_<wbr>REQUEST_TOKEN</wbr></code></td>
<td>Bearer token for the request to the OIDC provider.</td>
</tr>
</tbody>
</table>
<p>For example:</p>
<div>
<header><span>Shell</span><pre>curl -H "Authorization: bearer $ACTIONS_ID_TOKEN_REQUEST_TOKEN" "$ACTIONS_ID_TOKEN_REQUEST_URL&amp;audience=api://AzureADTokenExchange"
</pre></header><pre><code>curl -H "Authorization: bearer $ACTIONS_ID_TOKEN_REQUEST_TOKEN" "$ACTIONS_ID_TOKEN_REQUEST_URL&amp;audience=api://AzureADTokenExchange"
</code></pre>
</div>
<h3><a href="#adding-permissions-settings">Adding permissions settings</a></h3>
<p>The job or workflow run requires a <code>permissions</code> setting with <a href="/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github_token"><code>id-token: write</code></a> to allow GitHub's OIDC provider to create a JSON Web Token for every run. You won't be able to request the OIDC JWT ID token if the <code>permissions</code> for <code>id-token</code> is not set to <code>write</code>, however this value doesn't imply granting write access to any resources, only being able to fetch and set the OIDC token for an action or step to enable authenticating with a short-lived access token. Any actual trust setting is defined using OIDC claims, for more information see <a href="/en/actions/security-for-github-actions/security-hardening-your-deployments/about-security-hardening-with-openid-connect#configuring-the-oidc-trust-with-the-cloud">About security hardening with OpenID Connect</a>.</p>
<p>The <code>id-token: write</code> setting allows the JWT to be requested from GitHub's OIDC provider using one of these approaches:</p>
<ul>
<li>Using environment variables on the runner (<code>ACTIONS_ID_TOKEN_REQUEST_URL</code> and <code>ACTIONS_ID_TOKEN_REQUEST_TOKEN</code>).</li>
<li>Using <code>getIDToken()</code> from the Actions toolkit.</li>
</ul>
<p>If you need to fetch an OIDC token for a workflow, then the permission can be set at the workflow level. For example:</p>
<div>
<header><span>YAML</span><pre>permissions:
  id-token: write # This is required for requesting the JWT
  contents: read  # This is required for actions/checkout
</pre></header><pre><code><span>permissions:</span>
  <span>id-token:</span> <span>write</span> <span># This is required for requesting the JWT</span>
  <span>contents:</span> <span>read</span>  <span># This is required for actions/checkout</span>
</code></pre>
</div>
<p>If you only need to fetch an OIDC token for a single job, then this permission can be set within that job. For example:</p>
<div>
<header><span>YAML</span><pre>permissions:
  id-token: write # This is required for requesting the JWT
</pre></header><pre><code><span>permissions:</span>
  <span>id-token:</span> <span>write</span> <span># This is required for requesting the JWT</span>
</code></pre>
</div>
<p>You may need to specify additional permissions here, depending on your workflow's requirements.</p>
<p>For reusable workflows that are owned by the same user, organization, or enterprise as the caller workflow, the OIDC token generated in the reusable workflow can be accessed from the caller's context.
For reusable workflows outside your enterprise or organization, the <code>permissions</code> setting for <code>id-token</code> should be explicitly set to <code>write</code> at the caller workflow level or in the specific job that calls the reusable workflow.
This ensures that the OIDC token generated in the reusable workflow is only allowed to be consumed in the caller workflows when intended.</p>
<p>For more information, see <a href="/en/actions/using-workflows/reusing-workflows">Reusing workflows</a>.</p>
<h2><a href="#customizing-the-token-claims">Customizing the token claims</a></h2>
<p>You can security harden your OIDC configuration by customizing the claims that are included with the JWT. These customizations allow you to define more granular trust conditions on your cloud roles when allowing your workflows to access resources hosted in the cloud:</p>
<ul>
<li>You can customize values for <code>audience</code> claims. See <a href="#customizing-the-audience-value">Customizing the <code>audience</code> value</a>.</li>
<li>You can customize the format of your OIDC configuration by setting conditions on the subject (<code>sub</code>) claim that require JWT tokens to originate from a specific repository, reusable workflow, or other source.</li>
<li>You can define granular OIDC policies by using additional OIDC token claims, such as <code>repository_id</code> and <code>repository_visibility</code>. See <a href="#understanding-the-oidc-token">Understanding the OIDC token</a>.</li>
</ul>
<h3><a href="#customizing-the-audience-value">Customizing the <code>audience</code> value</a></h3>
<p>When you use custom actions in your workflows, those actions may use the GitHub Actions Toolkit to enable you to supply a custom value for the <code>audience</code> claim. Some cloud providers also use this in their official login actions to enforce a default value for the <code>audience</code> claim. For example, the <a href="https://github.com/Azure/login/blob/master/action.yml">GitHub Action for Azure Login</a> provides a default <code>aud</code> value of <code>api://AzureADTokenExchange</code>, or it allows you to set a custom <code>aud</code> value in your workflows. For more information on the GitHub Actions Toolkit, see the <a href="https://github.com/actions/toolkit/tree/main/packages/core#oidc-token">OIDC token</a> section in the documentation.</p>
<p>If you do not want to use the default <code>aud</code> value offered by an action, you can provide a custom value for the <code>audience</code> claim. This allows you to set a condition that only workflows in a specific repository or organization can access the cloud role. If the action you are using supports this, you can use the <code>with</code> keyword in your workflow to pass a custom <code>aud</code> value to the action. For more information, see <a href="/en/actions/creating-actions/metadata-syntax-for-github-actions#inputs">Metadata syntax for GitHub Actions</a>.</p>
<h3><a href="#customizing-the-subject-claims-for-an-organization-or-repository">Customizing the subject claims for an organization or repository</a></h3>
<p>To help improve security, compliance, and standardization, you can customize the standard claims to suit your required access conditions. If your cloud provider supports conditions on subject claims, you can create a condition that checks whether the <code>sub</code> value matches the path of the reusable workflow, such as <code>"job_workflow_ref:octo-org/octo-automation/.github/workflows/oidc.yml@refs/heads/main"</code>. The exact format will vary depending on your cloud provider's OIDC configuration. To configure the matching condition on GitHub, you can use the REST API to require that the <code>sub</code> claim must always include a specific custom claim, such as <code>job_workflow_ref</code>. You can use the REST API to apply a customization template for the OIDC subject claim; for example, you can require that the <code>sub</code> claim within the OIDC token must always include a specific custom claim, such as <code>job_workflow_ref</code>. For more information, see <a href="/en/rest/actions/oidc">REST API endpoints for GitHub Actions OIDC</a>.</p>
<div>
<p>
When the organization template is applied, it will not affect any workflows already using OIDC unless their repository has opted in to custom organization templates. For all repositories, existing and new, the repository owner will need to use the repository-level REST API to opt in to receive this configuration by setting <code>use_default</code> to <code>false</code>. Alternatively, the repository owner could use the REST API to apply a different configuration specific to the repository. For more information, see <a href="/en/rest/actions/oidc#set-the-customization-template-for-an-oidc-subject-claim-for-a-repository">REST API endpoints for GitHub Actions OIDC</a>.</p>
</div>
<p>Customizing the claims results in a new format for the entire <code>sub</code> claim, which replaces the default predefined <code>sub</code> format in the token described in <a href="/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect#example-subject-claims">About security hardening with OpenID Connect</a>.</p>
<div>
<p>
The <code>sub</code> claim uses the shortened form <code>repo</code> (for example, <code>repo:ORG-NAME/REPO-NAME</code>) instead of <code>repository</code> to reference the repository.
Any <code>:</code> within the context value will be replaced with <code>%3A</code>.</p>
</div>
<p>The following example templates demonstrate various ways to customize the subject claim. To configure these settings on GitHub, admins use the REST API to specify a list of claims that must be included in the subject (<code>sub</code>) claim.</p>
<p>To apply this configuration, submit a request to the API endpoint and include the required configuration in the request body. For organizations, see <a href="/en/rest/actions/oidc#set-the-customization-template-for-an-oidc-subject-claim-for-an-organization">REST API endpoints for GitHub Actions OIDC</a>, and for repositories, see <a href="/en/rest/actions/oidc#set-the-customization-template-for-an-oidc-subject-claim-for-a-repository">REST API endpoints for GitHub Actions OIDC</a>.</p>
<p>To customize your subject claims, you should first create a matching condition in your cloud provider's OIDC configuration, before customizing the configuration using the REST API. Once the configuration is completed, each time a new job runs, the OIDC token generated during that job will follow the new customization template. If the matching condition doesn't exist in the cloud provider's OIDC configuration before the job runs, the generated token might not be accepted by the cloud provider, since the cloud conditions may not be synchronized.</p>
<h4><a href="#example-allowing-repository-based-on-visibility-and-owner">Example: Allowing repository based on visibility and owner</a></h4>
<p>This example template allows the <code>sub</code> claim to have a new format, using <code>repository_owner</code> and <code>repository_visibility</code>:</p>
<pre><code><span>{</span>
   <span>"include_claim_keys"</span><span>:</span> <span>[</span>
       <span>"repository_owner"</span><span>,</span>
       <span>"repository_visibility"</span>
   <span>]</span>
<span>}</span>
</code></pre>
<p>In your cloud provider's OIDC configuration, configure the <code>sub</code> condition to require that claims must include specific values for <code>repository_owner</code> and <code>repository_visibility</code>. For example: <code>"sub": "repository_owner:monalisa:repository_visibility:private"</code>. The approach lets you restrict cloud role access to only private repositories within an organization or enterprise.</p>
<h4><a href="#example-allowing-access-to-all-repositories-with-a-specific-owner">Example: Allowing access to all repositories with a specific owner</a></h4>
<p>This example template enables the <code>sub</code> claim to have a new format with only the value of <code>repository_owner</code>.</p>
<p>To apply this configuration, submit a request to the API endpoint and include the required configuration in the request body. For organizations, see <a href="/en/rest/actions/oidc#set-the-customization-template-for-an-oidc-subject-claim-for-an-organization">REST API endpoints for GitHub Actions OIDC</a>, and for repositories, see <a href="/en/rest/actions/oidc#set-the-customization-template-for-an-oidc-subject-claim-for-a-repository">REST API endpoints for GitHub Actions OIDC</a>.</p>
<pre><code><span>{</span>
   <span>"include_claim_keys"</span><span>:</span> <span>[</span>
       <span>"repository_owner"</span>
   <span>]</span>
<span>}</span>

</code></pre>
<p>In your cloud provider's OIDC configuration, configure the <code>sub</code> condition to require that claims must include a specific value for <code>repository_owner</code>. For example: <code>"sub": "repository_owner:monalisa"</code></p>
<h4><a href="#example-requiring-a-reusable-workflow">Example: Requiring a reusable workflow</a></h4>
<p>This example template allows the <code>sub</code> claim to have a new format that contains the value of the <code>job_workflow_ref</code> claim. This enables an enterprise to use <a href="/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect#example-subject-claims">reusable workflows</a> to enforce consistent deployments across its organizations and repositories.</p>
<p>To apply this configuration, submit a request to the API endpoint and include the required configuration in the request body. For organizations, see <a href="/en/rest/actions/oidc#set-the-customization-template-for-an-oidc-subject-claim-for-an-organization">REST API endpoints for GitHub Actions OIDC</a>, and for repositories, see <a href="/en/rest/actions/oidc#set-the-customization-template-for-an-oidc-subject-claim-for-a-repository">REST API endpoints for GitHub Actions OIDC</a>.</p>
<pre><code>  <span>{</span>
     <span>"include_claim_keys"</span><span>:</span> <span>[</span>
         <span>"job_workflow_ref"</span>
     <span>]</span>
  <span>}</span>
</code></pre>
<p>In your cloud provider's OIDC configuration, configure the <code>sub</code> condition to require that claims must include a specific value for <code>job_workflow_ref</code>. For example: <code>"sub": "job_workflow_ref:octo-org/octo-automation/.github/workflows/oidc.yml@refs/heads/main"</code>.</p>
<h4><a href="#example-requiring-a-reusable-workflow-and-other-claims">Example: Requiring a reusable workflow and other claims</a></h4>
<p>The following example template combines the requirement of a specific reusable workflow with additional claims.</p>
<p>To apply this configuration, submit a request to the API endpoint and include the required configuration in the request body. For organizations, see <a href="/en/rest/actions/oidc#set-the-customization-template-for-an-oidc-subject-claim-for-an-organization">REST API endpoints for GitHub Actions OIDC</a>, and for repositories, see <a href="/en/rest/actions/oidc#set-the-customization-template-for-an-oidc-subject-claim-for-a-repository">REST API endpoints for GitHub Actions OIDC</a>.</p>
<p>This example also demonstrates how to use <code>"context"</code> to define your conditions. This is the part that follows the repository in the <a href="/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect#example-subject-claims">default <code>sub</code> format</a>. For example, when the job references an environment, the context contains: <code>environment:ENVIRONMENT-NAME</code>.</p>
<pre><code><span>{</span>
   <span>"include_claim_keys"</span><span>:</span> <span>[</span>
       <span>"repo"</span><span>,</span>
       <span>"context"</span><span>,</span>
       <span>"job_workflow_ref"</span>
   <span>]</span>
<span>}</span>
</code></pre>
<p>In your cloud provider's OIDC configuration, configure the <code>sub</code> condition to require that claims must include specific values for <code>repo</code>, <code>context</code>, and <code>job_workflow_ref</code>.</p>
<p>This customization template requires that the <code>sub</code> uses the following format: <code>repo:ORG-NAME/REPO-NAME:environment:ENVIRONMENT-NAME:job_workflow_ref:REUSABLE-WORKFLOW-PATH</code>.
For example: <code>"sub": "repo:octo-org/octo-repo:environment:prod:job_workflow_ref:octo-org/octo-automation/.github/workflows/oidc.yml@refs/heads/main"</code></p>
<h4><a href="#example-granting-access-to-a-specific-repository">Example: Granting access to a specific repository</a></h4>
<p>This example template lets you grant cloud access to all the workflows in a specific repository, across all branches/tags and environments.</p>
<p>To apply this configuration, submit a request to the API endpoint and include the required configuration in the request body. For organizations, see <a href="/en/rest/actions/oidc#set-the-customization-template-for-an-oidc-subject-claim-for-an-organization">REST API endpoints for GitHub Actions OIDC</a>, and for repositories, see <a href="/en/rest/actions/oidc#set-the-customization-template-for-an-oidc-subject-claim-for-a-repository">REST API endpoints for GitHub Actions OIDC</a>.</p>
<pre><code><span>{</span>
   <span>"include_claim_keys"</span><span>:</span> <span>[</span>
       <span>"repo"</span>
   <span>]</span>
<span>}</span>
</code></pre>
<p>In your cloud provider's OIDC configuration, configure the <code>sub</code> condition to require a <code>repo</code> claim that matches the required value.</p>
<h4><a href="#example-using-system-generated-guids">Example: Using system-generated GUIDs</a></h4>
<p>This example template enables predictable OIDC claims with system-generated GUIDs that do not change between renames of entities (such as renaming a repository).</p>
<p>To apply this configuration, submit a request to the API endpoint and include the required configuration in the request body. For organizations, see <a href="/en/rest/actions/oidc#set-the-customization-template-for-an-oidc-subject-claim-for-an-organization">REST API endpoints for GitHub Actions OIDC</a>, and for repositories, see <a href="/en/rest/actions/oidc#set-the-customization-template-for-an-oidc-subject-claim-for-a-repository">REST API endpoints for GitHub Actions OIDC</a>.</p>
<pre><code>  <span>{</span>
     <span>"include_claim_keys"</span><span>:</span> <span>[</span>
         <span>"repository_id"</span>
     <span>]</span>
  <span>}</span>
</code></pre>
<p>In your cloud provider's OIDC configuration, configure the <code>sub</code> condition to require a <code>repository_id</code> claim that matches the required value.</p>
<p>or:</p>
<pre><code><span>{</span>
   <span>"include_claim_keys"</span><span>:</span> <span>[</span>
       <span>"repository_owner_id"</span>
   <span>]</span>
<span>}</span>
</code></pre>
<p>In your cloud provider's OIDC configuration, configure the <code>sub</code> condition to require a <code>repository_owner_id</code> claim that matches the required value.</p>
<h4><a href="#example-context-value-with-">Example: Context value with <code>:</code></a></h4>
<p>This example demonstrates how to handle context value with <code>:</code>. For example, when the job references an environment named <code>production:eastus</code>.</p>
<p>To apply this configuration, submit a request to the API endpoint and include the required configuration in the request body. For organizations, see <a href="/en/rest/actions/oidc#set-the-customization-template-for-an-oidc-subject-claim-for-an-organization">REST API endpoints for GitHub Actions OIDC</a>, and for repositories, see <a href="/en/rest/actions/oidc#set-the-customization-template-for-an-oidc-subject-claim-for-a-repository">REST API endpoints for GitHub Actions OIDC</a>.</p>
<pre><code><span>{</span>
   <span>"include_claim_keys"</span><span>:</span> <span>[</span>
       <span>"environment"</span><span>,</span>
       <span>"repository_owner"</span>
   <span>]</span>
<span>}</span>
</code></pre>
<p>In your cloud provider's OIDC configuration, configure the <code>sub</code> condition to require that claims must include a specific value for <code>environment</code> and <code>repository_owner</code>. For example: <code>"sub": "environment:production%3Aeastus:repository_owner:octo-org"</code>.</p>
<h4><a href="#resetting-organization-template-customizations">Resetting organization template customizations</a></h4>
<p>This example template resets the subject claims to the default format. This template effectively opts out of any organization-level customization policy.</p>
<p>To apply this configuration, submit a request to the API endpoint and include the required configuration in the request body. For organizations, see <a href="/en/rest/actions/oidc#set-the-customization-template-for-an-oidc-subject-claim-for-an-organization">REST API endpoints for GitHub Actions OIDC</a>, and for repositories, see <a href="/en/rest/actions/oidc#set-the-customization-template-for-an-oidc-subject-claim-for-a-repository">REST API endpoints for GitHub Actions OIDC</a>.</p>
<pre><code><span>{</span>
   <span>"include_claim_keys"</span><span>:</span> <span>[</span>
       <span>"repo"</span><span>,</span>
       <span>"context"</span>
   <span>]</span>
<span>}</span>
</code></pre>
<p>In your cloud provider's OIDC configuration, configure the <code>sub</code> condition to require that claims must include specific values for <code>repo</code> and <code>context</code>.</p>
<h4><a href="#resetting-repository-template-customizations">Resetting repository template customizations</a></h4>
<p>All repositories in an organization have the ability to opt in or opt out of (organization and repository-level) customized <code>sub</code> claim templates.</p>
<p>To opt out a repository and reset back to the default <code>sub</code> claim format, a repository administrator must use the REST API endpoint at <a href="/en/rest/actions/oidc#set-the-customization-template-for-an-oidc-subject-claim-for-a-repository">REST API endpoints for GitHub Actions OIDC</a>.</p>
<p>To configure repositories to use the default <code>sub</code> claim format, use the <code>PUT /repos/{owner}/{repo}/actions/oidc/customization/sub</code> REST API endpoint at with the following request body.</p>
<pre><code><span>{</span>
   <span>"use_default"</span><span>:</span> <span><span>true</span></span>
<span>}</span>
</code></pre>
<h4><a href="#example-configuring-a-repository-to-use-an-organization-template">Example: Configuring a repository to use an organization template</a></h4>
<p>Once an organization has created a customized <code>sub</code> claim template, the REST API can be used to programmatically apply the template to repositories within the organization. A repository administrator can configure their repository to use the template created by the administrator of their organization.</p>
<p>To configure the repository to use the organization's template, a repository admin must use the <code>PUT /repos/{owner}/{repo}/actions/oidc/customization/sub</code> REST API endpoint at with the following request body. For more information, see <a href="/en/rest/actions/oidc#set-the-customization-template-for-an-oidc-subject-claim-for-a-repository">REST API endpoints for GitHub Actions OIDC</a>.</p>
<pre><code><span>{</span>
   <span>"use_default"</span><span>:</span> <span><span>false</span></span>
<span>}</span>
</code></pre>
<h2><a href="#updating-your-workflows-for-oidc">Updating your workflows for OIDC</a></h2>
<p>You can now update your YAML workflows to use OIDC access tokens instead of secrets. Popular cloud providers have published their official login actions that make it easy for you to get started with OIDC. For more information about updating your workflows, see the cloud-specific guides listed below in <a href="#enabling-openid-connect-for-your-cloud-provider">Enabling OpenID Connect for your cloud provider</a>.</p>
<h2><a href="#enabling-openid-connect-for-python-package-publishing">Enabling OpenID Connect for Python package publishing</a></h2>
<p>You can use a GitHub Actions workflow in a repository as a trusted publisher for a PyPI project. Using a workflow as a trusted publisher allows OIDC access tokens to be exchanged for temporary PyPI API tokens. For more information, see <a href="/en/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-pypi">Configuring OpenID Connect in PyPI</a> and <a href="https://docs.pypi.org/trusted-publishers/">Publishing to PyPI with a Trusted Publisher</a> in the PyPI documentation.</p>
<h2><a href="#enabling-openid-connect-for-your-cloud-provider">Enabling OpenID Connect for your cloud provider</a></h2>
<p>To enable and configure OIDC for your specific cloud provider, see the following guides:</p>
<ul>
<li><a href="/en/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-amazon-web-services">Configuring OpenID Connect in Amazon Web Services</a></li>
<li><a href="/en/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-azure">Configuring OpenID Connect in Azure</a></li>
<li><a href="/en/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-google-cloud-platform">Configuring OpenID Connect in Google Cloud Platform</a></li>
<li><a href="/en/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-hashicorp-vault">Configuring OpenID Connect in HashiCorp Vault</a></li>
</ul>
<p>To enable and configure OIDC for another cloud provider, see the following guide:</p>
<ul>
<li><a href="/en/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-cloud-providers">Configuring OpenID Connect in cloud providers</a></li>
</ul>
<h2><a href="#debugging-your-oidc-claims">Debugging your OIDC claims</a></h2>
<p>You can use the <a href="https://github.com/github/actions-oidc-debugger"><code>github/actions-oidc-debugger</code></a> action to visualize the claims that would be sent, before integrating with a cloud provider. This action requests a JWT and prints the claims included within the JWT that were received from GitHub Actions.</p>
</div></div></div>
</div>
</div></main>
</div></body></html>