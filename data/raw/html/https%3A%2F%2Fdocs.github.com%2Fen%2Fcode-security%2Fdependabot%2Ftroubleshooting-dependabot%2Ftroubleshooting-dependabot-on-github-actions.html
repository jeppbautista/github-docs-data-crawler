<html><body><div>
<main><div>
<div><nav><ul>
<li>
<a title="Secure coding" href="/en/code-security">Secure coding</a><span>/</span>
</li>
<li>
<a title="Dependabot" href="/en/code-security/dependabot">Dependabot</a><span>/</span>
</li>
<li>
<a title="Troubleshoot Dependabot" href="/en/code-security/dependabot/troubleshooting-dependabot">Troubleshoot Dependabot</a><span>/</span>
</li>
<li><a title="Troubleshoot Dependabot on Actions" href="/en/code-security/dependabot/troubleshooting-dependabot/troubleshooting-dependabot-on-github-actions">Troubleshoot Dependabot on Actions</a></li>
</ul></nav></div>
<div>
<div><div><h1>Troubleshooting Dependabot on GitHub Actions</h1></div></div>
<div><div><p>This article provides troubleshooting information for issues you may encounter when using Dependabot with GitHub Actions.</p></div></div>
<div>
<h2>In this article</h2>
<nav><ul>
<li><a href="#restrictions-when-dependabot-triggers-events"><div><span>Restrictions when Dependabot triggers events</span></div></a></li>
<li><a href="#troubleshooting-failures-when-dependabot-triggers-existing-workflows"><div><span>Troubleshooting failures when Dependabot triggers existing workflows</span></div></a></li>
<li><a href="#manually-re-running-a-workflow"><div><span>Manually re-running a workflow</span></div></a></li>
</ul></nav>
</div>
<div><div><div>
<h2><a href="#restrictions-when-dependabot-triggers-events">Restrictions when Dependabot triggers events</a></h2>
<p>Dependabot is able to trigger GitHub Actions workflows on its pull requests and comments; however, certain events are treated differently.</p>
<p>For workflows initiated by Dependabot (<code>github.actor == 'dependabot[bot]'</code>) using the <code>pull_request</code>, <code>pull_request_review</code>, <code>pull_request_review_comment</code>, <code>push</code>, <code>create</code>, <code>deployment</code>, and <code>deployment_status</code> events, these restrictions apply:</p>
<ul>
<li>
<code>GITHUB_TOKEN</code> has read-only permissions by default.</li>
<li>Secrets are populated from Dependabot secrets. GitHub Actions secrets are not available.</li>
</ul>
<p>For workflows initiated by Dependabot (<code>github.actor == 'dependabot[bot]'</code>) using the <code>pull_request_target</code> event, if the base ref of the pull request was created by Dependabot (<code>github.event.pull_request.user.login == 'dependabot[bot]'</code>), the <code>GITHUB_TOKEN</code> will be read-only and secrets are not available.</p>
<p>These restrictions apply even if the workflow is re-run by a different actor.</p>
<p>For more information, see <a href="https://securitylab.github.com/research/github-actions-preventing-pwn-requests/">Keeping your GitHub Actions and workflows secure: Preventing pwn requests</a>.</p>
<h2><a href="#troubleshooting-failures-when-dependabot-triggers-existing-workflows">Troubleshooting failures when Dependabot triggers existing workflows</a></h2>
<p>After you set up Dependabot updates for GitHub.com, you may see failures when existing workflows are triggered by Dependabot events.</p>
<p>By default, GitHub Actions workflow runs that are triggered by Dependabot from <code>push</code>, <code>pull_request</code>, <code>pull_request_review</code>, or <code>pull_request_review_comment</code> events are treated as if they were opened from a repository fork. Unlike workflows triggered by other actors, this means they receive a read-only <code>GITHUB_TOKEN</code> and do not have access to any secrets that are normally available. This will cause any workflows that attempt to write to the repository to fail when they are triggered by Dependabot.</p>
<p>There are three ways to resolve this problem:</p>
<ol>
<li>You can update your workflows so that they are no longer triggered by Dependabot using an expression like: <code>if: github.actor != 'dependabot[bot]'</code>. For more information, see <a href="/en/actions/learn-github-actions/expressions">Evaluate expressions in workflows and actions</a>.</li>
<li>You can modify your workflows to use a two-step process that includes <code>pull_request_target</code> which does not have these limitations. For more information, see <a href="/en/code-security/dependabot/troubleshooting-dependabot/troubleshooting-dependabot-on-github-actions#restrictions-when-dependabot-triggers-events">Troubleshooting Dependabot on GitHub Actions</a>.</li>
<li>You can provide workflows triggered by Dependabot access to secrets and allow the <code>permissions</code> term to increase the default scope of the <code>GITHUB_TOKEN</code>.</li>
</ol>
<p>Some troubleshooting advice is provided in this article. You can also see <a href="/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idpermissions">Workflow syntax for GitHub Actions</a>.</p>
<h3><a href="#accessing-secrets">Accessing secrets</a></h3>
<p>When a Dependabot event triggers a workflow, the only secrets available to the workflow are Dependabot secrets. GitHub Actions secrets are <strong>not available</strong>. You must therefore store any secrets that are used by a workflow triggered by Dependabot events as Dependabot secrets. For more information, see <a href="/en/code-security/dependabot/working-with-dependabot/configuring-access-to-private-registries-for-dependabot#storing-credentials-for-dependabot-to-use">Configuring access to private registries for Dependabot</a>.</p>
<p>Dependabot secrets are added to the <code>secrets</code> context and referenced using exactly the same syntax as secrets for GitHub Actions. For more information, see <a href="/en/actions/security-guides/encrypted-secrets#using-encrypted-secrets-in-a-workflow">Using secrets in GitHub Actions</a>.</p>
<p>If you have a workflow that will be triggered by Dependabot and also by other actors, the simplest solution is to store the token with the permissions required in an action and in a Dependabot secret with identical names. Then the workflow can include a single call to these secrets. If the secret for Dependabot has a different name, use conditions to specify the correct secrets for different actors to use.</p>
<p>For examples that use conditions, see <a href="/en/code-security/dependabot/working-with-dependabot/automating-dependabot-with-github-actions">Automating Dependabot with GitHub Actions</a>.</p>
<p>To access a private container registry on AWS with a user name and password, a workflow must include a secret for <code>username</code> and <code>password</code>.</p>
<p>In this example, when Dependabot triggers the workflow, the Dependabot secrets with the names <code>READONLY_AWS_ACCESS_KEY_ID</code> and <code>READONLY_AWS_ACCESS_KEY</code> are used. If another actor triggers the workflow, the actions secrets with those names are used.</p>
<div>
<header><span>YAML</span><pre>name: CI
on:
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Login to private container registry for dependencies
        uses: docker/login-action@3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2c
        with:
          registry: https://1234567890.dkr.ecr.us-east-1.amazonaws.com
          username: ${{ secrets.READONLY_AWS_ACCESS_KEY_ID }}
          password: ${{ secrets.READONLY_AWS_ACCESS_KEY }}

      - name: Build the Docker image
        run: docker build . --file Dockerfile --tag my-image-name:$(date +%s)
</pre></header><pre><code><span>name:</span> <span>CI</span>
<span>on:</span>
  <span>pull_request:</span>
    <span>branches:</span> [ <span>main</span> ]

<span>jobs:</span>
  <span>build:</span>
    <span>runs-on:</span> <span>ubuntu-latest</span>
    <span>steps:</span>
      <span>-</span> <span>name:</span> <span>Checkout</span> <span>repository</span>
        <span>uses:</span> <span>actions/checkout@v4</span>

      <span>-</span> <span>name:</span> <span>Login</span> <span>to</span> <span>private</span> <span>container</span> <span>registry</span> <span>for</span> <span>dependencies</span>
        <span>uses:</span> <span>docker/login-action@3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2c</span>
        <span>with:</span>
          <span>registry:</span> <span>https://1234567890.dkr.ecr.us-east-1.amazonaws.com</span>
          <span>username:</span> <span>${{</span> <span>secrets.READONLY_AWS_ACCESS_KEY_ID</span> <span>}}</span>
          <span>password:</span> <span>${{</span> <span>secrets.READONLY_AWS_ACCESS_KEY</span> <span>}}</span>

      <span>-</span> <span>name:</span> <span>Build</span> <span>the</span> <span>Docker</span> <span>image</span>
        <span>run:</span> <span>docker</span> <span>build</span> <span>.</span> <span>--file</span> <span>Dockerfile</span> <span>--tag</span> <span>my-image-name:$(date</span> <span>+%s)</span>
</code></pre>
</div>
<h3><a href="#changing-github_token-permissions">Changing <code>GITHUB_TOKEN</code> permissions</a></h3>
<p>By default, GitHub Actions workflows triggered by Dependabot get a <code>GITHUB_TOKEN</code> with read-only permissions. You can use the <code>permissions</code> key in your workflow to increase the access for the token:</p>
<div>
<header><span>YAML</span><pre>name: CI
on: pull_request

# Set the access for individual scopes, or use permissions: write-all
permissions:
  pull-requests: write
  issues: write
  ...

jobs:
  ...
</pre></header><pre><code><span>name:</span> <span>CI</span>
<span>on:</span> <span>pull_request</span>

<span># Set the access for individual scopes, or use permissions: write-all</span>
<span>permissions:</span>
  <span>pull-requests:</span> <span>write</span>
  <span>issues:</span> <span>write</span>
  <span>...</span>

<span>jobs:</span>
  <span>...</span>
</code></pre>
</div>
<p>For more information, see <a href="/en/actions/security-guides/automatic-token-authentication#modifying-the-permissions-for-the-github_token">Automatic token authentication</a>.</p>
<h2><a href="#manually-re-running-a-workflow">Manually re-running a workflow</a></h2>
<p>When you manually re-run a Dependabot workflow, it will run with the same privileges as before even if the user who initiated the rerun has different privileges. For more information, see <a href="/en/actions/managing-workflow-runs/re-running-workflows-and-jobs">Re-running workflows and jobs</a>.</p>
</div></div></div>
</div>
</div></main>
</div></body></html>