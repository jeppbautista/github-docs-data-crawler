<html><body><div>
<main><div>
<div><nav><ul>
<li>
<a title="GitHub Copilot" href="/en/copilot">GitHub Copilot</a><span>/</span>
</li>
<li>
<a title="Copilot Chat Cookbook" href="/en/copilot/copilot-chat-cookbook">Copilot Chat Cookbook</a><span>/</span>
</li>
<li>
<a title="Debugging errors" href="/en/copilot/copilot-chat-cookbook/debugging-errors">Debugging errors</a><span>/</span>
</li>
<li><a title="Handle API rate limits" href="/en/copilot/copilot-chat-cookbook/debugging-errors/handling-api-rate-limits">Handle API rate limits</a></li>
</ul></nav></div>
<div>
<div><div><h1>Handling API rate limits</h1></div></div>
<div><div><p>Copilot Chat can help handle API  rate limits by suggesting code that detects implements retry logic.</p></div></div>
<div>
<h2>In this article</h2>
<nav><ul>
<li><a href="#example-scenario"><div><span>Example scenario</span></div></a></li>
<li><a href="#example-prompt"><div><span>Example prompt</span></div></a></li>
<li><a href="#example-response"><div><span>Example response</span></div></a></li>
<li><a href="#further-reading"><div><span>Further reading</span></div></a></li>
</ul></nav>
</div>
<div><div><div>
<p>When making requests to APIs, it's common to encounter rate limits that restrict the number of calls you can make within a certain time frame. GitHub Copilot Chat can help you handle these limits by suggesting code to detect rate limit responses and automatically retry requests after a delay.</p>
<h2><a href="#example-scenario">Example scenario</a></h2>
<p>The following Python code fetches weather data from an external API. If the API has rate limits, requests may fail when limits are exceeded, and your app may need a way to handle these responses gracefully by implementing retry logic.</p>
<pre><code><span>from</span> flask <span>import</span> Flask, request
<span>import</span> requests

app = Flask(__name__)

WEATHER_API_URL = <span>"https://api.example.com/weather"</span>

<span>@app.route(<span><span>'/get_weather'</span>, methods=[<span>'GET'</span>]</span>)</span>
<span>def</span> <span>get_weather</span>():
    city = request.args.get(<span>'city'</span>)
    <span># Simulate an API request to the external weather service</span>
    response = requests.get(WEATHER_API_URL, params={<span>"city"</span>: city})
    weather_data = response.json()

    <span>return</span> weather_data
</code></pre>
<h2><a href="#example-prompt">Example prompt</a></h2>
<p><code>How can I handle API rate limits within get_weather().</code></p>
<h2><a href="#example-response">Example response</a></h2>
<div>
<p> The following response is an example. Copilot Chat responses are non-deterministic, so you may get a different response from the one shown here.</p>
</div>
<p>Copilot might suggest code that implements a retry mechanism with exponential backoff to limit the frequency of retry attempts.</p>
<p>For example:</p>
<pre><code><span>import</span> requests
<span>from</span> flask <span>import</span> Flask, request
<span>from</span> requests.adapters <span>import</span> HTTPAdapter
<span>from</span> requests.packages.urllib3.util.retry <span>import</span> Retry

app = Flask(__name__)

WEATHER_API_URL = <span>"https://api.example.com/weather"</span>

<span>def</span> <span>requests_retry_session</span>(<span>
    retries=<span>3</span>,
    backoff_factor=<span>0.3</span>,
    status_forcelist=(<span><span>500</span>, <span>502</span>, <span>504</span></span>),
    session=<span>None</span>,
</span>):
    session = session <span>or</span> requests.Session()
    retry = Retry(
        total=retries,
        read=retries,
        connect=retries,
        backoff_factor=backoff_factor,
        status_forcelist=status_forcelist,
    )
    adapter = HTTPAdapter(max_retries=retry)
    session.mount(<span>"http://"</span>, adapter)
    session.mount(<span>"https://"</span>, adapter)
    <span>return</span> session

<span>@app.route(<span><span>'/get_weather'</span>, methods=[<span>'GET'</span>]</span>)</span>
<span>def</span> <span>get_weather</span>():
    city = request.args.get(<span>'city'</span>)
    <span>try</span>:
        response = requests_retry_session().get(WEATHER_API_URL, params={<span>"city"</span>: city})
        response.raise_for_status()
        weather_data = response.json()
    <span>except</span> requests.exceptions.RequestException <span>as</span> e:
        <span>return</span> {<span>"error"</span>: <span>str</span>(e)}, <span>500</span>

    <span>return</span> weather_data
</code></pre>
<p>In this example, Copilot's suggestions include setting up a retry session that allows the code to automatically retry requests if they fail due to specific status codes (500, 502, 504). The <code>backoff_factor</code> gradually increases the delay between retries, helping avoid exceeding the API's rate limit further.</p>
<h2><a href="#further-reading">Further reading</a></h2>
<ul>
<li><a href="/en/copilot/using-github-copilot/prompt-engineering-for-github-copilot">Prompt engineering for Copilot Chat</a></li>
<li><a href="/en/copilot/using-github-copilot/best-practices-for-using-github-copilot">Best practices for using GitHub Copilot</a></li>
</ul>
</div></div></div>
</div>
</div></main>
</div></body></html>