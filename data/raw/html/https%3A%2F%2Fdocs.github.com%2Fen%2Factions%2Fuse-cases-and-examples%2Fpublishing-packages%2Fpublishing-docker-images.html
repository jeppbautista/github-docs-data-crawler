<html><body><div>
<main><div>
<div><nav><ul>
<li>
<a title="GitHub Actions" href="/en/actions">GitHub Actions</a><span>/</span>
</li>
<li>
<a title="Use cases and examples" href="/en/actions/use-cases-and-examples">Use cases and examples</a><span>/</span>
</li>
<li>
<a title="Publish packages" href="/en/actions/use-cases-and-examples/publishing-packages">Publish packages</a><span>/</span>
</li>
<li><a title="Publish Docker images" href="/en/actions/use-cases-and-examples/publishing-packages/publishing-docker-images">Publish Docker images</a></li>
</ul></nav></div>
<div>
<div><div><h1>Publishing Docker images</h1></div></div>
<div><div><p>You can publish Docker images to a registry, such as Docker Hub or GitHub Packages, as part of your continuous integration (CI) workflow.</p></div></div>
<div>
<h2>In this article</h2>
<nav><ul>
<li><a href="#introduction"><div><span>Introduction</span></div></a></li>
<li><a href="#prerequisites"><div><span>Prerequisites</span></div></a></li>
<li><a href="#about-image-configuration"><div><span>About image configuration</span></div></a></li>
<li><a href="#publishing-images-to-docker-hub"><div><span>Publishing images to Docker Hub</span></div></a></li>
<li><a href="#publishing-images-to-github-packages"><div><span>Publishing images to GitHub Packages</span></div></a></li>
<li><a href="#publishing-images-to-docker-hub-and-github-packages"><div><span>Publishing images to Docker Hub and GitHub Packages</span></div></a></li>
</ul></nav>
</div>
<div><div><div>
<h2><a href="#introduction">Introduction</a></h2>
<p>This guide shows you how to create a workflow that performs a Docker build, and then publishes Docker images to Docker Hub or GitHub Packages. With a single workflow, you can publish images to a single registry or to multiple registries.</p>
<div>
<p>
If you want to push to another third-party Docker registry, the example in the <a href="#publishing-images-to-github-packages">Publishing images to GitHub Packages</a> section can serve as a good template.</p>
</div>
<h2><a href="#prerequisites">Prerequisites</a></h2>
<p>We recommend that you have a basic understanding of workflow configuration options and how to create a workflow file. For more information, see <a href="/en/actions/learn-github-actions">Writing workflows</a>.</p>
<p>You might also find it helpful to have a basic understanding of the following:</p>
<ul>
<li><a href="/en/actions/security-guides/using-secrets-in-github-actions">Using secrets in GitHub Actions</a></li>
<li><a href="/en/actions/security-guides/automatic-token-authentication">Automatic token authentication</a></li>
<li><a href="/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry">Working with the Container registry</a></li>
</ul>
<h2><a href="#about-image-configuration">About image configuration</a></h2>
<p>This guide assumes that you have a complete definition for a Docker image stored in a GitHub repository. For example, your repository must contain a <em>Dockerfile</em>, and any other files needed to perform a Docker build to create an image.</p>
<p>You can use pre-defined annotation keys to add metadata including a description, a license, and a source repository to your container image. For more information, see <a href="/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry#labelling-container-images">Working with the Container registry</a>.</p>
<p>In this guide, we will use the Docker <code>build-push-action</code> action to build the Docker image and push it to one or more Docker registries. For more information, see <a href="https://github.com/marketplace/actions/build-and-push-docker-images"><code>build-push-action</code></a>.</p>
<h2><a href="#publishing-images-to-docker-hub">Publishing images to Docker Hub</a></h2>
<div>
<p>
Docker Hub normally imposes rate limits on both push and pull operations which will affect jobs on self-hosted runners. However, GitHub-hosted runners are not subject to these limits based on an agreement between GitHub and Docker.</p>
</div>
<p>Each time you create a new release on GitHub, you can trigger a workflow to publish your image. The workflow in the example below runs when the <code>release</code> event triggers with the <code>published</code> activity type.</p>
<p>In the example workflow below, we use the Docker <code>login-action</code> and <code>build-push-action</code> actions to build the Docker image and, if the build succeeds, push the built image to Docker Hub.</p>
<p>To push to Docker Hub, you will need to have a Docker Hub account, and have a Docker Hub repository created. For more information, see <a href="https://docs.docker.com/docker-hub/quickstart/#step-3-build-and-push-an-image-to-docker-hub">Pushing a Docker container image to Docker Hub</a> in the Docker documentation.</p>
<p>The <code>login-action</code> options required for Docker Hub are:</p>
<ul>
<li>
<code>username</code> and <code>password</code>: This is your Docker Hub username and password. We recommend storing your Docker Hub username and password as secrets so they aren't exposed in your workflow file. For more information, see <a href="/en/actions/security-guides/using-secrets-in-github-actions">Using secrets in GitHub Actions</a>.</li>
</ul>
<p>The <code>metadata-action</code> option required for Docker Hub is:</p>
<ul>
<li>
<code>images</code>: The namespace and name for the Docker image you are building/pushing to Docker Hub.</li>
</ul>
<p>The <code>build-push-action</code> options required for Docker Hub are:</p>
<ul>
<li>
<code>tags</code>: The tag of your new image in the format <code>DOCKER-HUB-NAMESPACE/DOCKER-HUB-REPOSITORY:VERSION</code>. You can set a single tag as shown below, or specify multiple tags in a list.</li>
<li>
<code>push</code>: If set to <code>true</code>, the image will be pushed to the registry if it is built successfully.</li>
</ul>
<div>
<header><span>YAML</span><pre># This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

# GitHub recommends pinning actions to a commit SHA.
# To get a newer version, you will need to update the SHA.
# You can also reference a tag or branch, but the action may change without warning.

name: Publish Docker image

on:
  release:
    types: [published]

jobs:
  push_to_registry:
    name: Push Docker image to Docker Hub
    runs-on: ubuntu-latest
    permissions:
      packages: write
      contents: read
      attestations: write
      id-token: write
    steps:
      - name: Check out the repo
        uses: actions/checkout@v4

      - name: Log in to Docker Hub
        uses: docker/login-action@f4ef78c080cd8ba55a85445d5b36e214a81df20a
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      - name: Extract metadata (tags, labels) for Docker
        id: meta
        uses: docker/metadata-action@9ec57ed1fcdbf14dcef7dfbe97b2010124a938b7
        with:
          images: my-docker-hub-namespace/my-docker-hub-repository

      - name: Build and push Docker image
        id: push
        uses: docker/build-push-action@3b5e8027fcad23fda98b2e3ac259d8d67585f671
        with:
          context: .
          file: ./Dockerfile
          push: true
          tags: ${{ steps.meta.outputs.tags }}
          labels: ${{ steps.meta.outputs.labels }}

      - name: Generate artifact attestation
        uses: actions/attest-build-provenance@v2
        with:
          subject-name: index.docker.io/my-docker-hub-namespace/my-docker-hub-repository
          subject-digest: ${{ steps.push.outputs.digest }}
          push-to-registry: true
</pre></header><pre><code><span># This workflow uses actions that are not certified by GitHub.</span>
<span># They are provided by a third-party and are governed by</span>
<span># separate terms of service, privacy policy, and support</span>
<span># documentation.</span>

<span># GitHub recommends pinning actions to a commit SHA.</span>
<span># To get a newer version, you will need to update the SHA.</span>
<span># You can also reference a tag or branch, but the action may change without warning.</span>

<span>name:</span> <span>Publish</span> <span>Docker</span> <span>image</span>

<span>on:</span>
  <span>release:</span>
    <span>types:</span> [<span>published</span>]

<span>jobs:</span>
  <span>push_to_registry:</span>
    <span>name:</span> <span>Push</span> <span>Docker</span> <span>image</span> <span>to</span> <span>Docker</span> <span>Hub</span>
    <span>runs-on:</span> <span>ubuntu-latest</span>
    <span>permissions:</span>
      <span>packages:</span> <span>write</span>
      <span>contents:</span> <span>read</span>
      <span>attestations:</span> <span>write</span>
      <span>id-token:</span> <span>write</span>
    <span>steps:</span>
      <span>-</span> <span>name:</span> <span>Check</span> <span>out</span> <span>the</span> <span>repo</span>
        <span>uses:</span> <span>actions/checkout@v4</span>

      <span>-</span> <span>name:</span> <span>Log</span> <span>in</span> <span>to</span> <span>Docker</span> <span>Hub</span>
        <span>uses:</span> <span>docker/login-action@f4ef78c080cd8ba55a85445d5b36e214a81df20a</span>
        <span>with:</span>
          <span>username:</span> <span>${{</span> <span>secrets.DOCKER_USERNAME</span> <span>}}</span>
          <span>password:</span> <span>${{</span> <span>secrets.DOCKER_PASSWORD</span> <span>}}</span>

      <span>-</span> <span>name:</span> <span>Extract</span> <span>metadata</span> <span>(tags,</span> <span>labels)</span> <span>for</span> <span>Docker</span>
        <span>id:</span> <span>meta</span>
        <span>uses:</span> <span>docker/metadata-action@9ec57ed1fcdbf14dcef7dfbe97b2010124a938b7</span>
        <span>with:</span>
          <span>images:</span> <span>my-docker-hub-namespace/my-docker-hub-repository</span>

      <span>-</span> <span>name:</span> <span>Build</span> <span>and</span> <span>push</span> <span>Docker</span> <span>image</span>
        <span>id:</span> <span>push</span>
        <span>uses:</span> <span>docker/build-push-action@3b5e8027fcad23fda98b2e3ac259d8d67585f671</span>
        <span>with:</span>
          <span>context:</span> <span>.</span>
          <span>file:</span> <span>./Dockerfile</span>
          <span>push:</span> <span>true</span>
          <span>tags:</span> <span>${{</span> <span>steps.meta.outputs.tags</span> <span>}}</span>
          <span>labels:</span> <span>${{</span> <span>steps.meta.outputs.labels</span> <span>}}</span>

      <span>-</span> <span>name:</span> <span>Generate</span> <span>artifact</span> <span>attestation</span>
        <span>uses:</span> <span>actions/attest-build-provenance@v2</span>
        <span>with:</span>
          <span>subject-name:</span> <span>index.docker.io/my-docker-hub-namespace/my-docker-hub-repository</span>
          <span>subject-digest:</span> <span>${{</span> <span>steps.push.outputs.digest</span> <span>}}</span>
          <span>push-to-registry:</span> <span>true</span>
</code></pre>
</div>
<p>The above workflow checks out the GitHub repository, uses the <code>login-action</code> to log in to the registry, and then uses the <code>build-push-action</code> action to: build a Docker image based on your repository's <code>Dockerfile</code>; push the image to Docker Hub, and apply a tag to the image.</p>
<p>In the last step, it generates an artifact attestation for the image, which increases supply chain security. For more information, see <a href="/en/actions/security-guides/using-artifact-attestations-to-establish-provenance-for-builds">Using artifact attestations to establish provenance for builds</a>.</p>
<h2><a href="#publishing-images-to-github-packages">Publishing images to GitHub Packages</a></h2>
<p>Each time you create a new release on GitHub, you can trigger a workflow to publish your image. The workflow in the example below runs when a change is pushed to the <code>release</code> branch.</p>
<p>In the example workflow below, we use the Docker <code>login-action</code>, <code>metadata-action</code>, and <code>build-push-action</code> actions to build the Docker image, and if the build succeeds, push the built image to GitHub Packages.</p>
<p>The <code>login-action</code> options required for GitHub Packages are:</p>
<ul>
<li>
<code>registry</code>: Must be set to <code>ghcr.io</code>.</li>
<li>
<code>username</code>: You can use the <code>${{ github.actor }}</code> context to automatically use the username of the user that triggered the workflow run. For more information, see <a href="/en/actions/learn-github-actions/contexts#github-context">Accessing contextual information about workflow runs</a>.</li>
<li>
<code>password</code>: You can use the automatically-generated <code>GITHUB_TOKEN</code> secret for the password. For more information, see <a href="/en/actions/security-guides/automatic-token-authentication">Automatic token authentication</a>.</li>
</ul>
<p>The <code>metadata-action</code> option required for GitHub Packages is:</p>
<ul>
<li>
<code>images</code>: The namespace and name for the Docker image you are building.</li>
</ul>
<p>The <code>build-push-action</code> options required for GitHub Packages are:</p>
<ul>
<li>
<code>context</code>: Defines the build's context as the set of files located in the specified path.</li>
<li>
<code>push</code>: If set to <code>true</code>, the image will be pushed to the registry if it is built successfully.</li>
<li>
<code>tags</code> and <code>labels</code>: These are populated by output from <code>metadata-action</code>.</li>
</ul>
<div>
<ul>
<li>This workflow uses actions that are not certified by GitHub. They are provided by a third-party and are governed by separate terms of service, privacy policy, and support documentation.</li>
<li>GitHub recommends pinning actions to a commit SHA. To get a newer version, you will need to update the SHA. You can also reference a tag or branch, but the action may change without warning.</li>
</ul>
</div>
<div>
<div><header><span>YAML</span><div>
<button>Beside</button><button>Inline</button>
</div>
<pre>#
name: Create and publish a Docker image

# Configures this workflow to run every time a change is pushed to the branch called `release`.
on:
  push:
    branches: ['release']

# Defines two custom environment variables for the workflow. These are used for the Container registry domain, and a name for the Docker image that this workflow builds.
env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}

# There is a single job in this workflow. It's configured to run on the latest available version of Ubuntu.
jobs:
  build-and-push-image:
    runs-on: ubuntu-latest
    # Sets the permissions granted to the `GITHUB_TOKEN` for the actions in this job.
    permissions:
      contents: read
      packages: write
      attestations: write
      id-token: write
      #
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      # Uses the `docker/login-action` action to log in to the Container registry registry using the account and password that will publish the packages. Once published, the packages are scoped to the account defined here.
      - name: Log in to the Container registry
        uses: docker/login-action@65b78e6e13532edd9afa3aa52ac7964289d1a9c1
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      # This step uses [docker/metadata-action](https://github.com/docker/metadata-action#about) to extract tags and labels that will be applied to the specified image. The `id` "meta" allows the output of this step to be referenced in a subsequent step. The `images` value provides the base name for the tags and labels.
      - name: Extract metadata (tags, labels) for Docker
        id: meta
        uses: docker/metadata-action@9ec57ed1fcdbf14dcef7dfbe97b2010124a938b7
        with:
          images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}
      # This step uses the `docker/build-push-action` action to build the image, based on your repository's `Dockerfile`. If the build succeeds, it pushes the image to GitHub Packages.
      # It uses the `context` parameter to define the build's context as the set of files located in the specified path. For more information, see [Usage](https://github.com/docker/build-push-action#usage) in the README of the `docker/build-push-action` repository.
      # It uses the `tags` and `labels` parameters to tag and label the image with the output from the "meta" step.
      - name: Build and push Docker image
        id: push
        uses: docker/build-push-action@f2a1d5e99d037542a71f64918e516c093c6f3fc4
        with:
          context: .
          push: true
          tags: ${{ steps.meta.outputs.tags }}
          labels: ${{ steps.meta.outputs.labels }}
      
      # This step generates an artifact attestation for the image, which is an unforgeable statement about where and how it was built. It increases supply chain security for people who consume the image. For more information, see [Using artifact attestations to establish provenance for builds](/actions/security-guides/using-artifact-attestations-to-establish-provenance-for-builds).
      - name: Generate artifact attestation
        uses: actions/attest-build-provenance@v2
        with:
          subject-name: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME}}
          subject-digest: ${{ steps.push.outputs.digest }}
          push-to-registry: true
      
</pre></header></div>
<div>
<div><div><pre><code><span>name:</span> <span>Create</span> <span>and</span> <span>publish</span> <span>a</span> <span>Docker</span> <span>image</span></code></pre></div></div>
<div>
<div><pre><code><span>on:</span>
  <span>push:</span>
    <span>branches:</span> [<span>'release'</span>]</code></pre></div>
<div><p>Configures this workflow to run every time a change is pushed to the branch called <code>release</code>.</p></div>
</div>
<div>
<div><pre><code><span>env:</span>
  <span>REGISTRY:</span> <span>ghcr.io</span>
  <span>IMAGE_NAME:</span> <span>${{</span> <span>github.repository</span> <span>}}</span></code></pre></div>
<div><p>Defines two custom environment variables for the workflow. These are used for the Container registry domain, and a name for the Docker image that this workflow builds.</p></div>
</div>
<div>
<div><pre><code><span>jobs:</span>
  <span>build-and-push-image:</span>
    <span>runs-on:</span> <span>ubuntu-latest</span></code></pre></div>
<div><p>There is a single job in this workflow. It's configured to run on the latest available version of Ubuntu.</p></div>
</div>
<div>
<div><pre><code>    <span>permissions:</span>
      <span>contents:</span> <span>read</span>
      <span>packages:</span> <span>write</span>
      <span>attestations:</span> <span>write</span>
      <span>id-token:</span> <span>write</span></code></pre></div>
<div><p>Sets the permissions granted to the <code>GITHUB_TOKEN</code> for the actions in this job.</p></div>
</div>
<div><div><pre><code>    <span>steps:</span>
      <span>-</span> <span>name:</span> <span>Checkout</span> <span>repository</span>
        <span>uses:</span> <span>actions/checkout@v4</span></code></pre></div></div>
<div>
<div><pre><code>      <span>-</span> <span>name:</span> <span>Log</span> <span>in</span> <span>to</span> <span>the</span> <span>Container</span> <span>registry</span>
        <span>uses:</span> <span>docker/login-action@65b78e6e13532edd9afa3aa52ac7964289d1a9c1</span>
        <span>with:</span>
          <span>registry:</span> <span>${{</span> <span>env.REGISTRY</span> <span>}}</span>
          <span>username:</span> <span>${{</span> <span>github.actor</span> <span>}}</span>
          <span>password:</span> <span>${{</span> <span>secrets.GITHUB_TOKEN</span> <span>}}</span></code></pre></div>
<div><p>Uses the <code>docker/login-action</code> action to log in to the Container registry registry using the account and password that will publish the packages. Once published, the packages are scoped to the account defined here.</p></div>
</div>
<div>
<div><pre><code>      <span>-</span> <span>name:</span> <span>Extract</span> <span>metadata</span> <span>(tags,</span> <span>labels)</span> <span>for</span> <span>Docker</span>
        <span>id:</span> <span>meta</span>
        <span>uses:</span> <span>docker/metadata-action@9ec57ed1fcdbf14dcef7dfbe97b2010124a938b7</span>
        <span>with:</span>
          <span>images:</span> <span>${{</span> <span>env.REGISTRY</span> <span>}}/${{</span> <span>env.IMAGE_NAME</span> <span>}}</span></code></pre></div>
<div><p>This step uses <a href="https://github.com/docker/metadata-action#about">docker/metadata-action</a> to extract tags and labels that will be applied to the specified image. The <code>id</code> "meta" allows the output of this step to be referenced in a subsequent step. The <code>images</code> value provides the base name for the tags and labels.</p></div>
</div>
<div>
<div><pre><code>      <span>-</span> <span>name:</span> <span>Build</span> <span>and</span> <span>push</span> <span>Docker</span> <span>image</span>
        <span>id:</span> <span>push</span>
        <span>uses:</span> <span>docker/build-push-action@f2a1d5e99d037542a71f64918e516c093c6f3fc4</span>
        <span>with:</span>
          <span>context:</span> <span>.</span>
          <span>push:</span> <span>true</span>
          <span>tags:</span> <span>${{</span> <span>steps.meta.outputs.tags</span> <span>}}</span>
          <span>labels:</span> <span>${{</span> <span>steps.meta.outputs.labels</span> <span>}}</span></code></pre></div>
<div><p>This step uses the <code>docker/build-push-action</code> action to build the image, based on your repository's <code>Dockerfile</code>. If the build succeeds, it pushes the image to GitHub Packages.
It uses the <code>context</code> parameter to define the build's context as the set of files located in the specified path. For more information, see <a href="https://github.com/docker/build-push-action#usage">Usage</a> in the README of the <code>docker/build-push-action</code> repository.
It uses the <code>tags</code> and <code>labels</code> parameters to tag and label the image with the output from the "meta" step.</p></div>
</div>
<div>
<div><pre><code>      <span>-</span> <span>name:</span> <span>Generate</span> <span>artifact</span> <span>attestation</span>
        <span>uses:</span> <span>actions/attest-build-provenance@v2</span>
        <span>with:</span>
          <span>subject-name:</span> <span>${{</span> <span>env.REGISTRY</span> <span>}}/${{</span> <span>env.IMAGE_NAME}}</span>
          <span>subject-digest:</span> <span>${{</span> <span>steps.push.outputs.digest</span> <span>}}</span>
          <span>push-to-registry:</span> <span>true</span></code></pre></div>
<div><p>This step generates an artifact attestation for the image, which is an unforgeable statement about where and how it was built. It increases supply chain security for people who consume the image. For more information, see <a href="/actions/security-guides/using-artifact-attestations-to-establish-provenance-for-builds">Using artifact attestations to establish provenance for builds</a>.</p></div>
</div>
</div>
<div><pre><code><span>#</span>
<span>name:</span> <span>Create</span> <span>and</span> <span>publish</span> <span>a</span> <span>Docker</span> <span>image</span>

<span># Configures this workflow to run every time a change is pushed to the branch called `release`.</span>
<span>on:</span>
  <span>push:</span>
    <span>branches:</span> [<span>'release'</span>]

<span># Defines two custom environment variables for the workflow. These are used for the Container registry domain, and a name for the Docker image that this workflow builds.</span>
<span>env:</span>
  <span>REGISTRY:</span> <span>ghcr.io</span>
  <span>IMAGE_NAME:</span> <span>${{</span> <span>github.repository</span> <span>}}</span>

<span># There is a single job in this workflow. It's configured to run on the latest available version of Ubuntu.</span>
<span>jobs:</span>
  <span>build-and-push-image:</span>
    <span>runs-on:</span> <span>ubuntu-latest</span>
    <span># Sets the permissions granted to the `GITHUB_TOKEN` for the actions in this job.</span>
    <span>permissions:</span>
      <span>contents:</span> <span>read</span>
      <span>packages:</span> <span>write</span>
      <span>attestations:</span> <span>write</span>
      <span>id-token:</span> <span>write</span>
      <span>#</span>
    <span>steps:</span>
      <span>-</span> <span>name:</span> <span>Checkout</span> <span>repository</span>
        <span>uses:</span> <span>actions/checkout@v4</span>
      <span># Uses the `docker/login-action` action to log in to the Container registry registry using the account and password that will publish the packages. Once published, the packages are scoped to the account defined here.</span>
      <span>-</span> <span>name:</span> <span>Log</span> <span>in</span> <span>to</span> <span>the</span> <span>Container</span> <span>registry</span>
        <span>uses:</span> <span>docker/login-action@65b78e6e13532edd9afa3aa52ac7964289d1a9c1</span>
        <span>with:</span>
          <span>registry:</span> <span>${{</span> <span>env.REGISTRY</span> <span>}}</span>
          <span>username:</span> <span>${{</span> <span>github.actor</span> <span>}}</span>
          <span>password:</span> <span>${{</span> <span>secrets.GITHUB_TOKEN</span> <span>}}</span>
      <span># This step uses [docker/metadata-action](https://github.com/docker/metadata-action#about) to extract tags and labels that will be applied to the specified image. The `id` "meta" allows the output of this step to be referenced in a subsequent step. The `images` value provides the base name for the tags and labels.</span>
      <span>-</span> <span>name:</span> <span>Extract</span> <span>metadata</span> <span>(tags,</span> <span>labels)</span> <span>for</span> <span>Docker</span>
        <span>id:</span> <span>meta</span>
        <span>uses:</span> <span>docker/metadata-action@9ec57ed1fcdbf14dcef7dfbe97b2010124a938b7</span>
        <span>with:</span>
          <span>images:</span> <span>${{</span> <span>env.REGISTRY</span> <span>}}/${{</span> <span>env.IMAGE_NAME</span> <span>}}</span>
      <span># This step uses the `docker/build-push-action` action to build the image, based on your repository's `Dockerfile`. If the build succeeds, it pushes the image to GitHub Packages.</span>
      <span># It uses the `context` parameter to define the build's context as the set of files located in the specified path. For more information, see [Usage](https://github.com/docker/build-push-action#usage) in the README of the `docker/build-push-action` repository.</span>
      <span># It uses the `tags` and `labels` parameters to tag and label the image with the output from the "meta" step.</span>
      <span>-</span> <span>name:</span> <span>Build</span> <span>and</span> <span>push</span> <span>Docker</span> <span>image</span>
        <span>id:</span> <span>push</span>
        <span>uses:</span> <span>docker/build-push-action@f2a1d5e99d037542a71f64918e516c093c6f3fc4</span>
        <span>with:</span>
          <span>context:</span> <span>.</span>
          <span>push:</span> <span>true</span>
          <span>tags:</span> <span>${{</span> <span>steps.meta.outputs.tags</span> <span>}}</span>
          <span>labels:</span> <span>${{</span> <span>steps.meta.outputs.labels</span> <span>}}</span>
      
      <span># This step generates an artifact attestation for the image, which is an unforgeable statement about where and how it was built. It increases supply chain security for people who consume the image. For more information, see [Using artifact attestations to establish provenance for builds](/actions/security-guides/using-artifact-attestations-to-establish-provenance-for-builds).</span>
      <span>-</span> <span>name:</span> <span>Generate</span> <span>artifact</span> <span>attestation</span>
        <span>uses:</span> <span>actions/attest-build-provenance@v2</span>
        <span>with:</span>
          <span>subject-name:</span> <span>${{</span> <span>env.REGISTRY</span> <span>}}/${{</span> <span>env.IMAGE_NAME}}</span>
          <span>subject-digest:</span> <span>${{</span> <span>steps.push.outputs.digest</span> <span>}}</span>
          <span>push-to-registry:</span> <span>true</span>
      
</code></pre></div>
</div>
<p>The above workflow is triggered by a push to the "release" branch. It checks out the GitHub repository, and uses the <code>login-action</code> to log in to the Container registry. It then extracts labels and tags for the Docker image. Finally, it uses the <code>build-push-action</code> action to build the image and publish it on the Container registry.</p>
<h2><a href="#publishing-images-to-docker-hub-and-github-packages">Publishing images to Docker Hub and GitHub Packages</a></h2>
<p>In a single workflow, you can publish your Docker image to multiple registries by using the <code>login-action</code> and <code>build-push-action</code> actions for each registry.</p>
<p>The following example workflow uses the steps from the previous sections (<a href="#publishing-images-to-docker-hub">Publishing images to Docker Hub</a> and <a href="#publishing-images-to-github-packages">Publishing images to GitHub Packages</a>) to create a single workflow that pushes to both registries.</p>
<div>
<header><span>YAML</span><pre># This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

# GitHub recommends pinning actions to a commit SHA.
# To get a newer version, you will need to update the SHA.
# You can also reference a tag or branch, but the action may change without warning.

name: Publish Docker image

on:
  release:
    types: [published]

jobs:
  push_to_registries:
    name: Push Docker image to multiple registries
    runs-on: ubuntu-latest
    permissions:
      packages: write
      contents: read
      attestations: write
      id-token: write
    steps:
      - name: Check out the repo
        uses: actions/checkout@v4

      - name: Log in to Docker Hub
        uses: docker/login-action@f4ef78c080cd8ba55a85445d5b36e214a81df20a
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      - name: Log in to the Container registry
        uses: docker/login-action@65b78e6e13532edd9afa3aa52ac7964289d1a9c1
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: Extract metadata (tags, labels) for Docker
        id: meta
        uses: docker/metadata-action@9ec57ed1fcdbf14dcef7dfbe97b2010124a938b7
        with:
          images: |
            my-docker-hub-namespace/my-docker-hub-repository
            ghcr.io/${{ github.repository }}

      - name: Build and push Docker images
        id: push
        uses: docker/build-push-action@3b5e8027fcad23fda98b2e3ac259d8d67585f671
        with:
          context: .
          push: true
          tags: ${{ steps.meta.outputs.tags }}
          labels: ${{ steps.meta.outputs.labels }}

      - name: Generate artifact attestation
        uses: actions/attest-build-provenance@v2
        with:
          subject-name: ghcr.io/${{ github.repository }}
          subject-digest: ${{ steps.push.outputs.digest }}
          push-to-registry: true
</pre></header><pre><code><span># This workflow uses actions that are not certified by GitHub.</span>
<span># They are provided by a third-party and are governed by</span>
<span># separate terms of service, privacy policy, and support</span>
<span># documentation.</span>

<span># GitHub recommends pinning actions to a commit SHA.</span>
<span># To get a newer version, you will need to update the SHA.</span>
<span># You can also reference a tag or branch, but the action may change without warning.</span>

<span>name:</span> <span>Publish</span> <span>Docker</span> <span>image</span>

<span>on:</span>
  <span>release:</span>
    <span>types:</span> [<span>published</span>]

<span>jobs:</span>
  <span>push_to_registries:</span>
    <span>name:</span> <span>Push</span> <span>Docker</span> <span>image</span> <span>to</span> <span>multiple</span> <span>registries</span>
    <span>runs-on:</span> <span>ubuntu-latest</span>
    <span>permissions:</span>
      <span>packages:</span> <span>write</span>
      <span>contents:</span> <span>read</span>
      <span>attestations:</span> <span>write</span>
      <span>id-token:</span> <span>write</span>
    <span>steps:</span>
      <span>-</span> <span>name:</span> <span>Check</span> <span>out</span> <span>the</span> <span>repo</span>
        <span>uses:</span> <span>actions/checkout@v4</span>

      <span>-</span> <span>name:</span> <span>Log</span> <span>in</span> <span>to</span> <span>Docker</span> <span>Hub</span>
        <span>uses:</span> <span>docker/login-action@f4ef78c080cd8ba55a85445d5b36e214a81df20a</span>
        <span>with:</span>
          <span>username:</span> <span>${{</span> <span>secrets.DOCKER_USERNAME</span> <span>}}</span>
          <span>password:</span> <span>${{</span> <span>secrets.DOCKER_PASSWORD</span> <span>}}</span>

      <span>-</span> <span>name:</span> <span>Log</span> <span>in</span> <span>to</span> <span>the</span> <span>Container</span> <span>registry</span>
        <span>uses:</span> <span>docker/login-action@65b78e6e13532edd9afa3aa52ac7964289d1a9c1</span>
        <span>with:</span>
          <span>registry:</span> <span>ghcr.io</span>
          <span>username:</span> <span>${{</span> <span>github.actor</span> <span>}}</span>
          <span>password:</span> <span>${{</span> <span>secrets.GITHUB_TOKEN</span> <span>}}</span>

      <span>-</span> <span>name:</span> <span>Extract</span> <span>metadata</span> <span>(tags,</span> <span>labels)</span> <span>for</span> <span>Docker</span>
        <span>id:</span> <span>meta</span>
        <span>uses:</span> <span>docker/metadata-action@9ec57ed1fcdbf14dcef7dfbe97b2010124a938b7</span>
        <span>with:</span>
          <span>images:</span> <span>|
            my-docker-hub-namespace/my-docker-hub-repository
            ghcr.io/${{ github.repository }}
</span>
      <span>-</span> <span>name:</span> <span>Build</span> <span>and</span> <span>push</span> <span>Docker</span> <span>images</span>
        <span>id:</span> <span>push</span>
        <span>uses:</span> <span>docker/build-push-action@3b5e8027fcad23fda98b2e3ac259d8d67585f671</span>
        <span>with:</span>
          <span>context:</span> <span>.</span>
          <span>push:</span> <span>true</span>
          <span>tags:</span> <span>${{</span> <span>steps.meta.outputs.tags</span> <span>}}</span>
          <span>labels:</span> <span>${{</span> <span>steps.meta.outputs.labels</span> <span>}}</span>

      <span>-</span> <span>name:</span> <span>Generate</span> <span>artifact</span> <span>attestation</span>
        <span>uses:</span> <span>actions/attest-build-provenance@v2</span>
        <span>with:</span>
          <span>subject-name:</span> <span>ghcr.io/${{</span> <span>github.repository</span> <span>}}</span>
          <span>subject-digest:</span> <span>${{</span> <span>steps.push.outputs.digest</span> <span>}}</span>
          <span>push-to-registry:</span> <span>true</span>
</code></pre>
</div>
<p>The above workflow checks out the GitHub repository, uses the <code>login-action</code> twice to log in to both registries and generates tags and labels with the <code>metadata-action</code> action.
Then the <code>build-push-action</code> action builds and pushes the Docker image to Docker Hub and the Container registry.</p>
<p>In the last step, it generates an artifact attestation for the image, which increases supply chain security. For more information, see <a href="/en/actions/security-guides/using-artifact-attestations-to-establish-provenance-for-builds">Using artifact attestations to establish provenance for builds</a>.</p>
</div></div></div>
</div>
</div></main>
</div></body></html>