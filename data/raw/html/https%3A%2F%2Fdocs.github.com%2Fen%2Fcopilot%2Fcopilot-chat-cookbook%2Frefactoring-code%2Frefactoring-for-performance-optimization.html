<html><body><div>
<main><div>
<div><nav><ul>
<li>
<a title="GitHub Copilot" href="/en/copilot">GitHub Copilot</a><span>/</span>
</li>
<li>
<a title="Copilot Chat Cookbook" href="/en/copilot/copilot-chat-cookbook">Copilot Chat Cookbook</a><span>/</span>
</li>
<li>
<a title="Refactoring code" href="/en/copilot/copilot-chat-cookbook/refactoring-code">Refactoring code</a><span>/</span>
</li>
<li><a title="Performance optimization" href="/en/copilot/copilot-chat-cookbook/refactoring-code/refactoring-for-performance-optimization">Performance optimization</a></li>
</ul></nav></div>
<div>
<div><div><h1>Refactoring for performance optimization</h1></div></div>
<div><div><p>Copilot Chat can suggest ways to speed up slow-running code.</p></div></div>
<div>
<h2>In this article</h2>
<nav><ul>
<li><a href="#example-scenario"><div><span>Example scenario</span></div></a></li>
<li><a href="#example-prompt"><div><span>Example prompt</span></div></a></li>
<li><a href="#example-response"><div><span>Example response</span></div></a></li>
<li><a href="#further-reading"><div><span>Further reading</span></div></a></li>
</ul></nav>
</div>
<div><div><div>
<p>Existing code may function correctly but be inefficient, leading to performance bottlenecks. Examples of coding that can adversely impact performance include inefficient loops, unnecessary computations, and excessive memory allocation.</p>
<p>Copilot Chat can identify performance hotspots and suggest refactoring strategies such as optimizing data structures (for example, using hashmaps instead of arrays), reducing redundant calculations, and improving algorithmic efficiency. It can also recommend caching mechanisms or parallelizing operations to improve performance.</p>
<h2><a href="#example-scenario">Example scenario</a></h2>
<p>The following Python code prints every 1000th prime number up to the 10,000th prime. It includes a timer, and prints how long the code takes to run as the last line of the output. The program takes several seconds to complete.</p>
<pre><code><span>import</span> time

<span>def</span> <span>is_prime</span>(<span>n</span>):
    <span>if</span> n &lt;= <span>1</span>:
        <span>return</span> <span>False</span>
    <span>for</span> i <span>in</span> <span>range</span>(<span>2</span>, n):
        <span>if</span> n % i == <span>0</span>:
            <span>return</span> <span>False</span>
    <span>return</span> <span>True</span>

<span>def</span> <span>every_1000th_prime</span>():
    primes = []
    num = <span>2</span>
    <span>while</span> <span>len</span>(primes) &lt; <span>10000</span>:
        <span>if</span> is_prime(num):
            primes.append(num)
        num += <span>1</span>
    <span>return</span> [primes[i] <span>for</span> i <span>in</span> <span>range</span>(<span>999</span>, <span>10000</span>, <span>1000</span>)]

<span>if</span> __name__ == <span>"__main__"</span>:
    start_time = time.time()
    primes = every_1000th_prime()
    <span>for</span> prime <span>in</span> primes:
        <span>print</span>(prime)
    end_time = time.time()
    elapsed_time = end_time - start_time
    <span>print</span>(<span>f"Time taken: <span>{elapsed_time:<span>.10</span>f}</span> seconds"</span>)
</code></pre>
<h2><a href="#example-prompt">Example prompt</a></h2>
<p><code>Optimize this code for performance</code></p>
<h2><a href="#example-response">Example response</a></h2>
<p>Copilot suggests using a sieve function to generate the prime numbers much more efficiently. If you run this program it will complete in a fraction of a second.</p>
<div>
<p> Copilot Chat responses are non-deterministic, so you may get a different response from the one shown here.</p>
</div>
<pre><code><span>import</span> time

<span>def</span> <span>sieve_of_eratosthenes</span>(<span>limit</span>):
    sieve = [<span>True</span>] * (limit + <span>1</span>)
    sieve[<span>0</span>] = sieve[<span>1</span>] = <span>False</span>
    <span>for</span> start <span>in</span> <span>range</span>(<span>2</span>, <span>int</span>(limit**<span>0.5</span>) + <span>1</span>):
        <span>if</span> sieve[start]:
            <span>for</span> multiple <span>in</span> <span>range</span>(start*start, limit + <span>1</span>, start):
                sieve[multiple] = <span>False</span>
    <span>return</span> [num <span>for</span> num, is_prime <span>in</span> <span>enumerate</span>(sieve) <span>if</span> is_prime]

<span>def</span> <span>every_1000th_prime</span>():
    limit = <span>105000</span>  <span># Higher than needed to ensure 10,000 primes</span>
    primes = sieve_of_eratosthenes(limit)
    <span>return</span> [primes[i] <span>for</span> i <span>in</span> <span>range</span>(<span>999</span>, <span>10000</span>, <span>1000</span>)]

<span>if</span> __name__ == <span>"__main__"</span>:
    start_time = time.time()
    primes = every_1000th_prime()
    <span>for</span> prime <span>in</span> primes:
        <span>print</span>(prime)
    end_time = time.time()
    elapsed_time = end_time - start_time
    <span>print</span>(<span>f"Time taken: <span>{elapsed_time:<span>.10</span>f}</span> seconds"</span>)
</code></pre>
<h2><a href="#further-reading">Further reading</a></h2>
<ul>
<li><a href="/en/copilot/using-github-copilot/prompt-engineering-for-github-copilot">Prompt engineering for Copilot Chat</a></li>
<li><a href="/en/copilot/using-github-copilot/best-practices-for-using-github-copilot">Best practices for using GitHub Copilot</a></li>
</ul>
</div></div></div>
</div>
</div></main>
</div></body></html>