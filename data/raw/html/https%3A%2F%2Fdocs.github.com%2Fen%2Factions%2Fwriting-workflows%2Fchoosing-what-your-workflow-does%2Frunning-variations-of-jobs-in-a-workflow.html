<html><body><div>
<main><div>
<div><nav><ul>
<li>
<a title="GitHub Actions" href="/en/actions">GitHub Actions</a><span>/</span>
</li>
<li>
<a title="Write workflows" href="/en/actions/writing-workflows">Write workflows</a><span>/</span>
</li>
<li>
<a title="Choose what workflows do" href="/en/actions/writing-workflows/choosing-what-your-workflow-does">Choose what workflows do</a><span>/</span>
</li>
<li><a title="Run job variations" href="/en/actions/writing-workflows/choosing-what-your-workflow-does/running-variations-of-jobs-in-a-workflow">Run job variations</a></li>
</ul></nav></div>
<div>
<div><div><h1>Running variations of jobs in a workflow</h1></div></div>
<div><div><p>Create a matrix to define variations for each job.</p></div></div>
<div>
<h2>In this article</h2>
<nav><ul>
<li><a href="#about-matrix-strategies"><div><span>About matrix strategies</span></div></a></li>
<li><a href="#using-a-matrix-strategy"><div><span>Using a matrix strategy</span></div></a></li>
<li><a href="#expanding-or-adding-matrix-configurations"><div><span>Expanding or adding matrix configurations</span></div></a></li>
<li><a href="#excluding-matrix-configurations"><div><span>Excluding matrix configurations</span></div></a></li>
<li><a href="#example-using-an-output-to-define-two-matrices"><div><span>Example: Using an output to define two matrices</span></div></a></li>
<li><a href="#handling-failures"><div><span>Handling failures</span></div></a></li>
<li><a href="#defining-the-maximum-number-of-concurrent-jobs"><div><span>Defining the maximum number of concurrent jobs</span></div></a></li>
</ul></nav>
</div>
<div><div><div>
<h2><a href="#about-matrix-strategies">About matrix strategies</a></h2>
<p>A matrix strategy lets you use variables in a single job definition to automatically create multiple job runs that are based on the combinations of the variables. For example, you can use a matrix strategy to test your code in multiple versions of a language or on multiple operating systems.</p>
<h2><a href="#using-a-matrix-strategy">Using a matrix strategy</a></h2>
<p>Use <code>jobs.&lt;job_id&gt;.strategy.matrix</code> to define a matrix of different job configurations. Within your matrix, define one or more variables followed by an array of values. For example, the following matrix has a variable called <code>version</code> with the value <code>[10, 12, 14]</code> and a variable called <code>os</code> with the value <code>[ubuntu-latest, windows-latest]</code>:</p>
<pre><code><span>jobs:</span>
  <span>example_matrix:</span>
    <span>strategy:</span>
      <span>matrix:</span>
        <span>version:</span> [<span>10</span>, <span>12</span>, <span>14</span>]
        <span>os:</span> [<span>ubuntu-latest</span>, <span>windows-latest</span>]
</code></pre>
<p>A job will run for each possible combination of the variables. In this example, the workflow will run six jobs, one for each combination of the <code>os</code> and <code>version</code> variables.</p>
<p>By default, GitHub will maximize the number of jobs run in parallel depending on runner availability. The order of the variables in the matrix determines the order in which the jobs are created. The first variable you define will be the first job that is created in your workflow run. For example, the above matrix will create the jobs in the following order:</p>
<ul>
<li><code>{version: 10, os: ubuntu-latest}</code></li>
<li><code>{version: 10, os: windows-latest}</code></li>
<li><code>{version: 12, os: ubuntu-latest}</code></li>
<li><code>{version: 12, os: windows-latest}</code></li>
<li><code>{version: 14, os: ubuntu-latest}</code></li>
<li><code>{version: 14, os: windows-latest}</code></li>
</ul>
<p>A matrix will generate a maximum of 256 jobs per workflow run. This limit applies to both GitHub-hosted and self-hosted runners.</p>
<p>The variables that you define become properties in the <code>matrix</code> context, and you can reference the property in other areas of your workflow file. In this example, you can use <code>matrix.version</code> and <code>matrix.os</code> to access the current value of <code>version</code> and <code>os</code> that the job is using. For more information, see <a href="/en/actions/learn-github-actions/contexts">Accessing contextual information about workflow runs</a>.</p>
<h3><a href="#example-using-a-single-dimension-matrix">Example: Using a single-dimension matrix</a></h3>
<p>You can specify a single variable to create a single-dimension matrix.</p>
<p>For example, the following workflow defines the variable <code>version</code> with the values <code>[10, 12, 14]</code>. The workflow will run three jobs, one for each value in the variable. Each job will access the <code>version</code> value through the <code>matrix.version</code> context and pass the value as <code>node-version</code> to the <code>actions/setup-node</code> action.</p>
<pre><code><span>jobs:</span>
  <span>example_matrix:</span>
    <span>strategy:</span>
      <span>matrix:</span>
        <span>version:</span> [<span>10</span>, <span>12</span>, <span>14</span>]
    <span>steps:</span>
      <span>-</span> <span>uses:</span> <span>actions/setup-node@v4</span>
        <span>with:</span>
          <span>node-version:</span> <span>${{</span> <span>matrix.version</span> <span>}}</span>
</code></pre>
<h3><a href="#example-using-a-multi-dimension-matrix">Example: Using a multi-dimension matrix</a></h3>
<p>You can specify multiple variables to create a multi-dimensional matrix. A job will run for each possible combination of the variables.</p>
<p>For example, the following workflow specifies two variables:</p>
<ul>
<li>Two operating systems specified in the <code>os</code> variable</li>
<li>Three Node.js versions specified in the <code>version</code> variable</li>
</ul>
<p>The workflow will run six jobs, one for each combination of the <code>os</code> and <code>version</code> variables. Each job will set the <code>runs-on</code> value to the current <code>os</code> value and will pass the current <code>version</code> value to the <code>actions/setup-node</code> action.</p>
<pre><code><span>jobs:</span>
  <span>example_matrix:</span>
    <span>strategy:</span>
      <span>matrix:</span>
        <span>os:</span> [<span>ubuntu-22.04</span>, <span>ubuntu-20.04</span>]
        <span>version:</span> [<span>10</span>, <span>12</span>, <span>14</span>]
    <span>runs-on:</span> <span>${{</span> <span>matrix.os</span> <span>}}</span>
    <span>steps:</span>
      <span>-</span> <span>uses:</span> <span>actions/setup-node@v4</span>
        <span>with:</span>
          <span>node-version:</span> <span>${{</span> <span>matrix.version</span> <span>}}</span>
</code></pre>
<p>A variable configuration in a matrix can be an <code>array</code> of <code>object</code>s.</p>
<pre><code><span>matrix:</span>
  <span>os:</span>
    <span>-</span> <span>ubuntu-latest</span>
    <span>-</span> <span>macos-latest</span>
  <span>node:</span>
    <span>-</span> <span>version:</span> <span>14</span>
    <span>-</span> <span>version:</span> <span>20</span>
      <span>env:</span> <span>NODE_OPTIONS=--openssl-legacy-provider</span>
</code></pre>
<p>This matrix produces 4 jobs with corresponding contexts.</p>
<pre><code><span>-</span> <span>matrix.os:</span> <span>ubuntu-latest</span>
  <span>matrix.node.version:</span> <span>14</span>
<span>-</span> <span>matrix.os:</span> <span>ubuntu-latest</span>
  <span>matrix.node.version:</span> <span>20</span>
  <span>matrix.node.env:</span> <span>NODE_OPTIONS=--openssl-legacy-provider</span>
<span>-</span> <span>matrix.os:</span> <span>macos-latest</span>
  <span>matrix.node.version:</span> <span>14</span>
<span>-</span> <span>matrix.os:</span> <span>macos-latest</span>
  <span>matrix.node.version:</span> <span>20</span>
  <span>matrix.node.env:</span> <span>NODE_OPTIONS=--openssl-legacy-provider</span>
</code></pre>
<h3><a href="#example-using-contexts-to-create-matrices">Example: Using contexts to create matrices</a></h3>
<p>You can use contexts to create matrices. For more information about contexts, see <a href="/en/actions/learn-github-actions/contexts">Accessing contextual information about workflow runs</a>.</p>
<p>For example, the following workflow triggers on the <code>repository_dispatch</code> event and uses information from the event payload to build the matrix. When a repository dispatch event is created with a payload like the one below, the matrix <code>version</code> variable will have a value of <code>[12, 14, 16]</code>. For more information about the <code>repository_dispatch</code> trigger, see <a href="/en/actions/using-workflows/events-that-trigger-workflows#repository_dispatch">Events that trigger workflows</a>.</p>
<pre><code><span>{</span>
  <span>"event_type"</span><span>:</span> <span>"test"</span><span>,</span>
  <span>"client_payload"</span><span>:</span> <span>{</span>
    <span>"versions"</span><span>:</span> <span>[</span><span>12</span><span>,</span> <span>14</span><span>,</span> <span>16</span><span>]</span>
  <span>}</span>
<span>}</span>
</code></pre>
<pre><code><span>on:</span>
  <span>repository_dispatch:</span>
    <span>types:</span>
      <span>-</span> <span>test</span>
 
<span>jobs:</span>
  <span>example_matrix:</span>
    <span>runs-on:</span> <span>ubuntu-latest</span>
    <span>strategy:</span>
      <span>matrix:</span>
        <span>version:</span> <span>${{</span> <span>github.event.client_payload.versions</span> <span>}}</span>
    <span>steps:</span>
      <span>-</span> <span>uses:</span> <span>actions/setup-node@v4</span>
        <span>with:</span>
          <span>node-version:</span> <span>${{</span> <span>matrix.version</span> <span>}}</span>
</code></pre>
<h2><a href="#expanding-or-adding-matrix-configurations">Expanding or adding matrix configurations</a></h2>
<p>Use <code>jobs.&lt;job_id&gt;.strategy.matrix.include</code> to expand existing matrix configurations or to add new configurations. The value of <code>include</code> is a list of objects.</p>
<p>For each object in the <code>include</code> list, the key:value pairs in the object will be added to each of the matrix combinations if none of the key:value pairs overwrite any of the original matrix values. If the object cannot be added to any of the matrix combinations, a new matrix combination will be created instead. Note that the original matrix values will not be overwritten, but added matrix values can be overwritten.</p>
<p>For example, this matrix:</p>
<pre><code><span>strategy:</span>
  <span>matrix:</span>
    <span>fruit:</span> [<span>apple</span>, <span>pear</span>]
    <span>animal:</span> [<span>cat</span>, <span>dog</span>]
    <span>include:</span>
      <span>-</span> <span>color:</span> <span>green</span>
      <span>-</span> <span>color:</span> <span>pink</span>
        <span>animal:</span> <span>cat</span>
      <span>-</span> <span>fruit:</span> <span>apple</span>
        <span>shape:</span> <span>circle</span>
      <span>-</span> <span>fruit:</span> <span>banana</span>
      <span>-</span> <span>fruit:</span> <span>banana</span>
        <span>animal:</span> <span>cat</span>
</code></pre>
<p>will result in six jobs with the following matrix combinations:</p>
<ul>
<li><code>{fruit: apple, animal: cat, color: pink, shape: circle}</code></li>
<li><code>{fruit: apple, animal: dog, color: green, shape: circle}</code></li>
<li><code>{fruit: pear, animal: cat, color: pink}</code></li>
<li><code>{fruit: pear, animal: dog, color: green}</code></li>
<li><code>{fruit: banana}</code></li>
<li><code>{fruit: banana, animal: cat}</code></li>
</ul>
<p>following this logic:</p>
<ul>
<li>
<code>{color: green}</code> is added to all of the original matrix combinations because it can be added without overwriting any part of the original combinations.</li>
<li>
<code>{color: pink, animal: cat}</code> adds <code>color:pink</code> only to the original matrix combinations that include <code>animal: cat</code>. This overwrites the <code>color: green</code> that was added by the previous <code>include</code> entry.</li>
<li>
<code>{fruit: apple, shape: circle}</code> adds <code>shape: circle</code> only to the original matrix combinations that include <code>fruit: apple</code>.</li>
<li>
<code>{fruit: banana}</code> cannot be added to any original matrix combination without overwriting a value, so it is added as an additional matrix combination.</li>
<li>
<code>{fruit: banana, animal: cat}</code> cannot be added to any original matrix combination without overwriting a value, so it is added as an additional matrix combination. It does not add to the <code>{fruit: banana}</code> matrix combination because that combination was not one of the original matrix combinations.</li>
</ul>
<h3><a href="#example-expanding-configurations">Example: Expanding configurations</a></h3>
<p>For example, the following workflow will run four jobs, one for each combination of <code>os</code> and <code>node</code>. When the job for the <code>os</code> value of <code>windows-latest</code> and <code>node</code> value of <code>16</code> runs, an additional variable called <code>npm</code> with the value of <code>6</code> will be included in the job.</p>
<pre><code><span>jobs:</span>
  <span>example_matrix:</span>
    <span>strategy:</span>
      <span>matrix:</span>
        <span>os:</span> [<span>windows-latest</span>, <span>ubuntu-latest</span>]
        <span>node:</span> [<span>14</span>, <span>16</span>]
        <span>include:</span>
          <span>-</span> <span>os:</span> <span>windows-latest</span>
            <span>node:</span> <span>16</span>
            <span>npm:</span> <span>6</span>
    <span>runs-on:</span> <span>${{</span> <span>matrix.os</span> <span>}}</span>
    <span>steps:</span>
      <span>-</span> <span>uses:</span> <span>actions/setup-node@v4</span>
        <span>with:</span>
          <span>node-version:</span> <span>${{</span> <span>matrix.node</span> <span>}}</span>
      <span>-</span> <span>if:</span> <span>${{</span> <span>matrix.npm</span> <span>}}</span>
        <span>run:</span> <span>npm</span> <span>install</span> <span>-g</span> <span>npm@${{</span> <span>matrix.npm</span> <span>}}</span>
      <span>-</span> <span>run:</span> <span>npm</span> <span>--version</span>
</code></pre>
<h3><a href="#example-adding-configurations">Example: Adding configurations</a></h3>
<p>For example, this matrix will run 10 jobs, one for each combination of <code>os</code> and <code>version</code> in the matrix, plus a job for the <code>os</code> value of <code>windows-latest</code> and <code>version</code> value of <code>17</code>.</p>
<pre><code><span>jobs:</span>
  <span>example_matrix:</span>
    <span>strategy:</span>
      <span>matrix:</span>
        <span>os:</span> [<span>macos-latest</span>, <span>windows-latest</span>, <span>ubuntu-latest</span>]
        <span>version:</span> [<span>12</span>, <span>14</span>, <span>16</span>]
        <span>include:</span>
          <span>-</span> <span>os:</span> <span>windows-latest</span>
            <span>version:</span> <span>17</span>
</code></pre>
<p>If you don't specify any matrix variables, all configurations under <code>include</code> will run. For example, the following workflow would run two jobs, one for each <code>include</code> entry. This lets you take advantage of the matrix strategy without having a fully populated matrix.</p>
<pre><code><span>jobs:</span>
  <span>includes_only:</span>
    <span>runs-on:</span> <span>ubuntu-latest</span>
    <span>strategy:</span>
      <span>matrix:</span>
        <span>include:</span>
          <span>-</span> <span>site:</span> <span>"production"</span>
            <span>datacenter:</span> <span>"site-a"</span>
          <span>-</span> <span>site:</span> <span>"staging"</span>
            <span>datacenter:</span> <span>"site-b"</span>
</code></pre>
<h2><a href="#excluding-matrix-configurations">Excluding matrix configurations</a></h2>
<p>To remove specific configurations defined in the matrix, use <code>jobs.&lt;job_id&gt;.strategy.matrix.exclude</code>. An excluded configuration only has to be a partial match for it to be excluded. For example, the following workflow will run nine jobs: one job for each of the 12 configurations, minus the one excluded job that matches <code>{os: macos-latest, version: 12, environment: production}</code>, and the two excluded jobs that match <code>{os: windows-latest, version: 16}</code>.</p>
<pre><code><span>strategy:</span>
  <span>matrix:</span>
    <span>os:</span> [<span>macos-latest</span>, <span>windows-latest</span>]
    <span>version:</span> [<span>12</span>, <span>14</span>, <span>16</span>]
    <span>environment:</span> [<span>staging</span>, <span>production</span>]
    <span>exclude:</span>
      <span>-</span> <span>os:</span> <span>macos-latest</span>
        <span>version:</span> <span>12</span>
        <span>environment:</span> <span>production</span>
      <span>-</span> <span>os:</span> <span>windows-latest</span>
        <span>version:</span> <span>16</span>
<span>runs-on:</span> <span>${{</span> <span>matrix.os</span> <span>}}</span>
</code></pre>
<div>
<p>
All <code>include</code> combinations are processed after <code>exclude</code>. This allows you to use <code>include</code> to add back combinations that were previously excluded.</p>
</div>
<h2><a href="#example-using-an-output-to-define-two-matrices">Example: Using an output to define two matrices</a></h2>
<p>You can use the output from one job to define matrices for multiple jobs.</p>
<p>For example, the following workflow demonstrates how to define a matrix of values in one job, use that matrix in a second jobs to produce artifacts, and then consume those artifacts in a third job. Each artifact is associated with a value from the matrix.</p>
<div>
<header><span>YAML</span><pre>name: shared matrix
on:
  push:
  workflow_dispatch:

jobs:
  define-matrix:
    runs-on: ubuntu-latest

    outputs:
      colors: ${{ steps.colors.outputs.colors }}

    steps:
      - name: Define Colors
        id: colors
        run: |
          echo 'colors=["red", "green", "blue"]' &gt;&gt; "$GITHUB_OUTPUT"

  produce-artifacts:
    runs-on: ubuntu-latest
    needs: define-matrix
    strategy:
      matrix:
        color: ${{ fromJSON(needs.define-matrix.outputs.colors) }}

    steps:
      - name: Define Color
        env:
          color: ${{ matrix.color }}
        run: |
          echo "$color" &gt; color
      - name: Produce Artifact
        uses: actions/upload-artifact@v4
        with:
          name: ${{ matrix.color }}
          path: color

  consume-artifacts:
    runs-on: ubuntu-latest
    needs:
    - define-matrix
    - produce-artifacts
    strategy:
      matrix:
        color: ${{ fromJSON(needs.define-matrix.outputs.colors) }}

    steps:
    - name: Retrieve Artifact
      uses: actions/download-artifact@v4
      with:
        name: ${{ matrix.color }}

    - name: Report Color
      run: |
        cat color
</pre></header><pre><code><span>name:</span> <span>shared</span> <span>matrix</span>
<span>on:</span>
  <span>push:</span>
  <span>workflow_dispatch:</span>

<span>jobs:</span>
  <span>define-matrix:</span>
    <span>runs-on:</span> <span>ubuntu-latest</span>

    <span>outputs:</span>
      <span>colors:</span> <span>${{</span> <span>steps.colors.outputs.colors</span> <span>}}</span>

    <span>steps:</span>
      <span>-</span> <span>name:</span> <span>Define</span> <span>Colors</span>
        <span>id:</span> <span>colors</span>
        <span>run:</span> <span>|
          echo 'colors=["red", "green", "blue"]' &gt;&gt; "$GITHUB_OUTPUT"
</span>
  <span>produce-artifacts:</span>
    <span>runs-on:</span> <span>ubuntu-latest</span>
    <span>needs:</span> <span>define-matrix</span>
    <span>strategy:</span>
      <span>matrix:</span>
        <span>color:</span> <span>${{</span> <span>fromJSON(needs.define-matrix.outputs.colors)</span> <span>}}</span>

    <span>steps:</span>
      <span>-</span> <span>name:</span> <span>Define</span> <span>Color</span>
        <span>env:</span>
          <span>color:</span> <span>${{</span> <span>matrix.color</span> <span>}}</span>
        <span>run:</span> <span>|
          echo "$color" &gt; color
</span>      <span>-</span> <span>name:</span> <span>Produce</span> <span>Artifact</span>
        <span>uses:</span> <span>actions/upload-artifact@v4</span>
        <span>with:</span>
          <span>name:</span> <span>${{</span> <span>matrix.color</span> <span>}}</span>
          <span>path:</span> <span>color</span>

  <span>consume-artifacts:</span>
    <span>runs-on:</span> <span>ubuntu-latest</span>
    <span>needs:</span>
    <span>-</span> <span>define-matrix</span>
    <span>-</span> <span>produce-artifacts</span>
    <span>strategy:</span>
      <span>matrix:</span>
        <span>color:</span> <span>${{</span> <span>fromJSON(needs.define-matrix.outputs.colors)</span> <span>}}</span>

    <span>steps:</span>
    <span>-</span> <span>name:</span> <span>Retrieve</span> <span>Artifact</span>
      <span>uses:</span> <span>actions/download-artifact@v4</span>
      <span>with:</span>
        <span>name:</span> <span>${{</span> <span>matrix.color</span> <span>}}</span>

    <span>-</span> <span>name:</span> <span>Report</span> <span>Color</span>
      <span>run:</span> <span>|
        cat color
</span></code></pre>
</div>
<h2><a href="#handling-failures">Handling failures</a></h2>
<p>You can control how job failures are handled with <code>jobs.&lt;job_id&gt;.strategy.fail-fast</code> and <code>jobs.&lt;job_id&gt;.continue-on-error</code>.</p>
<p><code>jobs.&lt;job_id&gt;.strategy.fail-fast</code> applies to the entire matrix. If <code>jobs.&lt;job_id&gt;.strategy.fail-fast</code> is set to <code>true</code> or its expression evaluates to <code>true</code>, GitHub will cancel all in-progress and queued jobs in the matrix if any job in the matrix fails. This property defaults to <code>true</code>.</p>
<p><code>jobs.&lt;job_id&gt;.continue-on-error</code> applies to a single job. If <code>jobs.&lt;job_id&gt;.continue-on-error</code> is <code>true</code>, other jobs in the matrix will continue running even if the job with <code>jobs.&lt;job_id&gt;.continue-on-error: true</code> fails.</p>
<p>You can use <code>jobs.&lt;job_id&gt;.strategy.fail-fast</code> and <code>jobs.&lt;job_id&gt;.continue-on-error</code> together. For example, the following workflow will start four jobs. For each job, <code>continue-on-error</code> is determined by the value of <code>matrix.experimental</code>. If any of the jobs with <code>continue-on-error: false</code> fail, all jobs that are in progress or queued will be cancelled. If the job with <code>continue-on-error: true</code> fails, the other jobs will not be affected.</p>
<pre><code><span>jobs:</span>
  <span>test:</span>
    <span>runs-on:</span> <span>ubuntu-latest</span>
    <span>continue-on-error:</span> <span>${{</span> <span>matrix.experimental</span> <span>}}</span>
    <span>strategy:</span>
      <span>fail-fast:</span> <span>true</span>
      <span>matrix:</span>
        <span>version:</span> [<span>6</span>, <span>7</span>, <span>8</span>]
        <span>experimental:</span> [<span>false</span>]
        <span>include:</span>
          <span>-</span> <span>version:</span> <span>9</span>
            <span>experimental:</span> <span>true</span>
</code></pre>
<h2><a href="#defining-the-maximum-number-of-concurrent-jobs">Defining the maximum number of concurrent jobs</a></h2>
<p>By default, GitHub will maximize the number of jobs run in parallel depending on runner availability. To set the maximum number of jobs that can run simultaneously when using a <code>matrix</code> job strategy, use <code>jobs.&lt;job_id&gt;.strategy.max-parallel</code>.</p>
<p>For example, the following workflow will run a maximum of two jobs at a time, even if there are runners available to run all six jobs at once.</p>
<pre><code><span>jobs:</span>
  <span>example_matrix:</span>
    <span>strategy:</span>
      <span>max-parallel:</span> <span>2</span>
      <span>matrix:</span>
        <span>version:</span> [<span>10</span>, <span>12</span>, <span>14</span>]
        <span>os:</span> [<span>ubuntu-latest</span>, <span>windows-latest</span>]
</code></pre>
</div></div></div>
</div>
</div></main>
</div></body></html>