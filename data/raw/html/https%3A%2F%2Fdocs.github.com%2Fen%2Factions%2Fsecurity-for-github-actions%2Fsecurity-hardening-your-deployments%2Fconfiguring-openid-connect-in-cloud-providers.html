<html><body><div>
<main><div>
<div><nav><ul>
<li>
<a title="GitHub Actions" href="/en/actions">GitHub Actions</a><span>/</span>
</li>
<li>
<a title="Security" href="/en/actions/security-for-github-actions">Security</a><span>/</span>
</li>
<li>
<a title="Security harden deployments" href="/en/actions/security-for-github-actions/security-hardening-your-deployments">Security harden deployments</a><span>/</span>
</li>
<li><a title="OpenID Connect in cloud providers" href="/en/actions/security-for-github-actions/security-hardening-your-deployments/configuring-openid-connect-in-cloud-providers">OpenID Connect in cloud providers</a></li>
</ul></nav></div>
<div>
<div><div><h1>Configuring OpenID Connect in cloud providers</h1></div></div>
<div><div><p>Use OpenID Connect within your workflows to authenticate with cloud providers.</p></div></div>
<div>
<h2>In this article</h2>
<nav><ul>
<li><a href="#overview"><div><span>Overview</span></div></a></li>
<li><a href="#prerequisites"><div><span>Prerequisites</span></div></a></li>
<li><a href="#updating-your-github-actions-workflow"><div><span>Updating your GitHub Actions workflow</span></div></a></li>
<li><a href="#using-custom-actions"><div><span>Using custom actions</span></div></a></li>
<li><a href="#further-reading"><div><span>Further reading</span></div></a></li>
</ul></nav>
</div>
<div><div><div>
<h2><a href="#overview">Overview</a></h2>
<p>OpenID Connect (OIDC) allows your GitHub Actions workflows to access resources in your cloud provider, without having to store any credentials as long-lived GitHub secrets.</p>
<p>To use OIDC, you will first need to configure your cloud provider to trust GitHub's OIDC as a federated identity, and must then update your workflows to authenticate using tokens.</p>
<h2><a href="#prerequisites">Prerequisites</a></h2>
<ul>
<li>
<p>To learn the basic concepts of how GitHub uses OpenID Connect (OIDC), and its architecture and benefits, see <a href="/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect">About security hardening with OpenID Connect</a>.</p>
</li>
<li>
<p>Before proceeding, you must plan your security strategy to ensure that access tokens are only allocated in a predictable way. To control how your cloud provider issues access tokens, you <strong>must</strong> define at least one condition, so that untrusted repositories canâ€™t request access tokens for your cloud resources. For more information, see <a href="/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect#configuring-the-oidc-trust-with-the-cloud">About security hardening with OpenID Connect</a>.</p>
</li>
</ul>
<h2><a href="#updating-your-github-actions-workflow">Updating your GitHub Actions workflow</a></h2>
<p>To update your workflows for OIDC, you will need to make two changes to your YAML:</p>
<ol>
<li>Add permissions settings for the token.</li>
<li>Use the official action from your cloud provider to exchange the OIDC token (JWT) for a cloud access token.</li>
</ol>
<p>If your cloud provider doesn't yet offer an official action, you can update your workflows to perform these steps manually.</p>
<div>
<p>
When environments are used in workflows or in OIDC policies, we recommend adding protection rules to the environment for additional security. For example, you can configure deployment rules on an environment to restrict which branches and tags can deploy to the environment or access environment secrets. For more information, see <a href="/en/actions/deployment/targeting-different-environments/managing-environments-for-deployment#deployment-protection-rules">Managing environments for deployment</a>.</p>
</div>
<h3><a href="#adding-permissions-settings">Adding permissions settings</a></h3>
<p>The job or workflow run requires a <code>permissions</code> setting with <a href="/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github_token"><code>id-token: write</code></a> to allow GitHub's OIDC provider to create a JSON Web Token for every run. You won't be able to request the OIDC JWT ID token if the <code>permissions</code> for <code>id-token</code> is not set to <code>write</code>, however this value doesn't imply granting write access to any resources, only being able to fetch and set the OIDC token for an action or step to enable authenticating with a short-lived access token. Any actual trust setting is defined using OIDC claims, for more information see <a href="/en/actions/security-for-github-actions/security-hardening-your-deployments/about-security-hardening-with-openid-connect#configuring-the-oidc-trust-with-the-cloud">About security hardening with OpenID Connect</a>.</p>
<p>The <code>id-token: write</code> setting allows the JWT to be requested from GitHub's OIDC provider using one of these approaches:</p>
<ul>
<li>Using environment variables on the runner (<code>ACTIONS_ID_TOKEN_REQUEST_URL</code> and <code>ACTIONS_ID_TOKEN_REQUEST_TOKEN</code>).</li>
<li>Using <code>getIDToken()</code> from the Actions toolkit.</li>
</ul>
<p>If you need to fetch an OIDC token for a workflow, then the permission can be set at the workflow level. For example:</p>
<div>
<header><span>YAML</span><pre>permissions:
  id-token: write # This is required for requesting the JWT
  contents: read  # This is required for actions/checkout
</pre></header><pre><code><span>permissions:</span>
  <span>id-token:</span> <span>write</span> <span># This is required for requesting the JWT</span>
  <span>contents:</span> <span>read</span>  <span># This is required for actions/checkout</span>
</code></pre>
</div>
<p>If you only need to fetch an OIDC token for a single job, then this permission can be set within that job. For example:</p>
<div>
<header><span>YAML</span><pre>permissions:
  id-token: write # This is required for requesting the JWT
</pre></header><pre><code><span>permissions:</span>
  <span>id-token:</span> <span>write</span> <span># This is required for requesting the JWT</span>
</code></pre>
</div>
<p>You may need to specify additional permissions here, depending on your workflow's requirements.</p>
<p>For reusable workflows that are owned by the same user, organization, or enterprise as the caller workflow, the OIDC token generated in the reusable workflow can be accessed from the caller's context.
For reusable workflows outside your enterprise or organization, the <code>permissions</code> setting for <code>id-token</code> should be explicitly set to <code>write</code> at the caller workflow level or in the specific job that calls the reusable workflow.
This ensures that the OIDC token generated in the reusable workflow is only allowed to be consumed in the caller workflows when intended.</p>
<p>For more information, see <a href="/en/actions/using-workflows/reusing-workflows">Reusing workflows</a>.</p>
<h3><a href="#using-official-actions">Using official actions</a></h3>
<p>If your cloud provider has created an official action for using OIDC with GitHub Actions, it will allow you to easily exchange the OIDC token for an access token. You can then update your workflows to use this token when accessing cloud resources.</p>
<p>For example, Alibaba Cloud created <a href="https://github.com/aliyun/configure-aliyun-credentials-action"><code>aliyun/configure-aliyun-credentials-action</code></a> to integrate with using OIDC with GitHub.</p>
<h2><a href="#using-custom-actions">Using custom actions</a></h2>
<p>If your cloud provider doesn't have an official action, or if you prefer to create custom scripts, you can manually request the JSON Web Token (JWT) from GitHub's OIDC provider.</p>
<p>If you're not using an official action, then GitHub recommends that you use the Actions core toolkit. Alternatively, you can use the following environment variables to retrieve the token: <code>ACTIONS_ID_TOKEN_REQUEST_TOKEN</code>, <code>ACTIONS_ID_TOKEN_REQUEST_URL</code>.</p>
<p>To update your workflows using this approach, you will need to make three changes to your YAML:</p>
<ol>
<li>Add permissions settings for the token.</li>
<li>Add code that requests the OIDC token from GitHub's OIDC provider.</li>
<li>Add code that exchanges the OIDC token with your cloud provider for an access token.</li>
</ol>
<h3><a href="#requesting-the-jwt-using-the-actions-core-toolkit">Requesting the JWT using the Actions core toolkit</a></h3>
<p>The following example demonstrates how to use <code>actions/github-script</code> with the <code>core</code> toolkit to request the JWT from GitHub's OIDC provider. For more information, see <a href="/en/actions/creating-actions/creating-a-javascript-action#adding-actions-toolkit-packages">Creating a JavaScript action</a>.</p>
<pre><code><span>jobs:</span>
  <span>job:</span>
    <span>environment:</span> <span>Production</span>
    <span>runs-on:</span> <span>ubuntu-latest</span>
    <span>steps:</span>
    <span>-</span> <span>name:</span> <span>Install</span> <span>OIDC</span> <span>Client</span> <span>from</span> <span>Core</span> <span>Package</span>
      <span>run:</span> <span>npm</span> <span>install</span> <span>@actions/core@1.6.0</span> <span>@actions/http-client</span>
    <span>-</span> <span>name:</span> <span>Get</span> <span>Id</span> <span>Token</span>
      <span>uses:</span> <span>actions/github-script@v7</span>
      <span>id:</span> <span>idtoken</span>
      <span>with:</span>
        <span>script:</span> <span>|
          const coredemo = require('@actions/core')
          let id_token = await coredemo.getIDToken()
          coredemo.setOutput('id_token', id_token)
</span></code></pre>
<h3><a href="#requesting-the-jwt-using-environment-variables">Requesting the JWT using environment variables</a></h3>
<p>The following example demonstrates how to use environment variables to request a JSON Web Token.</p>
<p>For your deployment job, you will need to define the token settings, using <code>actions/github-script</code> with the <code>core</code> toolkit. For more information, see <a href="/en/actions/creating-actions/creating-a-javascript-action#adding-actions-toolkit-packages">Creating a JavaScript action</a>.</p>
<p>For example:</p>
<pre><code><span>jobs:</span>
  <span>job:</span>
    <span>runs-on:</span> <span>ubuntu-latest</span>
    <span>steps:</span>
    <span>-</span> <span>uses:</span> <span>actions/github-script@v7</span>
      <span>id:</span> <span>script</span>
      <span>timeout-minutes:</span> <span>10</span>
      <span>with:</span>
        <span>debug:</span> <span>true</span>
        <span>script:</span> <span>|
          const token = process.env['ACTIONS_RUNTIME_TOKEN']
          const runtimeUrl = process.env['ACTIONS_ID_TOKEN_REQUEST_URL']
          core.setOutput('TOKEN', token.trim())
          core.setOutput('IDTOKENURL', runtimeUrl.trim())
</span></code></pre>
<p>You can then use <code>curl</code> to retrieve a JWT from the GitHub OIDC provider. For example:</p>
<pre><code>    <span>-</span> <span>run:</span> <span>|
        IDTOKEN=$(curl -H "Authorization: Bearer ${{steps.script.outputs.TOKEN}}" ${{steps.script.outputs.IDTOKENURL}}  -H "Accept: application/json; api-version=2.0" -H "Content-Type: application/json" -d "{}" | jq -r '.value')
        echo $IDTOKEN
        jwtd() {
            if [[ -x $(command -v jq) ]]; then
                jq -R 'split(".") | .[0],.[1] | @base64d | fromjson' &lt;&lt;&lt; "${1}"
                echo "Signature: $(echo "${1}" | awk -F'.' '{print $3}')"
            fi
        }
        jwtd $IDTOKEN
        echo "idToken=${IDTOKEN}" &gt;&gt; $GITHUB_OUTPUT
</span>      <span>id:</span> <span>tokenid</span>
</code></pre>
<h3><a href="#getting-the-access-token-from-the-cloud-provider">Getting the access token from the cloud provider</a></h3>
<p>You will need to present the OIDC JSON web token to your cloud provider in order to obtain an access token.</p>
<p>For each deployment, your workflows must use cloud login actions (or custom scripts) that fetch the OIDC token and present it to your cloud provider. The cloud provider then validates the claims in the token; if successful, it provides a cloud access token that is available only to that job run. The provided access token can then be used by subsequent actions in the job to connect to the cloud and deploy to its resources.</p>
<p>The steps for exchanging the OIDC token for an access token will vary for each cloud provider.</p>
<h3><a href="#accessing-resources-in-your-cloud-provider">Accessing resources in your cloud provider</a></h3>
<p>Once you've obtained the access token, you can use specific cloud actions or scripts to authenticate to the cloud provider and deploy to its resources. These steps could differ for each cloud provider.</p>
<p>For example, Alibaba Cloud maintains their own instructions for OIDC authentication. For more information, see <a href="https://www.alibabacloud.com/help/en/ram/user-guide/overview-of-oidc-based-sso">Overview of OIDC-based SSO</a> in the Alibaba Cloud documentation.</p>
<p>In addition, the default expiration time of this access token could vary between each cloud and can be configurable at the cloud provider's side.</p>
<h2><a href="#further-reading">Further reading</a></h2>
<ul>
<li><a href="/en/actions/deployment/security-hardening-your-deployments/using-openid-connect-with-reusable-workflows">Using OpenID Connect with reusable workflows</a></li>
<li><a href="/en/actions/hosting-your-own-runners/managing-self-hosted-runners/communicating-with-self-hosted-runners">Communicating with self-hosted runners</a></li>
</ul>
</div></div></div>
</div>
</div></main>
</div></body></html>